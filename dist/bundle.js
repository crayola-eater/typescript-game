(()=>{"use strict";class t{constructor(t,e=t){this.maxHealth=t,this.currentHealth=e}changeHealthBy(t){this.currentHealth+=t}get isDead(){return 0===this.currentHealth}get currentHealthAsPercentage(){return this.currentHealth/this.maxHealth}}class e{constructor(t,e,s,i){this.x=t,this.y=e,this.width=s,this.height=i}collidesWith(t){return this.topLeft.x<t.bottomRight.x&&this.bottomRight.x>t.topLeft.x&&this.topLeft.y<t.bottomRight.y&&this.bottomRight.y>t.topRight.y}collidesWithAny(...t){return t.some((t=>this.collidesWith(t)))}extendsBeyond(t){return this.topLeft.x<t.topLeft.x||this.bottomRight.x>t.bottomRight.x||this.topLeft.y<t.topLeft.y||this.bottomRight.y>t.bottomRight.y}get topLeft(){return{x:this.x,y:this.y}}get topRight(){return{x:this.x+this.width,y:this.y}}get bottomLeft(){return{x:this.x,y:this.y+this.height}}get bottomRight(){return{x:this.x+this.width,y:this.y+this.height}}get center(){return{x:this.x+this.width/2,y:this.y+this.height/2}}}class s extends e{constructor(t,e,s,i,n=0,o=0,h=5){super(t,e,s,i),this.deltaX=n,this.deltaY=o,this.movementAmount=h}moveBy(t,e){this.x+=t,this.y+=e}move(){this.x+=this.deltaX,this.y+=this.deltaY}moveBack(){this.moveBy(-this.deltaX,-this.deltaY)}}class i extends s{constructor(t,e,s=5,i=5,n=15,o=10){super(t.x,t.y,s,i,0,0),this.speed=n,this.damage=o;const h={deltaX:e.x-t.x,deltaY:e.y-t.y},r=Math.atan2(h.deltaY,h.deltaX);this.deltaX=Math.cos(r)*n,this.deltaY=Math.sin(r)*n}}class n{constructor(){this.shotsFired=[]}shoot(t,e){const s=new i(t,e);this.shotsFired.push(s)}remove(t){this.shotsFired=this.shotsFired.filter((e=>t!==e))}}var o,h=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};class r extends s{constructor(t,e,s,i,n=100,h=100){super(t,e,n,h),this.health=s,this.shooter=i,o.set(this,void 0);const r=(new Date).getTime();!function(t,e,s){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");e.set(t,s)}(this,o,{changedDeltaX:r,changedDeltaY:r,shot:r})}get shouldChangeDirection(){return(new Date).getTime()>h(this,o).changedDeltaX+100}maybeChangeDirection(){if(this.shouldChangeDirection){const t=Math.random()<.5?-1:1;this.deltaX=5*Math.random()*t;const e=Math.random()<.5?-1:1;this.deltaY=5*Math.random()*e;const s=(new Date).getTime();h(this,o).changedDeltaX=s,h(this,o).changedDeltaY=s}}move(){this.maybeChangeDirection(),super.move()}}o=new WeakMap;const a=function(){const e=new t(100),s=new n;return new r(600,200,e,s)}();var l,c=function(t,e,s){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,s),s},d=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};class u{constructor(t,e){l.set(this,void 0),this.inputs={KeyW:!1,KeyA:!1,KeyS:!1,KeyD:!1,LMB:!1},c(this,l,((t,e)=>console.log({input:t,newValue:e})));const s=t=>{0===t.button&&(this.inputs.LMB="mousedown"===t.type,d(this,l).call(this,"LMB",this.inputs.LMB,t))},i=t=>{const{code:e}=t;this.inputs.hasOwnProperty(e)&&(this.inputs[e]="keydown"===t.type,d(this,l).call(this,e,this.inputs[e],t))};t.addEventListener("mouseup",s),t.addEventListener("mousedown",s),e.addEventListener("keyup",i),e.addEventListener("keydown",i)}set onInputHandler(t){c(this,l,t)}}l=new WeakMap;class y extends s{constructor(t,e,s,i,n,o=100,h=100,r=0,a=0){super(t,e,o,h,r,a),this.health=s,this.controls=i,this.shooter=n,this.controls.onInputHandler=(t,e,s)=>{"LMB"===t&&e&&this.shooter.shoot({x:this.center.x,y:this.center.y},{x:s.x,y:s.y})},this.movementAmount=5}move(){this.controls.inputs.KeyW?this.deltaY=-this.movementAmount:this.controls.inputs.KeyS?this.deltaY=this.movementAmount:this.deltaY=0,this.controls.inputs.KeyA?this.deltaX=-this.movementAmount:this.controls.inputs.KeyD?this.deltaX=this.movementAmount:this.deltaX=0,super.move()}}const m=function(){const e=new t(100),s=new u(document.querySelector("canvas"),window),i=new n;return new y(300,100,e,s,i)}();class p extends e{constructor(t,e,s,i,n){super(t,e,s,i),this.health=n}}const w={players:[m,a],obstacles:[new p(200,200,50,50,new t(200)),new p(300,300,20,150,new t(200)),new p(600,400,90,70,new t(200))],world:new class extends e{constructor(t=800,e=500){super(0,0,t,e)}}};Object.assign({},w);const{world:g,players:f,obstacles:x}=w,v=document.querySelector("canvas"),R=v.getContext("2d");v.height=g.height,v.width=g.width;const b=()=>{return t=void 0,e=void 0,i=function*(){R.clearRect(0,0,v.width,v.height);for(const t of x){R.fillStyle="#704300",R.fillRect(t.x,t.y,t.width,t.height);const{currentHealth:e}=t.health;R.fillStyle=e>60?"green":e>40?"yellow":"red",R.fillRect(t.x,t.y-40,t.health.currentHealthAsPercentage*t.width,20),R.strokeStyle="black",R.lineWidth=2,R.strokeRect(t.x,t.y-40,t.width,20)}for(const t of f){t.move(),(t.extendsBeyond(g)||t.collidesWithAny(...x))&&t.moveBack();const{currentHealth:e}=t.health;R.fillStyle="red",R.fillRect(t.x,t.y,t.width,t.height),R.fillStyle=e>60?"green":e>40?"yellow":"red",R.fillRect(t.x,t.y-40,t.health.currentHealthAsPercentage*t.width,20),R.strokeStyle="black",R.lineWidth=2,R.strokeRect(t.x,t.y-40,t.width,20);for(const e of t.shooter.shotsFired)e.move(),(e.collidesWithAny(...x)||e.collidesWithAny(...f.filter((e=>e!==t))))&&t.shooter.remove(e),R.fillStyle="goldenrod",R.fillRect(e.x,e.y,7,7)}requestAnimationFrame(b)},new((s=void 0)||(s=Promise))((function(n,o){function h(t){try{a(i.next(t))}catch(t){o(t)}}function r(t){try{a(i.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?n(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(h,r)}a((i=i.apply(t,e||[])).next())}));var t,e,s,i};b()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zbWFsbC1nYW1lLy4vc3JjL21vZGVsL2NvbXBvbmVudHMvaGVhbHRoLnRzIiwid2VicGFjazovL3NtYWxsLWdhbWUvLi9zcmMvbW9kZWwvY29tcG9uZW50cy9zaGFwZS50cyIsIndlYnBhY2s6Ly9zbWFsbC1nYW1lLy4vc3JjL21vZGVsL2NvbXBvbmVudHMvbW92YWJsZVNoYXBlLnRzIiwid2VicGFjazovL3NtYWxsLWdhbWUvLi9zcmMvbW9kZWwvY29tcG9uZW50cy9zaG90LnRzIiwid2VicGFjazovL3NtYWxsLWdhbWUvLi9zcmMvbW9kZWwvY29tcG9uZW50cy9zaG9vdGVyLnRzIiwid2VicGFjazovL3NtYWxsLWdhbWUvLi9zcmMvbW9kZWwvY2xhc3Nlcy9jb21wdXRlclBsYXllci50cyIsIndlYnBhY2s6Ly9zbWFsbC1nYW1lLy4vc3JjL21vZGVsL2NvbXBvbmVudHMvY29udHJvbHMudHMiLCJ3ZWJwYWNrOi8vc21hbGwtZ2FtZS8uL3NyYy9tb2RlbC9jbGFzc2VzL2h1bWFuUGxheWVyLnRzIiwid2VicGFjazovL3NtYWxsLWdhbWUvLi9zcmMvbW9kZWwvY2xhc3Nlcy9vYnN0YWNsZS50cyIsIndlYnBhY2s6Ly9zbWFsbC1nYW1lLy4vc3JjL2RlZmF1bHRHYW1lU2V0dXAudHMiLCJ3ZWJwYWNrOi8vc21hbGwtZ2FtZS8uL3NyYy9tb2RlbC9jbGFzc2VzL3dvcmxkLnRzIiwid2VicGFjazovL3NtYWxsLWdhbWUvLi9zcmMvaW5kZXgudHMiXSwibmFtZXMiOlsiSGVhbHRoIiwibWF4SGVhbHRoIiwiY3VycmVudEhlYWx0aCIsImNoYW5nZSIsInRoaXMiLCJTaGFwZSIsIngiLCJ5Iiwid2lkdGgiLCJoZWlnaHQiLCJvdGhlclNoYXBlIiwidG9wTGVmdCIsImJvdHRvbVJpZ2h0IiwidG9wUmlnaHQiLCJvdGhlclNoYXBlcyIsInNvbWUiLCJjb2xsaWRlc1dpdGgiLCJNb3ZhYmxlU2hhcGUiLCJkZWx0YVgiLCJkZWx0YVkiLCJtb3ZlbWVudEFtb3VudCIsInN1cGVyIiwibW92ZUJ5IiwiU2hvdCIsImZyb20iLCJ0byIsInNwZWVkIiwiZGFtYWdlIiwib3JpZ2luYWxEZWx0YSIsInJhZGlhbnMiLCJNYXRoIiwiYXRhbjIiLCJjb3MiLCJzaW4iLCJTaG9vdGVyIiwic2hvdHNGaXJlZCIsImF0Iiwic2hvdCIsInB1c2giLCJzaG90VG9SZW1vdmUiLCJmaWx0ZXIiLCJDb21wdXRlclBsYXllciIsImhlYWx0aCIsInNob290ZXIiLCJjdXJyZW50VGltZSIsIkRhdGUiLCJnZXRUaW1lIiwiY2hhbmdlZERlbHRhWCIsImNoYW5nZWREZWx0YVkiLCJzaG91bGRDaGFuZ2VEaXJlY3Rpb24iLCJsZWZ0T3JSaWdodCIsInJhbmRvbSIsInVwT3JEb3duIiwibWF5YmVDaGFuZ2VEaXJlY3Rpb24iLCJtb3ZlIiwiZGVmYXVsdENvbXB1dGVyUGxheWVyIiwiY3JlYXRlRGVmYXVsdENvbXB1dGVyUGxheWVyIiwiQ29udHJvbHMiLCJjYW52YXMiLCJ3aW5kb3ciLCJpbnB1dHMiLCJLZXlXIiwiS2V5QSIsIktleVMiLCJLZXlEIiwiTE1CIiwiaW5wdXQiLCJuZXdWYWx1ZSIsImNvbnNvbGUiLCJsb2ciLCJjbGlja0xpc3RlbmVyIiwiZSIsImJ1dHRvbiIsInR5cGUiLCJrZXlMaXN0ZW5lciIsImNvZGUiLCJoYXNPd25Qcm9wZXJ0eSIsImFkZEV2ZW50TGlzdGVuZXIiLCJuZXdIYW5kbGVyIiwiSHVtYW5QbGF5ZXIiLCJjb250cm9scyIsIm9uSW5wdXRIYW5kbGVyIiwibmV3U3RhdGUiLCJldmVudCIsInNob290IiwiY2VudGVyIiwiZGVmYXVsdEh1bWFuUGxheWVyIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiY3JlYXRlRGVmYXVsdEh1bWFuUGxheWVyIiwiT2JzdGFjbGUiLCJkZWZhdWx0Q29uZmlnIiwicGxheWVycyIsIm9ic3RhY2xlcyIsIndvcmxkIiwiY3R4IiwiZ2V0Q29udGV4dCIsInVwZGF0ZSIsImNsZWFyUmVjdCIsIm9ic3RhY2xlIiwiZmlsbFN0eWxlIiwiZmlsbFJlY3QiLCJjdXJyZW50SGVhbHRoQXNQZXJjZW50YWdlIiwic3Ryb2tlU3R5bGUiLCJsaW5lV2lkdGgiLCJzdHJva2VSZWN0IiwicGxheWVyIiwiZXh0ZW5kc0JleW9uZCIsImNvbGxpZGVzV2l0aEFueSIsIm1vdmVCYWNrIiwicCIsInJlbW92ZSIsInJlcXVlc3RBbmltYXRpb25GcmFtZSJdLCJtYXBwaW5ncyI6Im1CQUFPLE1BQU1BLEVBQ1gsWUFDU0MsRUFDQUMsRUFBd0JELEdBRHhCLEtBQUFBLFlBQ0EsS0FBQUMsZ0JBR1QsZUFBZUMsR0FDYkMsS0FBS0YsZUFBaUJDLEVBR3hCLGFBQ0UsT0FBOEIsSUFBdkJDLEtBQUtGLGNBR2QsZ0NBQ0UsT0FBT0UsS0FBS0YsY0FBZ0JFLEtBQUtILFdDTjlCLE1BQU1JLEVBQ1gsWUFDU0MsRUFDQUMsRUFDQUMsRUFDQUMsR0FIQSxLQUFBSCxJQUNBLEtBQUFDLElBQ0EsS0FBQUMsUUFDQSxLQUFBQyxTQUdULGFBQWFDLEdBQ1gsT0FDRU4sS0FBS08sUUFBUUwsRUFBSUksRUFBV0UsWUFBWU4sR0FDeENGLEtBQUtRLFlBQVlOLEVBQUlJLEVBQVdDLFFBQVFMLEdBQ3hDRixLQUFLTyxRQUFRSixFQUFJRyxFQUFXRSxZQUFZTCxHQUN4Q0gsS0FBS1EsWUFBWUwsRUFBSUcsRUFBV0csU0FBU04sRUFJN0MsbUJBQW1CTyxHQUNqQixPQUFPQSxFQUFZQyxNQUFNTCxHQUFlTixLQUFLWSxhQUFhTixLQUc1RCxjQUFjQSxHQUNaLE9BQ0VOLEtBQUtPLFFBQVFMLEVBQUlJLEVBQVdDLFFBQVFMLEdBQ3BDRixLQUFLUSxZQUFZTixFQUFJSSxFQUFXRSxZQUFZTixHQUM1Q0YsS0FBS08sUUFBUUosRUFBSUcsRUFBV0MsUUFBUUosR0FDcENILEtBQUtRLFlBQVlMLEVBQUlHLEVBQVdFLFlBQVlMLEVBSWhELGNBQ0UsTUFBTyxDQUNMRCxFQUFHRixLQUFLRSxFQUNSQyxFQUFHSCxLQUFLRyxHQUlaLGVBQ0UsTUFBTyxDQUNMRCxFQUFHRixLQUFLRSxF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QUFJTSxTQUFTSyxFQUFPcEcsRUFBR29HLEVBQU9uRyxFQUFHbUcsRUFBT2xHLE1BQU9rRyxFQUFPakcsUUFHdERzRixFQUFJSyxVQUNGbEcsRUFBZ0IsR0FBSyxRQUFVQSxFQUFnQixHQUFLLFNBQVcsTUFDakU2RixFQUFJTSxTQUNGSyxFQUFPcEcsRUFDUG9HLEVBQU9uRyxFQUFJLEdBQ1htRyxFQUFPaEUsT0FBTzRELDBCQUE0QkksRUFBT2xHLE1BQ2pELElBRUZ1RixFQUFJUSxZQUFjLFFBQ2xCUixFQUFJUyxVQUFZLEVBQ2hCVCxFQUFJVSxXQUFXQyxFQUFPcEcsRUFBR29HLEVBQU9uRyxFQUFJLEdBQUltRyxFQUFPbEcsTUFBTyxJQUd0RCxJQUFLLE1BQU02QixLQUFRcUUsRUFBTy9ELFFBQVFSLFdBQ2hDRSxFQUFLaUIsUUFJSGpCLEVBQUt1RSxtQkFBbUIsSUFHeEJ2RSxFQUFLdUUsbUJBQW1CLEVBQVFwRSxRQUFRc0UsR0FBTUEsSUFBTUosT0FHcERBLEVBQU8vRCxRQUFRb0UsT0FBTzFFLEdBR3hCMEQsRUFBSUssVUFBWSxZQUNoQkwsRUFBSU0sU0FBU2hFLEVBQUsvQixFQUFHK0IsRUFBSzlCLEVBQUcsRUFBRyxHQUtwQ3lHLHNCQUFzQmYsSSxZQTFFRSxLLCtRQTZFMUJBLEsiLCJmaWxlIjoiYnVuZGxlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGNsYXNzIEhlYWx0aCB7XHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwdWJsaWMgbWF4SGVhbHRoOiBudW1iZXIsXHJcbiAgICBwdWJsaWMgY3VycmVudEhlYWx0aDogbnVtYmVyID0gbWF4SGVhbHRoXHJcbiAgKSB7fVxyXG5cclxuICBjaGFuZ2VIZWFsdGhCeShjaGFuZ2U6IG51bWJlcikge1xyXG4gICAgdGhpcy5jdXJyZW50SGVhbHRoICs9IGNoYW5nZTtcclxuICB9XHJcblxyXG4gIGdldCBpc0RlYWQoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5jdXJyZW50SGVhbHRoID09PSAwO1xyXG4gIH1cclxuXHJcbiAgZ2V0IGN1cnJlbnRIZWFsdGhBc1BlcmNlbnRhZ2UoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5jdXJyZW50SGVhbHRoIC8gdGhpcy5tYXhIZWFsdGg7XHJcbiAgfVxyXG59XHJcbiIsImltcG9ydCB7IElQb3NpdGlvbiB9IGZyb20gXCIuLi9pbnRlcmZhY2VzL3Bvc2l0aW9uXCI7XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIFNoYXBlT3B0aW9ucyB7XHJcbiAgeDogbnVtYmVyO1xyXG4gIHk6IG51bWJlcjtcclxuICBoZWlnaHQ6IG51bWJlcjtcclxuICB3aWR0aDogbnVtYmVyO1xyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgU2hhcGUge1xyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHVibGljIHg6IG51bWJlcixcclxuICAgIHB1YmxpYyB5OiBudW1iZXIsXHJcbiAgICBwdWJsaWMgd2lkdGg6IG51bWJlcixcclxuICAgIHB1YmxpYyBoZWlnaHQ6IG51bWJlclxyXG4gICkge31cclxuXHJcbiAgY29sbGlkZXNXaXRoKG90aGVyU2hhcGU6IFNoYXBlKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gKFxyXG4gICAgICB0aGlzLnRvcExlZnQueCA8IG90aGVyU2hhcGUuYm90dG9tUmlnaHQueCAmJlxyXG4gICAgICB0aGlzLmJvdHRvbVJpZ2h0LnggPiBvdGhlclNoYXBlLnRvcExlZnQueCAmJlxyXG4gICAgICB0aGlzLnRvcExlZnQueSA8IG90aGVyU2hhcGUuYm90dG9tUmlnaHQueSAmJlxyXG4gICAgICB0aGlzLmJvdHRvbVJpZ2h0LnkgPiBvdGhlclNoYXBlLnRvcFJpZ2h0LnlcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBjb2xsaWRlc1dpdGhBbnkoLi4ub3RoZXJTaGFwZXM6IFNoYXBlW10pIHtcclxuICAgIHJldHVybiBvdGhlclNoYXBlcy5zb21lKChvdGhlclNoYXBlKSA9PiB0aGlzLmNvbGxpZGVzV2l0aChvdGhlclNoYXBlKSk7XHJcbiAgfVxyXG5cclxuICBleHRlbmRzQmV5b25kKG90aGVyU2hhcGU6IFNoYXBlKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gKFxyXG4gICAgICB0aGlzLnRvcExlZnQueCA8IG90aGVyU2hhcGUudG9wTGVmdC54IHx8XHJcbiAgICAgIHRoaXMuYm90dG9tUmlnaHQueCA+IG90aGVyU2hhcGUuYm90dG9tUmlnaHQueCB8fFxyXG4gICAgICB0aGlzLnRvcExlZnQueSA8IG90aGVyU2hhcGUudG9wTGVmdC55IHx8XHJcbiAgICAgIHRoaXMuYm90dG9tUmlnaHQueSA+IG90aGVyU2hhcGUuYm90dG9tUmlnaHQueVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIGdldCB0b3BMZWZ0KCk6IElQb3NpdGlvbiB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICB4OiB0aGlzLngsXHJcbiAgICAgIHk6IHRoaXMueSxcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBnZXQgdG9wUmlnaHQoKTogSVBvc2l0aW9uIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHg6IHRoaXMueCArIHRoaXMud2lkdGgsXHJcbiAgICAgIHk6IHRoaXMueSxcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBnZXQgYm90dG9tTGVmdCgpOiBJUG9zaXRpb24ge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgeDogdGhpcy54LFxyXG4gICAgICB5OiB0aGlzLnkgKyB0aGlzLmhlaWdodCxcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBnZXQgYm90dG9tUmlnaHQoKTogSVBvc2l0aW9uIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHg6IHRoaXMueCArIHRoaXMud2lkdGgsXHJcbiAgICAgIHk6IHRoaXMueSArIHRoaXMuaGVpZ2h0LFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIGdldCBjZW50ZXIoKTogSVBvc2l0aW9uIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHg6IHRoaXMueCArIHRoaXMud2lkdGggLyAyLFxyXG4gICAgICB5OiB0aGlzLnkgKyB0aGlzLmhlaWdodCAvIDIsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG4iLCJpbXBvcnQgeyBTaGFwZSB9IGZyb20gXCIuL3NoYXBlXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgTW92YWJsZVNoYXBlIGV4dGVuZHMgU2hhcGUge1xyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgeDogbnVtYmVyLFxyXG4gICAgeTogbnVtYmVyLFxyXG4gICAgd2lkdGg6IG51bWJlcixcclxuICAgIGhlaWdodDogbnVtYmVyLFxyXG4gICAgcHVibGljIGRlbHRhWDogbnVtYmVyID0gMCxcclxuICAgIHB1YmxpYyBkZWx0YVk6IG51bWJlciA9IDAsXHJcbiAgICBwdWJsaWMgbW92ZW1lbnRBbW91bnQ6IG51bWJlciA9IDVcclxuICApIHtcclxuICAgIHN1cGVyKHgsIHksIHdpZHRoLCBoZWlnaHQpO1xyXG4gIH1cclxuXHJcbiAgbW92ZUJ5KGRlbHRhWDogbnVtYmVyLCBkZWx0YVk6IG51bWJlcikge1xyXG4gICAgdGhpcy54ICs9IGRlbHRhWDtcclxuICAgIHRoaXMueSArPSBkZWx0YVk7XHJcbiAgfVxyXG5cclxuICBtb3ZlKCkge1xyXG4gICAgdGhpcy54ICs9IHRoaXMuZGVsdGFYO1xyXG4gICAgdGhpcy55ICs9IHRoaXMuZGVsdGFZO1xyXG4gIH1cclxuXHJcbiAgbW92ZUJhY2soKSB7XHJcbiAgICB0aGlzLm1vdmVCeSgtdGhpcy5kZWx0YVgsIC10aGlzLmRlbHRhWSk7XHJcbiAgfVxyXG59XHJcbiIsImltcG9ydCB7IE1vdmFibGVTaGFwZSB9IGZyb20gXCIuL21vdmFibGVTaGFwZVwiO1xyXG5pbXBvcnQgeyBJUG9zaXRpb24gfSBmcm9tIFwiLi4vaW50ZXJmYWNlcy9wb3NpdGlvblwiO1xyXG5cclxuZXhwb3J0IGNsYXNzIFNob3QgZXh0ZW5kcyBNb3ZhYmxlU2hhcGUge1xyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgZnJvbTogSVBvc2l0aW9uLFxyXG4gICAgdG86IElQb3NpdGlvbixcclxuICAgIHdpZHRoOiBudW1iZXIgPSA1LFxyXG4gICAgaGVpZ2h0OiBudW1iZXIgPSA1LFxyXG4gICAgcHVibGljIHNwZWVkOiBudW1iZXIgPSAxNSxcclxuICAgIHB1YmxpYyBkYW1hZ2U6IG51bWJlciA9IDEwXHJcbiAgKSB7XHJcbiAgICBzdXBlcihmcm9tLngsIGZyb20ueSwgd2lkdGgsIGhlaWdodCwgMCwgMCk7XHJcblxyXG4gICAgY29uc3Qgb3JpZ2luYWxEZWx0YSA9IHtcclxuICAgICAgZGVsdGFYOiB0by54IC0gZnJvbS54LCAvLyBBIGluIENBSFxyXG4gICAgICBkZWx0YVk6IHRvLnkgLSBmcm9tLnksIC8vIE8gaW4gU09IXHJcbiAgICB9O1xyXG5cclxuICAgIGNvbnN0IHJhZGlhbnMgPSBNYXRoLmF0YW4yKG9yaWdpbmFsRGVsdGEuZGVsdGFZLCBvcmlnaW5hbERlbHRhLmRlbHRhWCk7XHJcbiAgICB0aGlzLmRlbHRhWCA9IE1hdGguY29zKHJhZGlhbnMpICogc3BlZWQ7IC8vIENBSFxyXG4gICAgdGhpcy5kZWx0YVkgPSBNYXRoLnNpbihyYWRpYW5zKSAqIHNwZWVkOyAvLyBTT0hcclxuICB9XHJcbn1cclxuIiwiaW1wb3J0IHsgSVBvc2l0aW9uIH0gZnJvbSBcIi4uL2ludGVyZmFjZXMvcG9zaXRpb25cIjtcclxuaW1wb3J0IHsgU2hvdCB9IGZyb20gXCIuL3Nob3RcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBTaG9vdGVyIHtcclxuICBzaG90c0ZpcmVkOiBTaG90W107XHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICB0aGlzLnNob3RzRmlyZWQgPSBbXTtcclxuICB9XHJcblxyXG4gIHNob290KGZyb206IElQb3NpdGlvbiwgYXQ6IElQb3NpdGlvbikge1xyXG4gICAgY29uc3Qgc2hvdCA9IG5ldyBTaG90KGZyb20sIGF0KTtcclxuICAgIHRoaXMuc2hvdHNGaXJlZC5wdXNoKHNob3QpO1xyXG4gIH1cclxuXHJcbiAgcmVtb3ZlKHNob3RUb1JlbW92ZTogU2hvdCkge1xyXG4gICAgdGhpcy5zaG90c0ZpcmVkID0gdGhpcy5zaG90c0ZpcmVkLmZpbHRlcigoc2hvdCkgPT4gc2hvdFRvUmVtb3ZlICE9PSBzaG90KTtcclxuICB9XHJcbn1cclxuIiwiaW1wb3J0IHsgSGVhbHRoIH0gZnJvbSBcIi4uL2NvbXBvbmVudHMvaGVhbHRoXCI7XHJcbmltcG9ydCB7IE1vdmFibGVTaGFwZSB9IGZyb20gXCIuLi9jb21wb25lbnRzL21vdmFibGVTaGFwZVwiO1xyXG5pbXBvcnQgeyBTaG9vdGVyIH0gZnJvbSBcIi4uL2NvbXBvbmVudHMvc2hvb3RlclwiO1xyXG5cclxuZXhwb3J0IGNsYXNzIENvbXB1dGVyUGxheWVyIGV4dGVuZHMgTW92YWJsZVNoYXBlIHtcclxuICAjbGFzdEFjdGlvbnM6IHtcclxuICAgIGNoYW5nZWREZWx0YVg6IG51bWJlcjtcclxuICAgIGNoYW5nZWREZWx0YVk6IG51bWJlcjtcclxuICAgIHNob3Q6IG51bWJlcjtcclxuICB9O1xyXG5cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHg6IG51bWJlcixcclxuICAgIHk6IG51bWJlcixcclxuICAgIHB1YmxpYyBoZWFsdGg6IEhlYWx0aCxcclxuICAgIHB1YmxpYyBzaG9vdGVyOiBTaG9vdGVyLFxyXG4gICAgd2lkdGg6IG51bWJlciA9IDEwMCxcclxuICAgIGhlaWdodDogbnVtYmVyID0gMTAwXHJcbiAgKSB7XHJcbiAgICBzdXBlcih4LCB5LCB3aWR0aCwgaGVpZ2h0KTtcclxuXHJcbiAgICBjb25zdCBjdXJyZW50VGltZSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xyXG4gICAgdGhpcy4jbGFzdEFjdGlvbnMgPSB7XHJcbiAgICAgIGNoYW5nZWREZWx0YVg6IGN1cnJlbnRUaW1lLFxyXG4gICAgICBjaGFuZ2VkRGVsdGFZOiBjdXJyZW50VGltZSxcclxuICAgICAgc2hvdDogY3VycmVudFRpbWUsXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgZ2V0IHNob3VsZENoYW5nZURpcmVjdGlvbigpIHtcclxuICAgIHJldHVybiBuZXcgRGF0ZSgpLmdldFRpbWUoKSA+IHRoaXMuI2xhc3RBY3Rpb25zLmNoYW5nZWREZWx0YVggKyAxMDA7XHJcbiAgfVxyXG5cclxuICBtYXliZUNoYW5nZURpcmVjdGlvbigpIHtcclxuICAgIGlmICh0aGlzLnNob3VsZENoYW5nZURpcmVjdGlvbikge1xyXG4gICAgICBjb25zdCBsZWZ0T3JSaWdodCA9IE1hdGgucmFuZG9tKCkgPCAwLjUgPyAtMSA6IDE7XHJcbiAgICAgIHRoaXMuZGVsdGFYID0gTWF0aC5yYW5kb20oKSAqIDUgKiBsZWZ0T3JSaWdodDtcclxuXHJcbiAgICAgIGNvbnN0IHVwT3JEb3duID0gTWF0aC5yYW5kb20oKSA8IDAuNSA/IC0xIDogMTtcclxuICAgICAgdGhpcy5kZWx0YVkgPSBNYXRoLnJhbmRvbSgpICogNSAqIHVwT3JEb3duO1xyXG5cclxuICAgICAgY29uc3QgY3VycmVudFRpbWUgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcclxuICAgICAgdGhpcy4jbGFzdEFjdGlvbnMuY2hhbmdlZERlbHRhWCA9IGN1cnJlbnRUaW1lO1xyXG4gICAgICB0aGlzLiNsYXN0QWN0aW9ucy5jaGFuZ2VkRGVsdGFZID0gY3VycmVudFRpbWU7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBtb3ZlKCkge1xyXG4gICAgdGhpcy5tYXliZUNoYW5nZURpcmVjdGlvbigpO1xyXG4gICAgc3VwZXIubW92ZSgpO1xyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gY3JlYXRlRGVmYXVsdENvbXB1dGVyUGxheWVyKCkge1xyXG4gIGNvbnN0IGhlYWx0aCA9IG5ldyBIZWFsdGgoMTAwKTtcclxuICBjb25zdCBzaG9vdGVyID0gbmV3IFNob290ZXIoKTtcclxuICByZXR1cm4gbmV3IENvbXB1dGVyUGxheWVyKDYwMCwgMjAwLCBoZWFsdGgsIHNob290ZXIpO1xyXG59XHJcblxyXG5leHBvcnQgY29uc3QgZGVmYXVsdENvbXB1dGVyUGxheWVyID0gY3JlYXRlRGVmYXVsdENvbXB1dGVyUGxheWVyKCk7XHJcbiIsImludGVyZmFjZSBDb250cm9sTWFwIHtcclxuICBbY29udHJvbDogc3RyaW5nXTogYm9vbGVhbjtcclxufVxyXG5cclxudHlwZSBpbnB1dEhhbmRsZXIgPSAoXHJcbiAgaW5wdXQ6IHN0cmluZyxcclxuICBuZXdTdGF0ZTogYm9vbGVhbixcclxuICBlOiBNb3VzZUV2ZW50IHwgS2V5Ym9hcmRFdmVudFxyXG4pID0+IHZvaWQ7XHJcblxyXG5leHBvcnQgY2xhc3MgQ29udHJvbHMge1xyXG4gIGlucHV0czogQ29udHJvbE1hcDtcclxuICAjb25JbnB1dDogaW5wdXRIYW5kbGVyO1xyXG5cclxuICBjb25zdHJ1Y3RvcihjYW52YXM6IEhUTUxDYW52YXNFbGVtZW50LCB3aW5kb3c6IFdpbmRvdykge1xyXG4gICAgLy8gTWlnaHQgYmUgd29ydGggc2V0dGluZyB0aGlzIG9iamVjdCB1cCBhcyBhIHByb3h5P1xyXG4gICAgdGhpcy5pbnB1dHMgPSB7XHJcbiAgICAgIEtleVc6IGZhbHNlLFxyXG4gICAgICBLZXlBOiBmYWxzZSxcclxuICAgICAgS2V5UzogZmFsc2UsXHJcbiAgICAgIEtleUQ6IGZhbHNlLFxyXG4gICAgICBMTUI6IGZhbHNlLFxyXG4gICAgfTtcclxuICAgIHRoaXMuI29uSW5wdXQgPSAoaW5wdXQsIG5ld1ZhbHVlKSA9PiBjb25zb2xlLmxvZyh7IGlucHV0LCBuZXdWYWx1ZSB9KTtcclxuXHJcbiAgICBjb25zdCBjbGlja0xpc3RlbmVyID0gKGU6IE1vdXNlRXZlbnQpID0+IHtcclxuICAgICAgaWYgKDAgPT09IGUuYnV0dG9uKSB7XHJcbiAgICAgICAgdGhpcy5pbnB1dHMuTE1CID0gZS50eXBlID09PSBcIm1vdXNlZG93blwiO1xyXG4gICAgICAgIHRoaXMuI29uSW5wdXQoXCJMTUJcIiwgdGhpcy5pbnB1dHMuTE1CLCBlKTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBjb25zdCBrZXlMaXN0ZW5lciA9IChlOiBLZXlib2FyZEV2ZW50KSA9PiB7XHJcbiAgICAgIGNvbnN0IHsgY29kZSB9ID0gZTtcclxuICAgICAgaWYgKHRoaXMuaW5wdXRzLmhhc093blByb3BlcnR5KGNvZGUpKSB7XHJcbiAgICAgICAgdGhpcy5pbnB1dHNbY29kZV0gPSBlLnR5cGUgPT09IFwia2V5ZG93blwiO1xyXG4gICAgICAgIHRoaXMuI29uSW5wdXQoY29kZSwgdGhpcy5pbnB1dHNbY29kZV0sIGUpO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIGNhbnZhcy5hZGRFdmVudExpc3RlbmVyKFwibW91c2V1cFwiLCBjbGlja0xpc3RlbmVyKTtcclxuICAgIGNhbnZhcy5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIGNsaWNrTGlzdGVuZXIpO1xyXG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXl1cFwiLCBrZXlMaXN0ZW5lcik7XHJcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwga2V5TGlzdGVuZXIpO1xyXG4gIH1cclxuXHJcbiAgc2V0IG9uSW5wdXRIYW5kbGVyKG5ld0hhbmRsZXI6IGlucHV0SGFuZGxlcikge1xyXG4gICAgdGhpcy4jb25JbnB1dCA9IG5ld0hhbmRsZXI7XHJcbiAgfVxyXG59XHJcbiIsImltcG9ydCB7IENvbnRyb2xzIH0gZnJvbSBcIi4uL2NvbXBvbmVudHMvY29udHJvbHNcIjtcclxuaW1wb3J0IHsgSGVhbHRoIH0gZnJvbSBcIi4uL2NvbXBvbmVudHMvaGVhbHRoXCI7XHJcbmltcG9ydCB7IE1vdmFibGVTaGFwZSB9IGZyb20gXCIuLi9jb21wb25lbnRzL21vdmFibGVTaGFwZVwiO1xyXG5pbXBvcnQgeyBTaG9vdGVyIH0gZnJvbSBcIi4uL2NvbXBvbmVudHMvc2hvb3RlclwiO1xyXG5cclxuZXhwb3J0IGNsYXNzIEh1bWFuUGxheWVyIGV4dGVuZHMgTW92YWJsZVNoYXBlIHtcclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHg6IG51bWJlcixcclxuICAgIHk6IG51bWJlcixcclxuICAgIHB1YmxpYyBoZWFsdGg6IEhlYWx0aCxcclxuICAgIHB1YmxpYyBjb250cm9sczogQ29udHJvbHMsXHJcbiAgICBwdWJsaWMgc2hvb3RlcjogU2hvb3RlcixcclxuICAgIHdpZHRoOiBudW1iZXIgPSAxMDAsXHJcbiAgICBoZWlnaHQ6IG51bWJlciA9IDEwMCxcclxuICAgIGRlbHRhWDogbnVtYmVyID0gMCxcclxuICAgIGRlbHRhWTogbnVtYmVyID0gMFxyXG4gICkge1xyXG4gICAgc3VwZXIoeCwgeSwgd2lkdGgsIGhlaWdodCwgZGVsdGFYLCBkZWx0YVkpO1xyXG4gICAgdGhpcy5jb250cm9scy5vbklucHV0SGFuZGxlciA9IChpbnB1dCwgbmV3U3RhdGUsIGV2ZW50KSA9PiB7XHJcbiAgICAgIGlmIChcIkxNQlwiID09PSBpbnB1dCAmJiBuZXdTdGF0ZSkge1xyXG4gICAgICAgIHRoaXMuc2hvb3Rlci5zaG9vdChcclxuICAgICAgICAgIHsgeDogdGhpcy5jZW50ZXIueCwgeTogdGhpcy5jZW50ZXIueSB9LFxyXG4gICAgICAgICAgeyB4OiAoZXZlbnQgYXMgTW91c2VFdmVudCkueCwgeTogKGV2ZW50IGFzIE1vdXNlRXZlbnQpLnkgfVxyXG4gICAgICAgICk7XHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgICB0aGlzLm1vdmVtZW50QW1vdW50ID0gNTtcclxuICB9XHJcblxyXG4gIG1vdmUoKSB7XHJcbiAgICBpZiAodGhpcy5jb250cm9scy5pbnB1dHMuS2V5Vykge1xyXG4gICAgICB0aGlzLmRlbHRhWSA9IC10aGlzLm1vdmVtZW50QW1vdW50O1xyXG4gICAgfSBlbHNlIGlmICh0aGlzLmNvbnRyb2xzLmlucHV0cy5LZXlTKSB7XHJcbiAgICAgIHRoaXMuZGVsdGFZID0gdGhpcy5tb3ZlbWVudEFtb3VudDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuZGVsdGFZID0gMDtcclxuICAgIH1cclxuXHJcbiAgICBpZiAodGhpcy5jb250cm9scy5pbnB1dHMuS2V5QSkge1xyXG4gICAgICB0aGlzLmRlbHRhWCA9IC10aGlzLm1vdmVtZW50QW1vdW50O1xyXG4gICAgfSBlbHNlIGlmICh0aGlzLmNvbnRyb2xzLmlucHV0cy5LZXlEKSB7XHJcbiAgICAgIHRoaXMuZGVsdGFYID0gdGhpcy5tb3ZlbWVudEFtb3VudDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuZGVsdGFYID0gMDtcclxuICAgIH1cclxuICAgIHN1cGVyLm1vdmUoKTtcclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNyZWF0ZURlZmF1bHRIdW1hblBsYXllcigpIHtcclxuICBjb25zdCBoZWFsdGggPSBuZXcgSGVhbHRoKDEwMCk7XHJcbiAgY29uc3QgY29udHJvbHMgPSBuZXcgQ29udHJvbHMoZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcImNhbnZhc1wiKSEsIHdpbmRvdyk7XHJcbiAgY29uc3Qgc2hvb3RlciA9IG5ldyBTaG9vdGVyKCk7XHJcbiAgcmV0dXJuIG5ldyBIdW1hblBsYXllcigzMDAsIDEwMCwgaGVhbHRoLCBjb250cm9scywgc2hvb3Rlcik7XHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBkZWZhdWx0SHVtYW5QbGF5ZXIgPSBjcmVhdGVEZWZhdWx0SHVtYW5QbGF5ZXIoKTtcclxuIiwiaW1wb3J0IHsgSGVhbHRoIH0gZnJvbSBcIi4uL2NvbXBvbmVudHMvaGVhbHRoXCI7XHJcbmltcG9ydCB7IFNoYXBlIH0gZnJvbSBcIi4uL2NvbXBvbmVudHMvc2hhcGVcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBPYnN0YWNsZSBleHRlbmRzIFNoYXBlIHtcclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHg6IG51bWJlcixcclxuICAgIHk6IG51bWJlcixcclxuICAgIHdpZHRoOiBudW1iZXIsXHJcbiAgICBoZWlnaHQ6IG51bWJlcixcclxuICAgIHB1YmxpYyBoZWFsdGg6IEhlYWx0aFxyXG4gICkge1xyXG4gICAgc3VwZXIoeCwgeSwgd2lkdGgsIGhlaWdodCk7XHJcbiAgfVxyXG59XHJcbiIsImltcG9ydCB7IGRlZmF1bHRDb21wdXRlclBsYXllciB9IGZyb20gXCIuL21vZGVsL2NsYXNzZXMvY29tcHV0ZXJQbGF5ZXJcIjtcclxuaW1wb3J0IHsgZGVmYXVsdEh1bWFuUGxheWVyIH0gZnJvbSBcIi4vbW9kZWwvY2xhc3Nlcy9odW1hblBsYXllclwiO1xyXG5pbXBvcnQgeyBPYnN0YWNsZSB9IGZyb20gXCIuL21vZGVsL2NsYXNzZXMvb2JzdGFjbGVcIjtcclxuaW1wb3J0IHsgV29ybGQgfSBmcm9tIFwiLi9tb2RlbC9jbGFzc2VzL3dvcmxkXCI7XHJcbmltcG9ydCB7IEhlYWx0aCB9IGZyb20gXCIuL21vZGVsL2NvbXBvbmVudHMvaGVhbHRoXCI7XHJcblxyXG5jb25zdCBwbGF5ZXJzID0gW2RlZmF1bHRIdW1hblBsYXllciwgZGVmYXVsdENvbXB1dGVyUGxheWVyXTtcclxuXHJcbmNvbnN0IG9ic3RhY2xlcyA9IFtcclxuICBuZXcgT2JzdGFjbGUoMjAwLCAyMDAsIDUwLCA1MCwgbmV3IEhlYWx0aCgyMDApKSxcclxuICBuZXcgT2JzdGFjbGUoMzAwLCAzMDAsIDIwLCAxNTAsIG5ldyBIZWFsdGgoMjAwKSksXHJcbiAgbmV3IE9ic3RhY2xlKDYwMCwgNDAwLCA5MCwgNzAsIG5ldyBIZWFsdGgoMjAwKSksXHJcbl07XHJcblxyXG5jb25zdCB3b3JsZCA9IG5ldyBXb3JsZCgpO1xyXG5cclxuZXhwb3J0IGNvbnN0IGRlZmF1bHRDb25maWcgPSB7XHJcbiAgcGxheWVycyxcclxuICBvYnN0YWNsZXMsXHJcbiAgd29ybGQsXHJcbn07XHJcbiIsImltcG9ydCB7IFNoYXBlIH0gZnJvbSBcIi4uL2NvbXBvbmVudHMvc2hhcGVcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBXb3JsZCBleHRlbmRzIFNoYXBlIHtcclxuICBjb25zdHJ1Y3Rvcih3aWR0aDogbnVtYmVyID0gODAwLCBoZWlnaHQ6IG51bWJlciA9IDUwMCkge1xyXG4gICAgc3VwZXIoMCwgMCwgd2lkdGgsIGhlaWdodCk7XHJcbiAgfVxyXG59XHJcbiIsImltcG9ydCB7IGRlZmF1bHRDb25maWcgfSBmcm9tIFwiLi9kZWZhdWx0R2FtZVNldHVwXCI7XHJcblxyXG5jb25zdCBnYW1lID0ge1xyXG4gIC4uLmRlZmF1bHRDb25maWcsXHJcbn07XHJcblxyXG5jb25zdCB7IHdvcmxkLCBwbGF5ZXJzLCBvYnN0YWNsZXMgfSA9IGRlZmF1bHRDb25maWc7XHJcbmNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJjYW52YXNcIikhO1xyXG5jb25zdCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpITtcclxuY2FudmFzLmhlaWdodCA9IHdvcmxkLmhlaWdodDtcclxuY2FudmFzLndpZHRoID0gd29ybGQud2lkdGg7XHJcblxyXG4vKipcclxuICogVE9ETzogUHV0IFwiZHJhd1wiL1wicmVuZGVyXCIgbWV0aG9kIG9uIFwiU2hhcGVcIiBjbGFzc1xyXG4gKiBhbmQgaGF2ZSBhbGwgc3ViY2xhc3NlcyAoU2hvdCwgTW92YWJsZVNoYXBlLCBIdW1hblBsYXllcixcclxuICogQ29tcHV0ZXJQbGF5ZXIpIG92ZXJyaWRlIHdpdGggdGhlaXIgaW1wbGVtZW50YXRpb25cclxuICogKGRlcGVuZGluZyBvbiBob3cgdGhleSB3YW50IHRvIGJlIHJlbmRlcmVkIG9uIHRoZSBjYW52YXMpLlxyXG4gKiBUaGVuIHRoZSBjYWxsZXIgY2FuIGp1c3QgY2FsbCBcImRyYXdcIiBtZXRob2QgYW5kIHRoZSBjbGFzc2VzXHJcbiAqIHRoZW1zZWx2ZXMgY2FuIGJlIHJlc3BvbnNpYmxlIGZvciBob3cgdGhleSdyZSByZXByZXNlbnRlZC5cclxuICovXHJcbmNvbnN0IHVwZGF0ZSA9IGFzeW5jICgpID0+IHtcclxuICBjdHguY2xlYXJSZWN0KDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7XHJcblxyXG4gIGZvciAoY29uc3Qgb2JzdGFjbGUgb2Ygb2JzdGFjbGVzKSB7XHJcbiAgICAvLyBPYnN0YWNsZVxyXG4gICAgY3R4LmZpbGxTdHlsZSA9IFwiIzcwNDMwMFwiO1xyXG4gICAgY3R4LmZpbGxSZWN0KG9ic3RhY2xlLngsIG9ic3RhY2xlLnksIG9ic3RhY2xlLndpZHRoLCBvYnN0YWNsZS5oZWlnaHQpO1xyXG5cclxuICAgIGNvbnN0IHsgY3VycmVudEhlYWx0aCB9ID0gb2JzdGFjbGUuaGVhbHRoO1xyXG5cclxuICAgIC8vIE9ic3RhY2xlIEhQIGJhclxyXG4gICAgY3R4LmZpbGxTdHlsZSA9XHJcbiAgICAgIGN1cnJlbnRIZWFsdGggPiA2MCA/IFwiZ3JlZW5cIiA6IGN1cnJlbnRIZWFsdGggPiA0MCA/IFwieWVsbG93XCIgOiBcInJlZFwiO1xyXG4gICAgY3R4LmZpbGxSZWN0KFxyXG4gICAgICBvYnN0YWNsZS54LFxyXG4gICAgICBvYnN0YWNsZS55IC0gNDAsXHJcbiAgICAgIG9ic3RhY2xlLmhlYWx0aC5jdXJyZW50SGVhbHRoQXNQZXJjZW50YWdlICogb2JzdGFjbGUud2lkdGgsXHJcbiAgICAgIDIwXHJcbiAgICApO1xyXG4gICAgY3R4LnN0cm9rZVN0eWxlID0gXCJibGFja1wiO1xyXG4gICAgY3R4LmxpbmVXaWR0aCA9IDI7XHJcbiAgICBjdHguc3Ryb2tlUmVjdChvYnN0YWNsZS54LCBvYnN0YWNsZS55IC0gNDAsIG9ic3RhY2xlLndpZHRoLCAyMCk7XHJcbiAgfVxyXG5cclxuICBmb3IgKGNvbnN0IHBsYXllciBvZiBwbGF5ZXJzKSB7XHJcbiAgICBwbGF5ZXIubW92ZSgpO1xyXG5cclxuICAgIC8vIFRPRE86IHRoaXMgaXMgcXVhZHJhdGljIGJlaGF2aW91ciAoYW5kIHdpbGwgc2NhbGUgcG9vcmx5KSwgYnV0IG1pZ2h0IG5vdCBoYXZlIGVub3VnaFxyXG4gICAgLy8gb2JqZWN0cy9jb21wYXJpc29ucyB0byB3YXJyYW50IGEgbW9yZSBlZmZpY2llbnQgc3RydWN0dXJlXHJcbiAgICAvLyBlLmcgcXVhZHRyZWUsIG9jdG90cmVlLlxyXG4gICAgaWYgKHBsYXllci5leHRlbmRzQmV5b25kKHdvcmxkKSB8fCBwbGF5ZXIuY29sbGlkZXNXaXRoQW55KC4uLm9ic3RhY2xlcykpIHtcclxuICAgICAgcGxheWVyLm1vdmVCYWNrKCk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgeyBjdXJyZW50SGVhbHRoIH0gPSBwbGF5ZXIuaGVhbHRoO1xyXG5cclxuICAgIC8vIFBsYXllciBzcHJpdGVcclxuICAgIGN0eC5maWxsU3R5bGUgPSBcInJlZFwiO1xyXG4gICAgY3R4LmZpbGxSZWN0KHBsYXllci54LCBwbGF5ZXIueSwgcGxheWVyLndpZHRoLCBwbGF5ZXIuaGVpZ2h0KTtcclxuXHJcbiAgICAvLyBQbGF5ZXIgSFAgYmFyXHJcbiAgICBjdHguZmlsbFN0eWxlID1cclxuICAgICAgY3VycmVudEhlYWx0aCA+IDYwID8gXCJncmVlblwiIDogY3VycmVudEhlYWx0aCA+IDQwID8gXCJ5ZWxsb3dcIiA6IFwicmVkXCI7XHJcbiAgICBjdHguZmlsbFJlY3QoXHJcbiAgICAgIHBsYXllci54LFxyXG4gICAgICBwbGF5ZXIueSAtIDQwLFxyXG4gICAgICBwbGF5ZXIuaGVhbHRoLmN1cnJlbnRIZWFsdGhBc1BlcmNlbnRhZ2UgKiBwbGF5ZXIud2lkdGgsXHJcbiAgICAgIDIwXHJcbiAgICApO1xyXG4gICAgY3R4LnN0cm9rZVN0eWxlID0gXCJibGFja1wiO1xyXG4gICAgY3R4LmxpbmVXaWR0aCA9IDI7XHJcbiAgICBjdHguc3Ryb2tlUmVjdChwbGF5ZXIueCwgcGxheWVyLnkgLSA0MCwgcGxheWVyLndpZHRoLCAyMCk7XHJcblxyXG4gICAgLy8gVXBkYXRlXHJcbiAgICBmb3IgKGNvbnN0IHNob3Qgb2YgcGxheWVyLnNob290ZXIuc2hvdHNGaXJlZCkge1xyXG4gICAgICBzaG90Lm1vdmUoKTtcclxuXHJcbiAgICAgIGlmIChcclxuICAgICAgICAvLyBDaGVjayBpZiBzaG90IGNvbGxpZGVzIHdpdGggb2JzdGFjbGVzP1xyXG4gICAgICAgIHNob3QuY29sbGlkZXNXaXRoQW55KC4uLm9ic3RhY2xlcykgfHxcclxuICAgICAgICAvLyBUT0RPOiBOZWVkIGEgY29udmVuaWVuY2UgbWV0aG9kIGhlcmVcclxuICAgICAgICAvLyBDaGVjayBpZiBzaG90IGNvbGxpZGVzIHdpdGggcGxheWVyP1xyXG4gICAgICAgIHNob3QuY29sbGlkZXNXaXRoQW55KC4uLnBsYXllcnMuZmlsdGVyKChwKSA9PiBwICE9PSBwbGF5ZXIpKVxyXG4gICAgICApIHtcclxuICAgICAgICAvLyBjb25zb2xlLmxvZyhcInNob3QgY29sbGlkZWQgd2l0aFwiLCBzaG90KTtcclxuICAgICAgICBwbGF5ZXIuc2hvb3Rlci5yZW1vdmUoc2hvdCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGN0eC5maWxsU3R5bGUgPSBcImdvbGRlbnJvZFwiO1xyXG4gICAgICBjdHguZmlsbFJlY3Qoc2hvdC54LCBzaG90LnksIDcsIDcpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgMWUzKSk7XHJcbiAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKHVwZGF0ZSk7XHJcbn07XHJcblxyXG51cGRhdGUoKTtcclxuIl0sInNvdXJjZVJvb3QiOiIifQ==