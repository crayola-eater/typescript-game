(()=>{"use strict";class t{constructor(t,e=t){this.maxHealth=t,this.currentHealth=e}changeHealthBy(t){this.currentHealth+=t}get isDead(){return 0===this.currentHealth}get currentHealthAsPercentage(){return this.currentHealth/this.maxHealth}}class e{constructor(t,e,s,i){this.x=t,this.y=e,this.width=s,this.height=i}collidesWith(t){return this.topLeft.x<t.bottomRight.x&&this.bottomRight.x>t.topLeft.x&&this.topLeft.y<t.bottomRight.y&&this.bottomRight.y>t.topRight.y}extendsBeyond(t){return this.topLeft.x<t.topLeft.x||this.bottomRight.x>t.bottomRight.x||this.topLeft.y<t.topLeft.y||this.bottomRight.y>t.bottomRight.y}get topLeft(){return{x:this.x,y:this.y}}get topRight(){return{x:this.x+this.width,y:this.y}}get bottomLeft(){return{x:this.x,y:this.y+this.height}}get bottomRight(){return{x:this.x+this.width,y:this.y+this.height}}get center(){return{x:this.x+this.width/2,y:this.y+this.height/2}}}var s,i,n=function(t,e,s){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,s),s};class h extends e{constructor(t,e,h,o,r=0,a=0){super(t,e,h,o),this._deltaX=r,this._deltaY=a,s.set(this,void 0),i.set(this,void 0),n(this,s,0),n(this,i,0)}get deltaX(){return this._deltaX}set deltaX(t){var e;e=this,[{set value(t){n(e,s,t)}}.value,this._deltaX]=[this._deltaX,t]}get deltaY(){return this._deltaY}set deltaY(t){var e;e=this,[{set value(t){n(e,i,t)}}.value,this._deltaY]=[this._deltaY,t]}moveBy(t,e){this.x+=t,this.y+=e}move(){this.x+=this.deltaX,this.y+=this.deltaY}undoMove(){this.moveBy(-this.deltaX,-this.deltaY)}}s=new WeakMap,i=new WeakMap;class o extends h{constructor(t,e,s=5,i=5,n=15,h=10){super(t.x,t.y,s,i,0,0),this.speed=n,this.damage=h;const o={deltaX:e.x-t.x,deltaY:e.y-t.y},r=Math.atan2(o.deltaY,o.deltaX);this.deltaX=Math.cos(r)*n,this.deltaY=Math.sin(r)*n}}class r{constructor(){this.shotsFired=[]}shoot(t,e){const s=new o(t,e);this.shotsFired.push(s)}remove(t){this.shotsFired=this.shotsFired.filter((e=>t!==e))}}var a,l=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};class c extends h{constructor(t,e,s,i,n=100,h=100){super(t,e,n,h),this.health=s,this.shooter=i,a.set(this,void 0);const o=(new Date).getTime();!function(t,e,s){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");e.set(t,s)}(this,a,{changedDeltaX:o,changedDeltaY:o,shot:o})}get shouldChangeDirection(){return(new Date).getTime()>l(this,a).changedDeltaX+100}maybeChangeDirection(){if(this.shouldChangeDirection){const t=Math.random()<.5?-1:1;this.deltaX=5*Math.random()*t;const e=Math.random()<.5?-1:1;this.deltaY=5*Math.random()*e;const s=(new Date).getTime();l(this,a).changedDeltaX=s,l(this,a).changedDeltaY=s}}move(){this.maybeChangeDirection(),super.move()}}a=new WeakMap;const d=function(){const e=new t(100),s=new r;return new c(600,200,e,s)}();var u,y=function(t,e,s){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,s),s},p=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};class w{constructor(t,e){u.set(this,void 0),this.inputs={KeyW:!1,KeyA:!1,KeyS:!1,KeyD:!1,LMB:!1},y(this,u,((t,e)=>console.log({input:t,newValue:e})));const s=t=>{this.inputs.LMB="mousedown"===t.type,p(this,u).call(this,"LMB",this.inputs.LMB,t)},i=t=>{const{code:e}=t;this.inputs.hasOwnProperty(e)&&(this.inputs[e]="keydown"===t.type,p(this,u).call(this,e,this.inputs[e],t))};t.addEventListener("mouseup",s),t.addEventListener("mousedown",s),e.addEventListener("keyup",i),e.addEventListener("keydown",i)}set onInputHandler(t){y(this,u,t)}}u=new WeakMap;var g,f=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};class m extends h{constructor(t,e,s,i,n,h=100,o=100,r=0,a=0){super(t,e,h,o,r,a),this.health=s,this.controls=i,this.shooter=n,g.set(this,void 0),this.controls.onInputHandler=(t,e,s)=>{"LMB"===t&&e&&this.shooter.shoot({x:this.center.x,y:this.center.y},{x:s.x,y:s.y})},function(t,e,s){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");e.set(t,s)}(this,g,5)}move(){this.controls.inputs.KeyW?this.deltaY=-f(this,g):this.controls.inputs.KeyS?this.deltaY=f(this,g):this.deltaY=0,this.controls.inputs.KeyA?this.deltaX=-f(this,g):this.controls.inputs.KeyD?this.deltaX=f(this,g):this.deltaX=0,super.move()}}g=new WeakMap;const v=function(){const e=new t(100),s=new w(document.querySelector("canvas"),window),i=new r;return new m(300,100,e,s,i)}();class x extends e{constructor(t,e,s,i,n){super(t,e,s,i),this.health=n}}const b={players:[v,d],obstacles:[new x(200,200,50,50,new t(200)),new x(300,300,20,150,new t(200)),new x(600,400,90,70,new t(200))],world:new class extends e{constructor(t=800,e=500){super(0,0,t,e)}}};Object.assign({},b);const{world:M,players:R,obstacles:L}=b,X=document.querySelector("canvas"),Y=X.getContext("2d");X.height=M.height,X.width=M.width;const D=()=>{return t=void 0,e=void 0,i=function*(){Y.clearRect(0,0,X.width,X.height);for(const t of L){Y.fillStyle="#704300",Y.fillRect(t.x,t.y,t.width,t.height);const{currentHealth:e}=t.health;Y.fillStyle=e>60?"green":e>40?"yellow":"red",Y.fillRect(t.x,t.y-40,t.health.currentHealthAsPercentage*t.width,20),Y.strokeStyle="black",Y.lineWidth=2,Y.strokeRect(t.x,t.y-40,t.width,20)}for(const t of R){t.move(),L.some((e=>{if(e.collidesWith(t))return console.log("Collision between player and obstacle."),!0}))&&t.undoMove();const{currentHealth:e}=t.health;Y.fillStyle="red",Y.fillRect(t.x,t.y,t.width,t.height),Y.fillStyle=e>60?"green":e>40?"yellow":"red",Y.fillRect(t.x,t.y-40,t.health.currentHealthAsPercentage*t.width,20),Y.strokeStyle="black",Y.lineWidth=2,Y.strokeRect(t.x,t.y-40,t.width,20);for(const e of t.shooter.shotsFired)e.move(),Y.fillStyle="goldenrod",Y.fillRect(e.x,e.y,7,7)}requestAnimationFrame(D)},new((s=void 0)||(s=Promise))((function(n,h){function o(t){try{a(i.next(t))}catch(t){h(t)}}function r(t){try{a(i.throw(t))}catch(t){h(t)}}function a(t){var e;t.done?n(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(o,r)}a((i=i.apply(t,e||[])).next())}));var t,e,s,i};D()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zbWFsbC1nYW1lLy4vc3JjL21vZGVsL2NvbXBvbmVudHMvaGVhbHRoLnRzIiwid2VicGFjazovL3NtYWxsLWdhbWUvLi9zcmMvbW9kZWwvY29tcG9uZW50cy9zaGFwZS50cyIsIndlYnBhY2s6Ly9zbWFsbC1nYW1lLy4vc3JjL21vZGVsL2NvbXBvbmVudHMvbW92YWJsZVNoYXBlLnRzIiwid2VicGFjazovL3NtYWxsLWdhbWUvLi9zcmMvbW9kZWwvY29tcG9uZW50cy9zaG90LnRzIiwid2VicGFjazovL3NtYWxsLWdhbWUvLi9zcmMvbW9kZWwvY29tcG9uZW50cy9zaG9vdGVyLnRzIiwid2VicGFjazovL3NtYWxsLWdhbWUvLi9zcmMvbW9kZWwvY2xhc3Nlcy9jb21wdXRlclBsYXllci50cyIsIndlYnBhY2s6Ly9zbWFsbC1nYW1lLy4vc3JjL21vZGVsL2NvbXBvbmVudHMvY29udHJvbHMudHMiLCJ3ZWJwYWNrOi8vc21hbGwtZ2FtZS8uL3NyYy9tb2RlbC9jbGFzc2VzL2h1bWFuUGxheWVyLnRzIiwid2VicGFjazovL3NtYWxsLWdhbWUvLi9zcmMvbW9kZWwvY2xhc3Nlcy9vYnN0YWNsZS50cyIsIndlYnBhY2s6Ly9zbWFsbC1nYW1lLy4vc3JjL2RlZmF1bHRHYW1lU2V0dXAudHMiLCJ3ZWJwYWNrOi8vc21hbGwtZ2FtZS8uL3NyYy9tb2RlbC9jbGFzc2VzL3dvcmxkLnRzIiwid2VicGFjazovL3NtYWxsLWdhbWUvLi9zcmMvaW5kZXgudHMiXSwibmFtZXMiOlsiSGVhbHRoIiwibWF4SGVhbHRoIiwiY3VycmVudEhlYWx0aCIsImNoYW5nZSIsInRoaXMiLCJTaGFwZSIsIngiLCJ5Iiwid2lkdGgiLCJoZWlnaHQiLCJvdGhlclNoYXBlIiwidG9wTGVmdCIsImJvdHRvbVJpZ2h0IiwidG9wUmlnaHQiLCJNb3ZhYmxlU2hhcGUiLCJfZGVsdGFYIiwiX2RlbHRhWSIsInN1cGVyIiwibmV3RGVsdGFYIiwibmV3RGVsdGFZIiwiZGVsdGFYIiwiZGVsdGFZIiwibW92ZUJ5IiwiU2hvdCIsImZyb20iLCJ0byIsInNwZWVkIiwiZGFtYWdlIiwib3JpZ2luYWxEZWx0YSIsInJhZGlhbnMiLCJNYXRoIiwiYXRhbjIiLCJjb3MiLCJzaW4iLCJTaG9vdGVyIiwic2hvdHNGaXJlZCIsImF0Iiwic2hvdCIsInB1c2giLCJzaG90VG9SZW1vdmUiLCJmaWx0ZXIiLCJDb21wdXRlclBsYXllciIsImhlYWx0aCIsInNob290ZXIiLCJjdXJyZW50VGltZSIsIkRhdGUiLCJnZXRUaW1lIiwiY2hhbmdlZERlbHRhWCIsImNoYW5nZWREZWx0YVkiLCJzaG91bGRDaGFuZ2VEaXJlY3Rpb24iLCJsZWZ0T3JSaWdodCIsInJhbmRvbSIsInVwT3JEb3duIiwibWF5YmVDaGFuZ2VEaXJlY3Rpb24iLCJtb3ZlIiwiZGVmYXVsdENvbXB1dGVyUGxheWVyIiwiY3JlYXRlRGVmYXVsdENvbXB1dGVyUGxheWVyIiwiQ29udHJvbHMiLCJjYW52YXMiLCJ3aW5kb3ciLCJpbnB1dHMiLCJLZXlXIiwiS2V5QSIsIktleVMiLCJLZXlEIiwiTE1CIiwiaW5wdXQiLCJuZXdWYWx1ZSIsImNvbnNvbGUiLCJsb2ciLCJjbGlja0xpc3RlbmVyIiwiZSIsInR5cGUiLCJrZXlMaXN0ZW5lciIsImNvZGUiLCJoYXNPd25Qcm9wZXJ0eSIsImFkZEV2ZW50TGlzdGVuZXIiLCJuZXdIYW5kbGVyIiwiSHVtYW5QbGF5ZXIiLCJjb250cm9scyIsIm9uSW5wdXRIYW5kbGVyIiwibmV3U3RhdGUiLCJldmVudCIsInNob290IiwiY2VudGVyIiwiZGVmYXVsdEh1bWFuUGxheWVyIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiY3JlYXRlRGVmYXVsdEh1bWFuUGxheWVyIiwiT2JzdGFjbGUiLCJkZWZhdWx0Q29uZmlnIiwicGxheWVycyIsIm9ic3RhY2xlcyIsIndvcmxkIiwiY3R4IiwiZ2V0Q29udGV4dCIsInVwZGF0ZSIsImNsZWFyUmVjdCIsIm9ic3RhY2xlIiwiZmlsbFN0eWxlIiwiZmlsbFJlY3QiLCJjdXJyZW50SGVhbHRoQXNQZXJjZW50YWdlIiwic3Ryb2tlU3R5bGUiLCJsaW5lV2lkdGgiLCJzdHJva2VSZWN0IiwicGxheWVyIiwic29tZSIsImNvbGxpZGVzV2l0aCIsInVuZG9Nb3ZlIiwicmVxdWVzdEFuaW1hdGlvbkZyYW1lIl0sIm1hcHBpbmdzIjoibUJBQU8sTUFBTUEsRUFDWCxZQUNTQyxFQUNBQyxFQUF3QkQsR0FEeEIsS0FBQUEsWUFDQSxLQUFBQyxnQkFHVCxlQUFlQyxHQUNiQyxLQUFLRixlQUFpQkMsRUFHeEIsYUFDRSxPQUE4QixJQUF2QkMsS0FBS0YsY0FHZCxnQ0FDRSxPQUFPRSxLQUFLRixjQUFnQkUsS0FBS0gsV0NOOUIsTUFBTUksRUFDWCxZQUNTQyxFQUNBQyxFQUNBQyxFQUNBQyxHQUhBLEtBQUFILElBQ0EsS0FBQUMsSUFDQSxLQUFBQyxRQUNBLEtBQUFDLFNBR1QsYUFBYUMsR0FDWCxPQUNFTixLQUFLTyxRQUFRTCxFQUFJSSxFQUFXRSxZQUFZTixHQUN4Q0YsS0FBS1EsWUFBWU4sRUFBSUksRUFBV0MsUUFBUUwsR0FDeENGLEtBQUtPLFFBQVFKLEVBQUlHLEVBQVdFLFlBQVlMLEdBQ3hDSCxLQUFLUSxZQUFZTCxFQUFJRyxFQUFXRyxTQUFTTixFQUk3QyxjQUFjRyxHQUNaLE9BQ0VOLEtBQUtPLFFBQVFMLEVBQUlJLEVBQVdDLFFBQVFMLEdBQ3BDRixLQUFLUSxZQUFZTixFQUFJSSxFQUFXRSxZQUFZTixHQUM1Q0YsS0FBS08sUUFBUUosRUFBSUcsRUFBV0MsUUFBUUosR0FDcENILEtBQUtRLFlBQVlMLEVBQUlHLEVBQVdFLFlBQVlMLEVBSWhELGNBQ0UsTUFBTyxDQUNMRCxFQUFHRixLQUFLRSxFQUNSQyxFQUFHSCxLQUFLRyxHQUlaLGVBQ0UsTUFBTyxDQUNMRCxFQUFHRixLQUFLRSxFQUFJRixLQUFLSSxNQUNqQkQsRUFBR0gsS0FBS0csR0FJWixpQkFDRSxNQUFPLENBQ0xELEVBQUdGLEtBQUtFLEVBQ1JDLEVBQUdILEtBQUtHLEVBQUlILEtBQUtLLFFBSXJC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LElBRzlELElBQUssTUFBTWlHLEtBQVUsRUFBUyxDQUM1QkEsRUFBT25ELE9BRUwsRUFBVW9ELE1BQU1SLElBQ2QsR0FBSUEsRUFBU1MsYUFBYUYsR0FFeEIsT0FEQXJDLFFBQVFDLElBQUksMkNBQ0wsTUFJWG9DLEVBQU9HLFdBR1QsTUFBTSxjQUFFMUcsR0FBa0J1RyxFQUFPL0QsT0FHakNvRCxFQUFJSyxVQUFZLE1BQ2hCTCxFQUFJTSxTQUFTSyxFQUFPbkcsRUFBR21HLEVBQU9sRyxFQUFHa0csRUFBT2pHLE1BQU9pRyxFQUFPaEcsUUFHdERxRixFQUFJSyxVQUNGakcsRUFBZ0IsR0FBSyxRQUFVQSxFQUFnQixHQUFLLFNBQVcsTUFDakU0RixFQUFJTSxTQUNGSyxFQUFPbkcsRUFDUG1HLEVBQU9sRyxFQUFJLEdBQ1hrRyxFQUFPL0QsT0FBTzJELDBCQUE0QkksRUFBT2pHLE1BQ2pELElBRUZzRixFQUFJUSxZQUFjLFFBQ2xCUixFQUFJUyxVQUFZLEVBQ2hCVCxFQUFJVSxXQUFXQyxFQUFPbkcsRUFBR21HLEVBQU9sRyxFQUFJLEdBQUlrRyxFQUFPakcsTUFBTyxJQUV0RCxJQUFLLE1BQU02QixLQUFRb0UsRUFBTzlELFFBQVFSLFdBQ2hDRSxFQUFLaUIsT0FDTHdDLEVBQUlLLFVBQVksWUFDaEJMLEVBQUlNLFNBQVMvRCxFQUFLL0IsRUFBRytCLEVBQUs5QixFQUFHLEVBQUcsR0FLcENzRyxzQkFBc0JiLEksWUFoRUUsSywrUUFtRTFCQSxLIiwiZmlsZSI6ImJ1bmRsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBjbGFzcyBIZWFsdGgge1xyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHVibGljIG1heEhlYWx0aDogbnVtYmVyLFxyXG4gICAgcHVibGljIGN1cnJlbnRIZWFsdGg6IG51bWJlciA9IG1heEhlYWx0aFxyXG4gICkge31cclxuXHJcbiAgY2hhbmdlSGVhbHRoQnkoY2hhbmdlOiBudW1iZXIpIHtcclxuICAgIHRoaXMuY3VycmVudEhlYWx0aCArPSBjaGFuZ2U7XHJcbiAgfVxyXG5cclxuICBnZXQgaXNEZWFkKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuY3VycmVudEhlYWx0aCA9PT0gMDtcclxuICB9XHJcblxyXG4gIGdldCBjdXJyZW50SGVhbHRoQXNQZXJjZW50YWdlKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuY3VycmVudEhlYWx0aCAvIHRoaXMubWF4SGVhbHRoO1xyXG4gIH1cclxufVxyXG4iLCJpbXBvcnQgeyBJUG9zaXRpb24gfSBmcm9tIFwiLi4vaW50ZXJmYWNlcy9wb3NpdGlvblwiO1xyXG5cclxuZXhwb3J0IGludGVyZmFjZSBTaGFwZU9wdGlvbnMge1xyXG4gIHg6IG51bWJlcjtcclxuICB5OiBudW1iZXI7XHJcbiAgaGVpZ2h0OiBudW1iZXI7XHJcbiAgd2lkdGg6IG51bWJlcjtcclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIFNoYXBlIHtcclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHB1YmxpYyB4OiBudW1iZXIsXHJcbiAgICBwdWJsaWMgeTogbnVtYmVyLFxyXG4gICAgcHVibGljIHdpZHRoOiBudW1iZXIsXHJcbiAgICBwdWJsaWMgaGVpZ2h0OiBudW1iZXJcclxuICApIHt9XHJcblxyXG4gIGNvbGxpZGVzV2l0aChvdGhlclNoYXBlOiBTaGFwZSk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIChcclxuICAgICAgdGhpcy50b3BMZWZ0LnggPCBvdGhlclNoYXBlLmJvdHRvbVJpZ2h0LnggJiZcclxuICAgICAgdGhpcy5ib3R0b21SaWdodC54ID4gb3RoZXJTaGFwZS50b3BMZWZ0LnggJiZcclxuICAgICAgdGhpcy50b3BMZWZ0LnkgPCBvdGhlclNoYXBlLmJvdHRvbVJpZ2h0LnkgJiZcclxuICAgICAgdGhpcy5ib3R0b21SaWdodC55ID4gb3RoZXJTaGFwZS50b3BSaWdodC55XHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgZXh0ZW5kc0JleW9uZChvdGhlclNoYXBlOiBTaGFwZSk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIChcclxuICAgICAgdGhpcy50b3BMZWZ0LnggPCBvdGhlclNoYXBlLnRvcExlZnQueCB8fFxyXG4gICAgICB0aGlzLmJvdHRvbVJpZ2h0LnggPiBvdGhlclNoYXBlLmJvdHRvbVJpZ2h0LnggfHxcclxuICAgICAgdGhpcy50b3BMZWZ0LnkgPCBvdGhlclNoYXBlLnRvcExlZnQueSB8fFxyXG4gICAgICB0aGlzLmJvdHRvbVJpZ2h0LnkgPiBvdGhlclNoYXBlLmJvdHRvbVJpZ2h0LnlcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBnZXQgdG9wTGVmdCgpOiBJUG9zaXRpb24ge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgeDogdGhpcy54LFxyXG4gICAgICB5OiB0aGlzLnksXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgZ2V0IHRvcFJpZ2h0KCk6IElQb3NpdGlvbiB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICB4OiB0aGlzLnggKyB0aGlzLndpZHRoLFxyXG4gICAgICB5OiB0aGlzLnksXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgZ2V0IGJvdHRvbUxlZnQoKTogSVBvc2l0aW9uIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHg6IHRoaXMueCxcclxuICAgICAgeTogdGhpcy55ICsgdGhpcy5oZWlnaHQsXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgZ2V0IGJvdHRvbVJpZ2h0KCk6IElQb3NpdGlvbiB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICB4OiB0aGlzLnggKyB0aGlzLndpZHRoLFxyXG4gICAgICB5OiB0aGlzLnkgKyB0aGlzLmhlaWdodCxcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBnZXQgY2VudGVyKCk6IElQb3NpdGlvbiB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICB4OiB0aGlzLnggKyB0aGlzLndpZHRoIC8gMixcclxuICAgICAgeTogdGhpcy55ICsgdGhpcy5oZWlnaHQgLyAyLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuIiwiaW1wb3J0IHsgU2hhcGUgfSBmcm9tIFwiLi9zaGFwZVwiO1xyXG5cclxuZXhwb3J0IGNsYXNzIE1vdmFibGVTaGFwZSBleHRlbmRzIFNoYXBlIHtcclxuICAjbGFzdERlbHRhWDogbnVtYmVyO1xyXG4gICNsYXN0RGVsdGFZOiBudW1iZXI7XHJcblxyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgeDogbnVtYmVyLFxyXG4gICAgeTogbnVtYmVyLFxyXG4gICAgd2lkdGg6IG51bWJlcixcclxuICAgIGhlaWdodDogbnVtYmVyLFxyXG4gICAgcHJpdmF0ZSBfZGVsdGFYOiBudW1iZXIgPSAwLFxyXG4gICAgcHJpdmF0ZSBfZGVsdGFZOiBudW1iZXIgPSAwXHJcbiAgKSB7XHJcbiAgICBzdXBlcih4LCB5LCB3aWR0aCwgaGVpZ2h0KTtcclxuICAgIHRoaXMuI2xhc3REZWx0YVggPSAwO1xyXG4gICAgdGhpcy4jbGFzdERlbHRhWSA9IDA7XHJcbiAgfVxyXG5cclxuICBnZXQgZGVsdGFYKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuX2RlbHRhWDtcclxuICB9XHJcblxyXG4gIHNldCBkZWx0YVgobmV3RGVsdGFYOiBudW1iZXIpIHtcclxuICAgIFt0aGlzLiNsYXN0RGVsdGFYLCB0aGlzLl9kZWx0YVhdID0gW3RoaXMuX2RlbHRhWCwgbmV3RGVsdGFYXTtcclxuICB9XHJcblxyXG4gIGdldCBkZWx0YVkoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fZGVsdGFZO1xyXG4gIH1cclxuXHJcbiAgc2V0IGRlbHRhWShuZXdEZWx0YVk6IG51bWJlcikge1xyXG4gICAgW3RoaXMuI2xhc3REZWx0YVksIHRoaXMuX2RlbHRhWV0gPSBbdGhpcy5fZGVsdGFZLCBuZXdEZWx0YVldO1xyXG4gIH1cclxuXHJcbiAgbW92ZUJ5KGRlbHRhWDogbnVtYmVyLCBkZWx0YVk6IG51bWJlcikge1xyXG4gICAgdGhpcy54ICs9IGRlbHRhWDtcclxuICAgIHRoaXMueSArPSBkZWx0YVk7XHJcbiAgfVxyXG5cclxuICBtb3ZlKCkge1xyXG4gICAgdGhpcy54ICs9IHRoaXMuZGVsdGFYO1xyXG4gICAgdGhpcy55ICs9IHRoaXMuZGVsdGFZO1xyXG4gIH1cclxuXHJcbiAgdW5kb01vdmUoKSB7XHJcbiAgICB0aGlzLm1vdmVCeSgtdGhpcy5kZWx0YVgsIC10aGlzLmRlbHRhWSk7XHJcblxyXG4gICAgLy8gdGhpcy5kZWx0YVggPSAtdGhpcy4jbGFzdERlbHRhWDtcclxuICAgIC8vIHRoaXMuZGVsdGFZID0gLXRoaXMuI2xhc3REZWx0YVk7XHJcbiAgfVxyXG59XHJcbiIsImltcG9ydCB7IE1vdmFibGVTaGFwZSB9IGZyb20gXCIuL21vdmFibGVTaGFwZVwiO1xyXG5pbXBvcnQgeyBJUG9zaXRpb24gfSBmcm9tIFwiLi4vaW50ZXJmYWNlcy9wb3NpdGlvblwiO1xyXG5cclxuZXhwb3J0IGNsYXNzIFNob3QgZXh0ZW5kcyBNb3ZhYmxlU2hhcGUge1xyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgZnJvbTogSVBvc2l0aW9uLFxyXG4gICAgdG86IElQb3NpdGlvbixcclxuICAgIHdpZHRoOiBudW1iZXIgPSA1LFxyXG4gICAgaGVpZ2h0OiBudW1iZXIgPSA1LFxyXG4gICAgcHVibGljIHNwZWVkOiBudW1iZXIgPSAxNSxcclxuICAgIHB1YmxpYyBkYW1hZ2U6IG51bWJlciA9IDEwXHJcbiAgKSB7XHJcbiAgICBzdXBlcihmcm9tLngsIGZyb20ueSwgd2lkdGgsIGhlaWdodCwgMCwgMCk7XHJcblxyXG4gICAgY29uc3Qgb3JpZ2luYWxEZWx0YSA9IHtcclxuICAgICAgZGVsdGFYOiB0by54IC0gZnJvbS54LCAvLyBBIGluIENBSFxyXG4gICAgICBkZWx0YVk6IHRvLnkgLSBmcm9tLnksIC8vIE8gaW4gU09IXHJcbiAgICB9O1xyXG5cclxuICAgIGNvbnN0IHJhZGlhbnMgPSBNYXRoLmF0YW4yKG9yaWdpbmFsRGVsdGEuZGVsdGFZLCBvcmlnaW5hbERlbHRhLmRlbHRhWCk7XHJcbiAgICB0aGlzLmRlbHRhWCA9IE1hdGguY29zKHJhZGlhbnMpICogc3BlZWQ7IC8vIENBSFxyXG4gICAgdGhpcy5kZWx0YVkgPSBNYXRoLnNpbihyYWRpYW5zKSAqIHNwZWVkOyAvLyBTT0hcclxuICB9XHJcbn1cclxuIiwiaW1wb3J0IHsgSVBvc2l0aW9uIH0gZnJvbSBcIi4uL2ludGVyZmFjZXMvcG9zaXRpb25cIjtcclxuaW1wb3J0IHsgU2hvdCB9IGZyb20gXCIuL3Nob3RcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBTaG9vdGVyIHtcclxuICBzaG90c0ZpcmVkOiBTaG90W107XHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICB0aGlzLnNob3RzRmlyZWQgPSBbXTtcclxuICB9XHJcblxyXG4gIHNob290KGZyb206IElQb3NpdGlvbiwgYXQ6IElQb3NpdGlvbikge1xyXG4gICAgY29uc3Qgc2hvdCA9IG5ldyBTaG90KGZyb20sIGF0KTtcclxuICAgIHRoaXMuc2hvdHNGaXJlZC5wdXNoKHNob3QpO1xyXG4gIH1cclxuXHJcbiAgcmVtb3ZlKHNob3RUb1JlbW92ZTogU2hvdCkge1xyXG4gICAgdGhpcy5zaG90c0ZpcmVkID0gdGhpcy5zaG90c0ZpcmVkLmZpbHRlcigoc2hvdCkgPT4gc2hvdFRvUmVtb3ZlICE9PSBzaG90KTtcclxuICB9XHJcbn1cclxuIiwiaW1wb3J0IHsgSGVhbHRoIH0gZnJvbSBcIi4uL2NvbXBvbmVudHMvaGVhbHRoXCI7XHJcbmltcG9ydCB7IE1vdmFibGVTaGFwZSB9IGZyb20gXCIuLi9jb21wb25lbnRzL21vdmFibGVTaGFwZVwiO1xyXG5pbXBvcnQgeyBTaG9vdGVyIH0gZnJvbSBcIi4uL2NvbXBvbmVudHMvc2hvb3RlclwiO1xyXG5cclxuZXhwb3J0IGNsYXNzIENvbXB1dGVyUGxheWVyIGV4dGVuZHMgTW92YWJsZVNoYXBlIHtcclxuICAjbGFzdEFjdGlvbnM6IHtcclxuICAgIGNoYW5nZWREZWx0YVg6IG51bWJlcjtcclxuICAgIGNoYW5nZWREZWx0YVk6IG51bWJlcjtcclxuICAgIHNob3Q6IG51bWJlcjtcclxuICB9O1xyXG5cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHg6IG51bWJlcixcclxuICAgIHk6IG51bWJlcixcclxuICAgIHB1YmxpYyBoZWFsdGg6IEhlYWx0aCxcclxuICAgIHB1YmxpYyBzaG9vdGVyOiBTaG9vdGVyLFxyXG4gICAgd2lkdGg6IG51bWJlciA9IDEwMCxcclxuICAgIGhlaWdodDogbnVtYmVyID0gMTAwXHJcbiAgKSB7XHJcbiAgICBzdXBlcih4LCB5LCB3aWR0aCwgaGVpZ2h0KTtcclxuXHJcbiAgICBjb25zdCBjdXJyZW50VGltZSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xyXG4gICAgdGhpcy4jbGFzdEFjdGlvbnMgPSB7XHJcbiAgICAgIGNoYW5nZWREZWx0YVg6IGN1cnJlbnRUaW1lLFxyXG4gICAgICBjaGFuZ2VkRGVsdGFZOiBjdXJyZW50VGltZSxcclxuICAgICAgc2hvdDogY3VycmVudFRpbWUsXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgZ2V0IHNob3VsZENoYW5nZURpcmVjdGlvbigpIHtcclxuICAgIHJldHVybiBuZXcgRGF0ZSgpLmdldFRpbWUoKSA+IHRoaXMuI2xhc3RBY3Rpb25zLmNoYW5nZWREZWx0YVggKyAxMDA7XHJcbiAgfVxyXG5cclxuICBtYXliZUNoYW5nZURpcmVjdGlvbigpIHtcclxuICAgIGlmICh0aGlzLnNob3VsZENoYW5nZURpcmVjdGlvbikge1xyXG4gICAgICBjb25zdCBsZWZ0T3JSaWdodCA9IE1hdGgucmFuZG9tKCkgPCAwLjUgPyAtMSA6IDE7XHJcbiAgICAgIHRoaXMuZGVsdGFYID0gTWF0aC5yYW5kb20oKSAqIDUgKiBsZWZ0T3JSaWdodDtcclxuXHJcbiAgICAgIGNvbnN0IHVwT3JEb3duID0gTWF0aC5yYW5kb20oKSA8IDAuNSA/IC0xIDogMTtcclxuICAgICAgdGhpcy5kZWx0YVkgPSBNYXRoLnJhbmRvbSgpICogNSAqIHVwT3JEb3duO1xyXG5cclxuICAgICAgY29uc3QgY3VycmVudFRpbWUgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcclxuICAgICAgdGhpcy4jbGFzdEFjdGlvbnMuY2hhbmdlZERlbHRhWCA9IGN1cnJlbnRUaW1lO1xyXG4gICAgICB0aGlzLiNsYXN0QWN0aW9ucy5jaGFuZ2VkRGVsdGFZID0gY3VycmVudFRpbWU7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBtb3ZlKCkge1xyXG4gICAgdGhpcy5tYXliZUNoYW5nZURpcmVjdGlvbigpO1xyXG4gICAgc3VwZXIubW92ZSgpO1xyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gY3JlYXRlRGVmYXVsdENvbXB1dGVyUGxheWVyKCkge1xyXG4gIGNvbnN0IGhlYWx0aCA9IG5ldyBIZWFsdGgoMTAwKTtcclxuICBjb25zdCBzaG9vdGVyID0gbmV3IFNob290ZXIoKTtcclxuICByZXR1cm4gbmV3IENvbXB1dGVyUGxheWVyKDYwMCwgMjAwLCBoZWFsdGgsIHNob290ZXIpO1xyXG59XHJcblxyXG5leHBvcnQgY29uc3QgZGVmYXVsdENvbXB1dGVyUGxheWVyID0gY3JlYXRlRGVmYXVsdENvbXB1dGVyUGxheWVyKCk7XHJcbiIsImludGVyZmFjZSBDb250cm9sTWFwIHtcclxuICBbY29udHJvbDogc3RyaW5nXTogYm9vbGVhbjtcclxufVxyXG5cclxudHlwZSBpbnB1dEhhbmRsZXIgPSAoXHJcbiAgaW5wdXQ6IHN0cmluZyxcclxuICBuZXdTdGF0ZTogYm9vbGVhbixcclxuICBlOiBNb3VzZUV2ZW50IHwgS2V5Ym9hcmRFdmVudFxyXG4pID0+IHZvaWQ7XHJcblxyXG5leHBvcnQgY2xhc3MgQ29udHJvbHMge1xyXG4gIGlucHV0czogQ29udHJvbE1hcDtcclxuICAjb25JbnB1dDogaW5wdXRIYW5kbGVyO1xyXG5cclxuICBjb25zdHJ1Y3RvcihjYW52YXM6IEhUTUxDYW52YXNFbGVtZW50LCB3aW5kb3c6IFdpbmRvdykge1xyXG4gICAgLy8gTWlnaHQgYmUgd29ydGggc2V0dGluZyB0aGlzIG9iamVjdCB1cCBhcyBhIHByb3h5P1xyXG4gICAgdGhpcy5pbnB1dHMgPSB7XHJcbiAgICAgIEtleVc6IGZhbHNlLFxyXG4gICAgICBLZXlBOiBmYWxzZSxcclxuICAgICAgS2V5UzogZmFsc2UsXHJcbiAgICAgIEtleUQ6IGZhbHNlLFxyXG4gICAgICBMTUI6IGZhbHNlLFxyXG4gICAgfTtcclxuICAgIHRoaXMuI29uSW5wdXQgPSAoaW5wdXQsIG5ld1ZhbHVlKSA9PiBjb25zb2xlLmxvZyh7IGlucHV0LCBuZXdWYWx1ZSB9KTtcclxuXHJcbiAgICBjb25zdCBjbGlja0xpc3RlbmVyID0gKGU6IE1vdXNlRXZlbnQpID0+IHtcclxuICAgICAgdGhpcy5pbnB1dHMuTE1CID0gZS50eXBlID09PSBcIm1vdXNlZG93blwiO1xyXG4gICAgICB0aGlzLiNvbklucHV0KFwiTE1CXCIsIHRoaXMuaW5wdXRzLkxNQiwgZSk7XHJcbiAgICB9O1xyXG5cclxuICAgIGNvbnN0IGtleUxpc3RlbmVyID0gKGU6IEtleWJvYXJkRXZlbnQpID0+IHtcclxuICAgICAgY29uc3QgeyBjb2RlIH0gPSBlO1xyXG4gICAgICBpZiAodGhpcy5pbnB1dHMuaGFzT3duUHJvcGVydHkoY29kZSkpIHtcclxuICAgICAgICB0aGlzLmlucHV0c1tjb2RlXSA9IGUudHlwZSA9PT0gXCJrZXlkb3duXCI7XHJcbiAgICAgICAgdGhpcy4jb25JbnB1dChjb2RlLCB0aGlzLmlucHV0c1tjb2RlXSwgZSk7XHJcbiAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZXVwXCIsIGNsaWNrTGlzdGVuZXIpO1xyXG4gICAgY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgY2xpY2tMaXN0ZW5lcik7XHJcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcImtleXVwXCIsIGtleUxpc3RlbmVyKTtcclxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBrZXlMaXN0ZW5lcik7XHJcbiAgfVxyXG5cclxuICBzZXQgb25JbnB1dEhhbmRsZXIobmV3SGFuZGxlcjogaW5wdXRIYW5kbGVyKSB7XHJcbiAgICB0aGlzLiNvbklucHV0ID0gbmV3SGFuZGxlcjtcclxuICB9XHJcbn1cclxuIiwiaW1wb3J0IHsgQ29udHJvbHMgfSBmcm9tIFwiLi4vY29tcG9uZW50cy9jb250cm9sc1wiO1xyXG5pbXBvcnQgeyBIZWFsdGggfSBmcm9tIFwiLi4vY29tcG9uZW50cy9oZWFsdGhcIjtcclxuaW1wb3J0IHsgTW92YWJsZVNoYXBlIH0gZnJvbSBcIi4uL2NvbXBvbmVudHMvbW92YWJsZVNoYXBlXCI7XHJcbmltcG9ydCB7IFNob290ZXIgfSBmcm9tIFwiLi4vY29tcG9uZW50cy9zaG9vdGVyXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgSHVtYW5QbGF5ZXIgZXh0ZW5kcyBNb3ZhYmxlU2hhcGUge1xyXG4gICNtb3ZlbWVudEFtb3VudDogbnVtYmVyO1xyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgeDogbnVtYmVyLFxyXG4gICAgeTogbnVtYmVyLFxyXG4gICAgcHVibGljIGhlYWx0aDogSGVhbHRoLFxyXG4gICAgcHVibGljIGNvbnRyb2xzOiBDb250cm9scyxcclxuICAgIHB1YmxpYyBzaG9vdGVyOiBTaG9vdGVyLFxyXG4gICAgd2lkdGg6IG51bWJlciA9IDEwMCxcclxuICAgIGhlaWdodDogbnVtYmVyID0gMTAwLFxyXG4gICAgZGVsdGFYOiBudW1iZXIgPSAwLFxyXG4gICAgZGVsdGFZOiBudW1iZXIgPSAwXHJcbiAgKSB7XHJcbiAgICBzdXBlcih4LCB5LCB3aWR0aCwgaGVpZ2h0LCBkZWx0YVgsIGRlbHRhWSk7XHJcbiAgICB0aGlzLmNvbnRyb2xzLm9uSW5wdXRIYW5kbGVyID0gKGlucHV0LCBuZXdTdGF0ZSwgZXZlbnQpID0+IHtcclxuICAgICAgaWYgKFwiTE1CXCIgPT09IGlucHV0ICYmIG5ld1N0YXRlKSB7XHJcbiAgICAgICAgdGhpcy5zaG9vdGVyLnNob290KFxyXG4gICAgICAgICAgeyB4OiB0aGlzLmNlbnRlci54LCB5OiB0aGlzLmNlbnRlci55IH0sXHJcbiAgICAgICAgICB7IHg6IChldmVudCBhcyBNb3VzZUV2ZW50KS54LCB5OiAoZXZlbnQgYXMgTW91c2VFdmVudCkueSB9XHJcbiAgICAgICAgKTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuICAgIHRoaXMuI21vdmVtZW50QW1vdW50ID0gNTtcclxuICB9XHJcblxyXG4gIG1vdmUoKSB7XHJcbiAgICBpZiAodGhpcy5jb250cm9scy5pbnB1dHMuS2V5Vykge1xyXG4gICAgICB0aGlzLmRlbHRhWSA9IC10aGlzLiNtb3ZlbWVudEFtb3VudDtcclxuICAgIH0gZWxzZSBpZiAodGhpcy5jb250cm9scy5pbnB1dHMuS2V5Uykge1xyXG4gICAgICB0aGlzLmRlbHRhWSA9IHRoaXMuI21vdmVtZW50QW1vdW50O1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5kZWx0YVkgPSAwO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICh0aGlzLmNvbnRyb2xzLmlucHV0cy5LZXlBKSB7XHJcbiAgICAgIHRoaXMuZGVsdGFYID0gLXRoaXMuI21vdmVtZW50QW1vdW50O1xyXG4gICAgfSBlbHNlIGlmICh0aGlzLmNvbnRyb2xzLmlucHV0cy5LZXlEKSB7XHJcbiAgICAgIHRoaXMuZGVsdGFYID0gdGhpcy4jbW92ZW1lbnRBbW91bnQ7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLmRlbHRhWCA9IDA7XHJcbiAgICB9XHJcbiAgICBzdXBlci5tb3ZlKCk7XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBjcmVhdGVEZWZhdWx0SHVtYW5QbGF5ZXIoKSB7XHJcbiAgY29uc3QgaGVhbHRoID0gbmV3IEhlYWx0aCgxMDApO1xyXG4gIGNvbnN0IGNvbnRyb2xzID0gbmV3IENvbnRyb2xzKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJjYW52YXNcIikhLCB3aW5kb3cpO1xyXG4gIGNvbnN0IHNob290ZXIgPSBuZXcgU2hvb3RlcigpO1xyXG4gIHJldHVybiBuZXcgSHVtYW5QbGF5ZXIoMzAwLCAxMDAsIGhlYWx0aCwgY29udHJvbHMsIHNob290ZXIpO1xyXG59XHJcblxyXG5leHBvcnQgY29uc3QgZGVmYXVsdEh1bWFuUGxheWVyID0gY3JlYXRlRGVmYXVsdEh1bWFuUGxheWVyKCk7XHJcbiIsImltcG9ydCB7IEhlYWx0aCB9IGZyb20gXCIuLi9jb21wb25lbnRzL2hlYWx0aFwiO1xyXG5pbXBvcnQgeyBTaGFwZSB9IGZyb20gXCIuLi9jb21wb25lbnRzL3NoYXBlXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgT2JzdGFjbGUgZXh0ZW5kcyBTaGFwZSB7XHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICB4OiBudW1iZXIsXHJcbiAgICB5OiBudW1iZXIsXHJcbiAgICB3aWR0aDogbnVtYmVyLFxyXG4gICAgaGVpZ2h0OiBudW1iZXIsXHJcbiAgICBwdWJsaWMgaGVhbHRoOiBIZWFsdGhcclxuICApIHtcclxuICAgIHN1cGVyKHgsIHksIHdpZHRoLCBoZWlnaHQpO1xyXG4gIH1cclxufVxyXG4iLCJpbXBvcnQgeyBkZWZhdWx0Q29tcHV0ZXJQbGF5ZXIgfSBmcm9tIFwiLi9tb2RlbC9jbGFzc2VzL2NvbXB1dGVyUGxheWVyXCI7XHJcbmltcG9ydCB7IGRlZmF1bHRIdW1hblBsYXllciB9IGZyb20gXCIuL21vZGVsL2NsYXNzZXMvaHVtYW5QbGF5ZXJcIjtcclxuaW1wb3J0IHsgT2JzdGFjbGUgfSBmcm9tIFwiLi9tb2RlbC9jbGFzc2VzL29ic3RhY2xlXCI7XHJcbmltcG9ydCB7IFdvcmxkIH0gZnJvbSBcIi4vbW9kZWwvY2xhc3Nlcy93b3JsZFwiO1xyXG5pbXBvcnQgeyBIZWFsdGggfSBmcm9tIFwiLi9tb2RlbC9jb21wb25lbnRzL2hlYWx0aFwiO1xyXG5cclxuY29uc3QgcGxheWVycyA9IFtkZWZhdWx0SHVtYW5QbGF5ZXIsIGRlZmF1bHRDb21wdXRlclBsYXllcl07XHJcblxyXG5jb25zdCBvYnN0YWNsZXMgPSBbXHJcbiAgbmV3IE9ic3RhY2xlKDIwMCwgMjAwLCA1MCwgNTAsIG5ldyBIZWFsdGgoMjAwKSksXHJcbiAgbmV3IE9ic3RhY2xlKDMwMCwgMzAwLCAyMCwgMTUwLCBuZXcgSGVhbHRoKDIwMCkpLFxyXG4gIG5ldyBPYnN0YWNsZSg2MDAsIDQwMCwgOTAsIDcwLCBuZXcgSGVhbHRoKDIwMCkpLFxyXG5dO1xyXG5cclxuY29uc3Qgd29ybGQgPSBuZXcgV29ybGQoKTtcclxuXHJcbmV4cG9ydCBjb25zdCBkZWZhdWx0Q29uZmlnID0ge1xyXG4gIHBsYXllcnMsXHJcbiAgb2JzdGFjbGVzLFxyXG4gIHdvcmxkLFxyXG59O1xyXG4iLCJpbXBvcnQgeyBTaGFwZSB9IGZyb20gXCIuLi9jb21wb25lbnRzL3NoYXBlXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgV29ybGQgZXh0ZW5kcyBTaGFwZSB7XHJcbiAgY29uc3RydWN0b3Iod2lkdGg6IG51bWJlciA9IDgwMCwgaGVpZ2h0OiBudW1iZXIgPSA1MDApIHtcclxuICAgIHN1cGVyKDAsIDAsIHdpZHRoLCBoZWlnaHQpO1xyXG4gIH1cclxufVxyXG4iLCJpbXBvcnQgeyBkZWZhdWx0Q29uZmlnIH0gZnJvbSBcIi4vZGVmYXVsdEdhbWVTZXR1cFwiO1xyXG5cclxuY29uc3QgZ2FtZSA9IHtcclxuICAuLi5kZWZhdWx0Q29uZmlnLFxyXG59O1xyXG5cclxuY29uc3QgeyB3b3JsZCwgcGxheWVycywgb2JzdGFjbGVzIH0gPSBkZWZhdWx0Q29uZmlnO1xyXG5jb25zdCBjYW52YXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiY2FudmFzXCIpITtcclxuY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoXCIyZFwiKSE7XHJcbmNhbnZhcy5oZWlnaHQgPSB3b3JsZC5oZWlnaHQ7XHJcbmNhbnZhcy53aWR0aCA9IHdvcmxkLndpZHRoO1xyXG5cclxuY29uc3QgdXBkYXRlID0gYXN5bmMgKCkgPT4ge1xyXG4gIGN0eC5jbGVhclJlY3QoMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KTtcclxuXHJcbiAgZm9yIChjb25zdCBvYnN0YWNsZSBvZiBvYnN0YWNsZXMpIHtcclxuICAgIC8vIE9ic3RhY2xlXHJcbiAgICBjdHguZmlsbFN0eWxlID0gXCIjNzA0MzAwXCI7XHJcbiAgICBjdHguZmlsbFJlY3Qob2JzdGFjbGUueCwgb2JzdGFjbGUueSwgb2JzdGFjbGUud2lkdGgsIG9ic3RhY2xlLmhlaWdodCk7XHJcblxyXG4gICAgY29uc3QgeyBjdXJyZW50SGVhbHRoIH0gPSBvYnN0YWNsZS5oZWFsdGg7XHJcblxyXG4gICAgLy8gT2JzdGFjbGUgSFAgYmFyXHJcbiAgICBjdHguZmlsbFN0eWxlID1cclxuICAgICAgY3VycmVudEhlYWx0aCA+IDYwID8gXCJncmVlblwiIDogY3VycmVudEhlYWx0aCA+IDQwID8gXCJ5ZWxsb3dcIiA6IFwicmVkXCI7XHJcbiAgICBjdHguZmlsbFJlY3QoXHJcbiAgICAgIG9ic3RhY2xlLngsXHJcbiAgICAgIG9ic3RhY2xlLnkgLSA0MCxcclxuICAgICAgb2JzdGFjbGUuaGVhbHRoLmN1cnJlbnRIZWFsdGhBc1BlcmNlbnRhZ2UgKiBvYnN0YWNsZS53aWR0aCxcclxuICAgICAgMjBcclxuICAgICk7XHJcbiAgICBjdHguc3Ryb2tlU3R5bGUgPSBcImJsYWNrXCI7XHJcbiAgICBjdHgubGluZVdpZHRoID0gMjtcclxuICAgIGN0eC5zdHJva2VSZWN0KG9ic3RhY2xlLngsIG9ic3RhY2xlLnkgLSA0MCwgb2JzdGFjbGUud2lkdGgsIDIwKTtcclxuICB9XHJcblxyXG4gIGZvciAoY29uc3QgcGxheWVyIG9mIHBsYXllcnMpIHtcclxuICAgIHBsYXllci5tb3ZlKCk7XHJcbiAgICBpZiAoXHJcbiAgICAgIG9ic3RhY2xlcy5zb21lKChvYnN0YWNsZSkgPT4ge1xyXG4gICAgICAgIGlmIChvYnN0YWNsZS5jb2xsaWRlc1dpdGgocGxheWVyKSkge1xyXG4gICAgICAgICAgY29uc29sZS5sb2coXCJDb2xsaXNpb24gYmV0d2VlbiBwbGF5ZXIgYW5kIG9ic3RhY2xlLlwiKTtcclxuICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgfSlcclxuICAgICkge1xyXG4gICAgICBwbGF5ZXIudW5kb01vdmUoKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB7IGN1cnJlbnRIZWFsdGggfSA9IHBsYXllci5oZWFsdGg7XHJcblxyXG4gICAgLy8gUGxheWVyIHNwcml0ZVxyXG4gICAgY3R4LmZpbGxTdHlsZSA9IFwicmVkXCI7XHJcbiAgICBjdHguZmlsbFJlY3QocGxheWVyLngsIHBsYXllci55LCBwbGF5ZXIud2lkdGgsIHBsYXllci5oZWlnaHQpO1xyXG5cclxuICAgIC8vIFBsYXllciBIUCBiYXJcclxuICAgIGN0eC5maWxsU3R5bGUgPVxyXG4gICAgICBjdXJyZW50SGVhbHRoID4gNjAgPyBcImdyZWVuXCIgOiBjdXJyZW50SGVhbHRoID4gNDAgPyBcInllbGxvd1wiIDogXCJyZWRcIjtcclxuICAgIGN0eC5maWxsUmVjdChcclxuICAgICAgcGxheWVyLngsXHJcbiAgICAgIHBsYXllci55IC0gNDAsXHJcbiAgICAgIHBsYXllci5oZWFsdGguY3VycmVudEhlYWx0aEFzUGVyY2VudGFnZSAqIHBsYXllci53aWR0aCxcclxuICAgICAgMjBcclxuICAgICk7XHJcbiAgICBjdHguc3Ryb2tlU3R5bGUgPSBcImJsYWNrXCI7XHJcbiAgICBjdHgubGluZVdpZHRoID0gMjtcclxuICAgIGN0eC5zdHJva2VSZWN0KHBsYXllci54LCBwbGF5ZXIueSAtIDQwLCBwbGF5ZXIud2lkdGgsIDIwKTtcclxuXHJcbiAgICBmb3IgKGNvbnN0IHNob3Qgb2YgcGxheWVyLnNob290ZXIuc2hvdHNGaXJlZCkge1xyXG4gICAgICBzaG90Lm1vdmUoKTtcclxuICAgICAgY3R4LmZpbGxTdHlsZSA9IFwiZ29sZGVucm9kXCI7XHJcbiAgICAgIGN0eC5maWxsUmVjdChzaG90LngsIHNob3QueSwgNywgNyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyBhd2FpdCBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gc2V0VGltZW91dChyZXNvbHZlLCAxZTMpKTtcclxuICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUodXBkYXRlKTtcclxufTtcclxuXHJcbnVwZGF0ZSgpO1xyXG4iXSwic291cmNlUm9vdCI6IiJ9