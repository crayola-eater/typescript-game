(()=>{"use strict";class t{constructor(t,e=t){this.maxHealth=t,this.currentHealth=e}changeHealthBy(t){this.currentHealth=Math.max(0,this.currentHealth+t)}get isEmpty(){return 0===this.currentHealth}get currentPercentage(){return this.currentHealth/this.maxHealth}get currentColour(){return this.currentPercentage>.6?"green":this.currentPercentage>.4?"yellow":"red"}}class e{constructor(t,e,s,i){this.x=t,this.y=e,this.width=s,this.height=i}collidesWith(t){return this.topLeft.x<t.bottomRight.x&&this.bottomRight.x>t.topLeft.x&&this.topLeft.y<t.bottomRight.y&&this.bottomRight.y>t.topRight.y}collidesWithAny(...t){return t.some((t=>this.collidesWith(t)))}extendsBeyond(t){return this.topLeft.x<t.topLeft.x||this.bottomRight.x>t.bottomRight.x||this.topLeft.y<t.topLeft.y||this.bottomRight.y>t.bottomRight.y}getAllCollisionsWith(...t){return t.filter((t=>this.collidesWith(t)))}get topLeft(){return{x:this.x,y:this.y}}get topRight(){return{x:this.x+this.width,y:this.y}}get bottomLeft(){return{x:this.x,y:this.y+this.height}}get bottomRight(){return{x:this.x+this.width,y:this.y+this.height}}get center(){return{x:this.x+this.width/2,y:this.y+this.height/2}}}class s extends e{constructor(t,e,s,i,h=0,o=0,n=5){super(t,e,s,i),this.deltaX=h,this.deltaY=o,this.movementAmount=n}moveBy(t,e){this.x+=t,this.y+=e}move(){this.x+=this.deltaX,this.y+=this.deltaY}moveBack(){this.moveBy(-this.deltaX,-this.deltaY)}}class i extends s{constructor(t,e,s,i,h=100,o=100,n=0,r=0){super(t,e,h,o,n,r),this.health=s,this.shooter=i}shoot(t){this.shooter.shoot({x:this.center.x,y:this.center.y},{x:t.x,y:t.y})}draw(t){t.fillStyle="red",t.fillRect(this.x,this.y,this.width,this.height),t.fillStyle=this.health.currentColour,t.fillRect(this.x,this.y-40,this.health.currentPercentage*this.width,20),t.strokeStyle="black",t.lineWidth=2,t.strokeRect(this.x,this.y-40,this.width,20)}}class h extends s{constructor(t,e,s=5,i=5,h=15,o=10){super(t.x,t.y,s,i,0,0),this.speed=h,this.damage=o;const n={deltaX:e.x-t.x,deltaY:e.y-t.y},r=Math.atan2(n.deltaY,n.deltaX);this.deltaX=Math.cos(r)*h,this.deltaY=Math.sin(r)*h}draw(t){t.fillStyle="goldenrod",t.fillRect(this.x,this.y,7,7)}}class o{constructor(){this.shotsFired=[]}shoot(t,e){const s=new h(t,e);this.shotsFired.push(s)}remove(t){this.shotsFired=this.shotsFired.filter((e=>e!==t))}removeShots(...t){this.shotsFired=this.shotsFired.filter((e=>!t.includes(e)))}keepShotsWhere(t){this.shotsFired=this.shotsFired.filter(t)}}var n,r=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};class a extends i{constructor(t,e,s,i,h=100,o=100){super(t,e,s,i,h,o),this.health=s,this.shooter=i,n.set(this,void 0);const r=(new Date).getTime();!function(t,e,s){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");e.set(t,s)}(this,n,{changedDeltaX:r,changedDeltaY:r,shot:r})}get shouldChangeDirection(){return(new Date).getTime()>r(this,n).changedDeltaX+100}get shouldShoot(){return(new Date).getTime()>r(this,n).shot+2e3}maybeChangeDirection(){if(this.shouldChangeDirection){const t=Math.random()<.5?-1:1;this.deltaX=5*Math.random()*t;const e=Math.random()<.5?-1:1;this.deltaY=5*Math.random()*e;const s=(new Date).getTime();r(this,n).changedDeltaX=s,r(this,n).changedDeltaY=s}}move(){this.maybeChangeDirection(),super.move()}shoot(t){this.shouldShoot&&super.shoot(t)}}n=new WeakMap;const l=function(){const e=new t(100),s=new o;return new a(600,200,e,s)}();var c,d=function(t,e,s){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,s),s},u=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};class y{constructor(t,e){c.set(this,void 0),this.inputs={KeyW:!1,KeyA:!1,KeyS:!1,KeyD:!1,LMB:!1},d(this,c,((t,e)=>console.log({input:t,newValue:e})));const s=t=>{0===t.button&&(this.inputs.LMB="mousedown"===t.type,u(this,c).call(this,"LMB",this.inputs.LMB,t))},i=t=>{const{code:e}=t;this.inputs.hasOwnProperty(e)&&(this.inputs[e]="keydown"===t.type,u(this,c).call(this,e,this.inputs[e],t))};t.addEventListener("mouseup",s),t.addEventListener("mousedown",s),e.addEventListener("keyup",i),e.addEventListener("keydown",i)}set onInputHandler(t){d(this,c,t)}}c=new WeakMap;class p extends i{constructor(t,e,s,i,h,o=100,n=100,r=0,a=0){super(t,e,s,h,o,n,r,a),this.health=s,this.controls=i,this.shooter=h,this.controls.onInputHandler=(t,e,s)=>{"LMB"===t&&e&&super.shoot({x:s.x,y:s.y})},this.movementAmount=5}move(){this.controls.inputs.KeyW?this.deltaY=-this.movementAmount:this.controls.inputs.KeyS?this.deltaY=this.movementAmount:this.deltaY=0,this.controls.inputs.KeyA?this.deltaX=-this.movementAmount:this.controls.inputs.KeyD?this.deltaX=this.movementAmount:this.deltaX=0,super.move()}}const w=function(){const e=new t(100),s=new y(document.querySelector("canvas"),window),i=new o;return new p(300,100,e,s,i)}();class m extends e{constructor(t,e,s,i,h){super(t,e,s,i),this.health=h}draw(t){t.fillStyle="#704300",t.fillRect(this.x,this.y,this.width,this.height),t.fillStyle=this.health.currentColour,t.fillRect(this.x,this.y-40,this.health.currentPercentage*this.width,20),t.strokeStyle="black",t.lineWidth=2,t.strokeRect(this.x,this.y-40,this.width,20)}}const g={players:[w,l],obstacles:[new m(200,200,50,50,new t(200)),new m(300,300,20,150,new t(200)),new m(600,400,90,70,new t(200))],world:new class extends e{constructor(t=800,e=500){super(0,0,t,e)}draw(){}}};var f,x,v=function(t,e,s){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,s),s},b=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};f=new WeakMap,x=new WeakMap;const{world:W,players:R,obstacles:L}=g,k=document.querySelector("canvas");new class{constructor(t,e,s,i){this.world=t,this.players=e,this.obstacles=s,this.canvas=i,f.set(this,void 0),x.set(this,void 0),this.canvas.height=this.world.height,this.canvas.width=this.world.width,v(this,f,this.canvas.getContext("2d")),v(this,x,!1)}otherPlayers(t){return this.players.filter((e=>e!==t))}updatePositions(){for(const t of this.players){t.move(),(t.extendsBeyond(this.world)||t.collidesWithAny(...this.otherPlayers(t))||t.collidesWithAny(...this.obstacles))&&t.moveBack();for(const e of t.shooter.shotsFired)e.move();this.processCollisions()}}processCollisions(){for(const t of this.players)t.shooter.keepShotsWhere((e=>{const s=e.getAllCollisionsWith(...this.obstacles);s.forEach((t=>t.health.changeHealthBy(-e.damage)));const i=e.getAllCollisionsWith(...this.otherPlayers(t));return i.forEach((t=>t.health.changeHealthBy(-e.damage))),0===s.length&&0===i.length&&!e.extendsBeyond(this.world)}))}draw(){b(this,f).clearRect(0,0,this.canvas.width,this.canvas.height);for(const t of this.players){t.draw(b(this,f));for(const e of t.shooter.shotsFired)e.draw(b(this,f));for(const t of this.obstacles)t.draw(b(this,f))}}getWinner(){const t=this.players.filter((t=>!t.health.isEmpty));if(1===t.length)return t[0]}play(){this.updatePositions(),this.draw();const t=this.getWinner();if(t)return setTimeout((()=>alert(t+" has won!")),10);requestAnimationFrame(this.play.bind(this))}}(W,R,L,k).play()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zbWFsbC1nYW1lLy4vc3JjL21vZGVsL2NvbXBvbmVudHMvaGVhbHRoLnRzIiwid2VicGFjazovL3NtYWxsLWdhbWUvLi9zcmMvbW9kZWwvY29tcG9uZW50cy9zaGFwZS50cyIsIndlYnBhY2s6Ly9zbWFsbC1nYW1lLy4vc3JjL21vZGVsL2NvbXBvbmVudHMvbW92YWJsZVNoYXBlLnRzIiwid2VicGFjazovL3NtYWxsLWdhbWUvLi9zcmMvbW9kZWwvY29tcG9uZW50cy9wbGF5ZXIudHMiLCJ3ZWJwYWNrOi8vc21hbGwtZ2FtZS8uL3NyYy9tb2RlbC9jb21wb25lbnRzL3Nob3QudHMiLCJ3ZWJwYWNrOi8vc21hbGwtZ2FtZS8uL3NyYy9tb2RlbC9jb21wb25lbnRzL3Nob290ZXIudHMiLCJ3ZWJwYWNrOi8vc21hbGwtZ2FtZS8uL3NyYy9tb2RlbC9jbGFzc2VzL2NvbXB1dGVyUGxheWVyLnRzIiwid2VicGFjazovL3NtYWxsLWdhbWUvLi9zcmMvbW9kZWwvY29tcG9uZW50cy9jb250cm9scy50cyIsIndlYnBhY2s6Ly9zbWFsbC1nYW1lLy4vc3JjL21vZGVsL2NsYXNzZXMvaHVtYW5QbGF5ZXIudHMiLCJ3ZWJwYWNrOi8vc21hbGwtZ2FtZS8uL3NyYy9tb2RlbC9jbGFzc2VzL29ic3RhY2xlLnRzIiwid2VicGFjazovL3NtYWxsLWdhbWUvLi9zcmMvZGVmYXVsdEdhbWUudHMiLCJ3ZWJwYWNrOi8vc21hbGwtZ2FtZS8uL3NyYy9tb2RlbC9jbGFzc2VzL3dvcmxkLnRzIiwid2VicGFjazovL3NtYWxsLWdhbWUvLi9zcmMvaW5kZXgudHMiLCJ3ZWJwYWNrOi8vc21hbGwtZ2FtZS8uL3NyYy9tb2RlbC9jbGFzc2VzL2dhbWUudHMiXSwibmFtZXMiOlsiSGVhbHRoIiwibWF4SGVhbHRoIiwiY3VycmVudEhlYWx0aCIsImNoYW5nZSIsInRoaXMiLCJNYXRoIiwibWF4IiwiY3VycmVudFBlcmNlbnRhZ2UiLCJTaGFwZSIsIngiLCJ5Iiwid2lkdGgiLCJoZWlnaHQiLCJvdGhlclNoYXBlIiwidG9wTGVmdCIsImJvdHRvbVJpZ2h0IiwidG9wUmlnaHQiLCJvdGhlclNoYXBlcyIsInNvbWUiLCJjb2xsaWRlc1dpdGgiLCJmaWx0ZXIiLCJNb3ZhYmxlU2hhcGUiLCJkZWx0YVgiLCJkZWx0YVkiLCJtb3ZlbWVudEFtb3VudCIsInN1cGVyIiwibW92ZUJ5IiwiUGxheWVyIiwiaGVhbHRoIiwic2hvb3RlciIsImF0Iiwic2hvb3QiLCJjZW50ZXIiLCJjdHgiLCJmaWxsU3R5bGUiLCJmaWxsUmVjdCIsImN1cnJlbnRDb2xvdXIiLCJzdHJva2VTdHlsZSIsImxpbmVXaWR0aCIsInN0cm9rZVJlY3QiLCJTaG90IiwiZnJvbSIsInRvIiwic3BlZWQiLCJkYW1hZ2UiLCJvcmlnaW5hbERlbHRhIiwicmFkaWFucyIsImF0YW4yIiwiY29zIiwic2luIiwiU2hvb3RlciIsInNob3RzRmlyZWQiLCJzaG90IiwicHVzaCIsInNob3RUb1JlbW92ZSIsInNob3RzVG9SZW1vdmUiLCJpbmNsdWRlcyIsInByZWRpY2F0ZSIsIkNvbXB1dGVyUGxheWVyIiwiY3VycmVudFRpbWUiLCJEYXRlIiwiZ2V0VGltZSIsImNoYW5nZWREZWx0YVgiLCJjaGFuZ2VkRGVsdGFZIiwic2hvdWxkQ2hhbmdlRGlyZWN0aW9uIiwibGVmdE9yUmlnaHQiLCJyYW5kb20iLCJ1cE9yRG93biIsIm1heWJlQ2hhbmdlRGlyZWN0aW9uIiwibW92ZSIsInNob3VsZFNob290IiwiZGVmYXVsdENvbXB1dGVyUGxheWVyIiwiY3JlYXRlRGVmYXVsdENvbXB1dGVyUGxheWVyIiwiQ29udHJvbHMiLCJjYW52YXMiLCJ3aW5kb3ciLCJpbnB1dHMiLCJLZXlXIiwiS2V5QSIsIktleVMiLCJLZXlEIiwiTE1CIiwiaW5wdXQiLCJuZXdWYWx1ZSIsImNvbnNvbGUiLCJsb2ciLCJjbGlja0xpc3RlbmVyIiwiZSIsImJ1dHRvbiIsInR5cGUiLCJrZXlMaXN0ZW5lciIsImNvZGUiLCJoYXNPd25Qcm9wZXJ0eSIsImFkZEV2ZW50TGlzdGVuZXIiLCJuZXdIYW5kbGVyIiwiSHVtYW5QbGF5ZXIiLCJjb250cm9scyIsIm9uSW5wdXRIYW5kbGVyIiwibmV3U3RhdGUiLCJldmVudCIsImRlZmF1bHRIdW1hblBsYXllciIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImNyZWF0ZURlZmF1bHRIdW1hblBsYXllciIsIk9ic3RhY2xlIiwiZGVmYXVsdENvbmZpZyIsInBsYXllcnMiLCJvYnN0YWNsZXMiLCJ3b3JsZCIsImdldENvbnRleHQiLCJwbGF5ZXJUb0V4Y2x1ZGUiLCJwbGF5ZXIiLCJleHRlbmRzQmV5b25kIiwiY29sbGlkZXNXaXRoQW55Iiwib3RoZXJQbGF5ZXJzIiwibW92ZUJhY2siLCJwcm9jZXNzQ29sbGlzaW9ucyIsImtlZXBTaG90c1doZXJlIiwib2JzdGFjbGVzU2hvdCIsImdldEFsbENvbGxpc2lvbnNXaXRoIiwiZm9yRWFjaCIsIm9ic3RhY2xlIiwiY2hhbmdlSGVhbHRoQnkiLCJwbGF5ZXJzU2hvdCIsImxlbmd0aCIsImNsZWFyUmVjdCIsImRyYXciLCJyZW1haW5pbmdQbGF5ZXJzIiwiaXNFbXB0eSIsInVwZGF0ZVBvc2l0aW9ucyIsInBvdGVudGlhbFdpbm5lciIsImdldFdpbm5lciIsInNldFRpbWVvdXQiLCJhbGVydCIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsInBsYXkiLCJiaW5kIl0sIm1hcHBpbmdzIjoibUJBRU8sTUFBTUEsRUFDWCxZQUNVQyxFQUNBQyxFQUF3QkQsR0FEeEIsS0FBQUEsWUFDQSxLQUFBQyxnQkFHVixlQUFlQyxHQUNiQyxLQUFLRixjQUFnQkcsS0FBS0MsSUFBSSxFQUFHRixLQUFLRixjQUFnQkMsR0FHeEQsY0FDRSxPQUE4QixJQUF2QkMsS0FBS0YsY0FHZCx3QkFDRSxPQUFPRSxLQUFLRixjQUFnQkUsS0FBS0gsVUFHbkMsb0JBQ0UsT0FBSUcsS0FBS0csa0JBQW9CLEdBQ3BCLFFBQ0VILEtBQUtHLGtCQUFvQixHQUMzQixTQUVGLE9DeEJKLE1BQWVDLEVBQ3BCLFlBQ1ND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Z0J0RSxFQUFLUixVQUl2QyxNQUFNK0UsRUFBY3ZFLEVBQUttRSx3QkFDcEJuSCxLQUFLOEcsYUFBYUgsSUFNdkIsT0FKQVksRUFBWUgsU0FBU1QsR0FDbkJBLEVBQU9uRixPQUFPOEYsZ0JBQWdCdEUsRUFBS1IsVUFJVixJQUF6QjBFLEVBQWNNLFFBQ1MsSUFBdkJELEVBQVlDLFNBRVh4RSxFQUFLNEQsY0FBYzVHLEtBQUt3RyxVQU1qQyxPQUNFLEVBQUF4RyxLQUFBLEdBQVV5SCxVQUFVLEVBQUcsRUFBR3pILEtBQUtzRSxPQUFPL0QsTUFBT1AsS0FBS3NFLE9BQU85RCxRQUN6RCxJQUFLLE1BQU1tRyxLQUFVM0csS0FBS3NHLFFBQVMsQ0FDakNLLEVBQU9lLEtBQUssRUFBQTFILEtBQUEsSUFFWixJQUFLLE1BQU1nRCxLQUFRMkQsRUFBT2xGLFFBQVFzQixXQUNoQ0MsRUFBSzBFLEtBQUssRUFBQTFILEtBQUEsSUFHWixJQUFLLE1BQU1xSCxLQUFZckgsS0FBS3VHLFVBQzFCYyxFQUFTSyxLQUFLLEVBQUExSCxLQUFBLEtBS3BCLFlBQ0UsTUFBTTJILEVBQW1CM0gsS0FBS3NHLFFBQVF0RixRQUNuQzJGLElBQVlBLEVBQU9uRixPQUFPb0csVUFFN0IsR0FBZ0MsSUFBNUJELEVBQWlCSCxPQUNuQixPQUFPRyxFQUFpQixHQVk1QixPQUNFM0gsS0FBSzZILGtCQUNMN0gsS0FBSzBILE9BQ0wsTUFBTUksRUFBa0I5SCxLQUFLK0gsWUFDN0IsR0FBSUQsRUFDRixPQUFPRSxZQUFXLElBQU1DLE1BQU1ILEVBQWtCLGNBQWMsSUFHaEVJLHNCQUFzQmxJLEtBQUttSSxLQUFLQyxLQUFLcEksU0Q1R25CLEVBQU8sRUFBUyxFQUFXc0UsR0FDNUM2RCxRIiwiZmlsZSI6ImJ1bmRsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbInR5cGUgSGVhbHRoQ29sb3VyID0gXCJncmVlblwiIHwgXCJ5ZWxsb3dcIiB8IFwicmVkXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgSGVhbHRoIHtcclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHByaXZhdGUgbWF4SGVhbHRoOiBudW1iZXIsXHJcbiAgICBwcml2YXRlIGN1cnJlbnRIZWFsdGg6IG51bWJlciA9IG1heEhlYWx0aFxyXG4gICkge31cclxuXHJcbiAgY2hhbmdlSGVhbHRoQnkoY2hhbmdlOiBudW1iZXIpIHtcclxuICAgIHRoaXMuY3VycmVudEhlYWx0aCA9IE1hdGgubWF4KDAsIHRoaXMuY3VycmVudEhlYWx0aCArIGNoYW5nZSk7XHJcbiAgfVxyXG5cclxuICBnZXQgaXNFbXB0eSgpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0aGlzLmN1cnJlbnRIZWFsdGggPT09IDA7XHJcbiAgfVxyXG5cclxuICBnZXQgY3VycmVudFBlcmNlbnRhZ2UoKTogbnVtYmVyIHtcclxuICAgIHJldHVybiB0aGlzLmN1cnJlbnRIZWFsdGggLyB0aGlzLm1heEhlYWx0aDtcclxuICB9XHJcblxyXG4gIGdldCBjdXJyZW50Q29sb3VyKCk6IEhlYWx0aENvbG91ciB7XHJcbiAgICBpZiAodGhpcy5jdXJyZW50UGVyY2VudGFnZSA+IDAuNikge1xyXG4gICAgICByZXR1cm4gXCJncmVlblwiO1xyXG4gICAgfSBlbHNlIGlmICh0aGlzLmN1cnJlbnRQZXJjZW50YWdlID4gMC40KSB7XHJcbiAgICAgIHJldHVybiBcInllbGxvd1wiO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIFwicmVkXCI7XHJcbiAgfVxyXG59XHJcbiIsImltcG9ydCB7IElQb3NpdGlvbiB9IGZyb20gXCIuLi9pbnRlcmZhY2VzL3Bvc2l0aW9uXCI7XHJcblxyXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgU2hhcGUge1xyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHVibGljIHg6IG51bWJlcixcclxuICAgIHB1YmxpYyB5OiBudW1iZXIsXHJcbiAgICBwdWJsaWMgd2lkdGg6IG51bWJlcixcclxuICAgIHB1YmxpYyBoZWlnaHQ6IG51bWJlclxyXG4gICkge31cclxuXHJcbiAgY29sbGlkZXNXaXRoKG90aGVyU2hhcGU6IFNoYXBlKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gKFxyXG4gICAgICB0aGlzLnRvcExlZnQueCA8IG90aGVyU2hhcGUuYm90dG9tUmlnaHQueCAmJlxyXG4gICAgICB0aGlzLmJvdHRvbVJpZ2h0LnggPiBvdGhlclNoYXBlLnRvcExlZnQueCAmJlxyXG4gICAgICB0aGlzLnRvcExlZnQueSA8IG90aGVyU2hhcGUuYm90dG9tUmlnaHQueSAmJlxyXG4gICAgICB0aGlzLmJvdHRvbVJpZ2h0LnkgPiBvdGhlclNoYXBlLnRvcFJpZ2h0LnlcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBjb2xsaWRlc1dpdGhBbnkoLi4ub3RoZXJTaGFwZXM6IFNoYXBlW10pOiBib29sZWFuIHtcclxuICAgIHJldHVybiBvdGhlclNoYXBlcy5zb21lKChvdGhlclNoYXBlKSA9PiB0aGlzLmNvbGxpZGVzV2l0aChvdGhlclNoYXBlKSk7XHJcbiAgfVxyXG5cclxuICBleHRlbmRzQmV5b25kKG90aGVyU2hhcGU6IFNoYXBlKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gKFxyXG4gICAgICB0aGlzLnRvcExlZnQueCA8IG90aGVyU2hhcGUudG9wTGVmdC54IHx8XHJcbiAgICAgIHRoaXMuYm90dG9tUmlnaHQueCA+IG90aGVyU2hhcGUuYm90dG9tUmlnaHQueCB8fFxyXG4gICAgICB0aGlzLnRvcExlZnQueSA8IG90aGVyU2hhcGUudG9wTGVmdC55IHx8XHJcbiAgICAgIHRoaXMuYm90dG9tUmlnaHQueSA+IG90aGVyU2hhcGUuYm90dG9tUmlnaHQueVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIGdldEFsbENvbGxpc2lvbnNXaXRoPFQgZXh0ZW5kcyBTaGFwZT4oLi4ub3RoZXJTaGFwZXM6IFRbXSk6IFRbXSB7XHJcbiAgICByZXR1cm4gb3RoZXJTaGFwZXMuZmlsdGVyKChvdGhlclNoYXBlKSA9PiB0aGlzLmNvbGxpZGVzV2l0aChvdGhlclNoYXBlKSk7XHJcbiAgfVxyXG5cclxuICBhYnN0cmFjdCBkcmF3KGN0eDogQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEKTogdm9pZDtcclxuXHJcbiAgZ2V0IHRvcExlZnQoKTogSVBvc2l0aW9uIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHg6IHRoaXMueCxcclxuICAgICAgeTogdGhpcy55LFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIGdldCB0b3BSaWdodCgpOiBJUG9zaXRpb24ge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgeDogdGhpcy54ICsgdGhpcy53aWR0aCxcclxuICAgICAgeTogdGhpcy55LFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIGdldCBib3R0b21MZWZ0KCk6IElQb3NpdGlvbiB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICB4OiB0aGlzLngsXHJcbiAgICAgIHk6IHRoaXMueSArIHRoaXMuaGVpZ2h0LFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIGdldCBib3R0b21SaWdodCgpOiBJUG9zaXRpb24ge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgeDogdGhpcy54ICsgdGhpcy53aWR0aCxcclxuICAgICAgeTogdGhpcy55ICsgdGhpcy5oZWlnaHQsXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgZ2V0IGNlbnRlcigpOiBJUG9zaXRpb24ge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgeDogdGhpcy54ICsgdGhpcy53aWR0aCAvIDIsXHJcbiAgICAgIHk6IHRoaXMueSArIHRoaXMuaGVpZ2h0IC8gMixcclxuICAgIH07XHJcbiAgfVxyXG59XHJcbiIsImltcG9ydCB7IFNoYXBlIH0gZnJvbSBcIi4vc2hhcGVcIjtcclxuXHJcbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBNb3ZhYmxlU2hhcGUgZXh0ZW5kcyBTaGFwZSB7XHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICB4OiBudW1iZXIsXHJcbiAgICB5OiBudW1iZXIsXHJcbiAgICB3aWR0aDogbnVtYmVyLFxyXG4gICAgaGVpZ2h0OiBudW1iZXIsXHJcbiAgICBwdWJsaWMgZGVsdGFYOiBudW1iZXIgPSAwLFxyXG4gICAgcHVibGljIGRlbHRhWTogbnVtYmVyID0gMCxcclxuICAgIHB1YmxpYyBtb3ZlbWVudEFtb3VudDogbnVtYmVyID0gNVxyXG4gICkge1xyXG4gICAgc3VwZXIoeCwgeSwgd2lkdGgsIGhlaWdodCk7XHJcbiAgfVxyXG5cclxuICBtb3ZlQnkoZGVsdGFYOiBudW1iZXIsIGRlbHRhWTogbnVtYmVyKSB7XHJcbiAgICB0aGlzLnggKz0gZGVsdGFYO1xyXG4gICAgdGhpcy55ICs9IGRlbHRhWTtcclxuICB9XHJcblxyXG4gIG1vdmUoKSB7XHJcbiAgICB0aGlzLnggKz0gdGhpcy5kZWx0YVg7XHJcbiAgICB0aGlzLnkgKz0gdGhpcy5kZWx0YVk7XHJcbiAgfVxyXG5cclxuICBtb3ZlQmFjaygpIHtcclxuICAgIHRoaXMubW92ZUJ5KC10aGlzLmRlbHRhWCwgLXRoaXMuZGVsdGFZKTtcclxuICB9XHJcbn1cclxuIiwiaW1wb3J0IHsgSVBvc2l0aW9uIH0gZnJvbSBcIi4uL2ludGVyZmFjZXMvcG9zaXRpb25cIjtcclxuaW1wb3J0IHsgSGVhbHRoIH0gZnJvbSBcIi4vaGVhbHRoXCI7XHJcbmltcG9ydCB7IE1vdmFibGVTaGFwZSB9IGZyb20gXCIuL21vdmFibGVTaGFwZVwiO1xyXG5pbXBvcnQgeyBTaG9vdGVyIH0gZnJvbSBcIi4vc2hvb3RlclwiO1xyXG5cclxuZXhwb3J0IGNsYXNzIFBsYXllciBleHRlbmRzIE1vdmFibGVTaGFwZSB7XHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICB4OiBudW1iZXIsXHJcbiAgICB5OiBudW1iZXIsXHJcbiAgICBwdWJsaWMgaGVhbHRoOiBIZWFsdGgsXHJcbiAgICBwdWJsaWMgc2hvb3RlcjogU2hvb3RlcixcclxuICAgIHdpZHRoOiBudW1iZXIgPSAxMDAsXHJcbiAgICBoZWlnaHQ6IG51bWJlciA9IDEwMCxcclxuICAgIGRlbHRhWDogbnVtYmVyID0gMCxcclxuICAgIGRlbHRhWTogbnVtYmVyID0gMFxyXG4gICkge1xyXG4gICAgc3VwZXIoeCwgeSwgd2lkdGgsIGhlaWdodCwgZGVsdGFYLCBkZWx0YVkpO1xyXG4gIH1cclxuXHJcbiAgc2hvb3QoYXQ6IElQb3NpdGlvbikge1xyXG4gICAgdGhpcy5zaG9vdGVyLnNob290KFxyXG4gICAgICB7XHJcbiAgICAgICAgeDogdGhpcy5jZW50ZXIueCxcclxuICAgICAgICB5OiB0aGlzLmNlbnRlci55LFxyXG4gICAgICB9LFxyXG4gICAgICB7XHJcbiAgICAgICAgeDogYXQueCxcclxuICAgICAgICB5OiBhdC55LFxyXG4gICAgICB9XHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgZHJhdyhjdHg6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCkge1xyXG4gICAgLy8gUGxheWVyIHNwcml0ZVxyXG4gICAgY3R4LmZpbGxTdHlsZSA9IFwicmVkXCI7XHJcbiAgICBjdHguZmlsbFJlY3QodGhpcy54LCB0aGlzLnksIHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0KTtcclxuXHJcbiAgICAvLyBQbGF5ZXIgSFAgYmFyXHJcbiAgICBjdHguZmlsbFN0eWxlID0gdGhpcy5oZWFsdGguY3VycmVudENvbG91cjtcclxuICAgIGN0eC5maWxsUmVjdChcclxuICAgICAgdGhpcy54LFxyXG4gICAgICB0aGlzLnkgLSA0MCxcclxuICAgICAgdGhpcy5oZWFsdGguY3VycmVudFBlcmNlbnRhZ2UgKiB0aGlzLndpZHRoLFxyXG4gICAgICAyMFxyXG4gICAgKTtcclxuICAgIGN0eC5zdHJva2VTdHlsZSA9IFwiYmxhY2tcIjtcclxuICAgIGN0eC5saW5lV2lkdGggPSAyO1xyXG4gICAgY3R4LnN0cm9rZVJlY3QodGhpcy54LCB0aGlzLnkgLSA0MCwgdGhpcy53aWR0aCwgMjApO1xyXG4gIH1cclxufVxyXG4iLCJpbXBvcnQgeyBNb3ZhYmxlU2hhcGUgfSBmcm9tIFwiLi9tb3ZhYmxlU2hhcGVcIjtcclxuaW1wb3J0IHsgSVBvc2l0aW9uIH0gZnJvbSBcIi4uL2ludGVyZmFjZXMvcG9zaXRpb25cIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBTaG90IGV4dGVuZHMgTW92YWJsZVNoYXBlIHtcclxuICBjb25zdHJ1Y3RvcihcclxuICAgIGZyb206IElQb3NpdGlvbixcclxuICAgIHRvOiBJUG9zaXRpb24sXHJcbiAgICB3aWR0aDogbnVtYmVyID0gNSxcclxuICAgIGhlaWdodDogbnVtYmVyID0gNSxcclxuICAgIHB1YmxpYyBzcGVlZDogbnVtYmVyID0gMTUsXHJcbiAgICBwdWJsaWMgZGFtYWdlOiBudW1iZXIgPSAxMFxyXG4gICkge1xyXG4gICAgc3VwZXIoZnJvbS54LCBmcm9tLnksIHdpZHRoLCBoZWlnaHQsIDAsIDApO1xyXG5cclxuICAgIGNvbnN0IG9yaWdpbmFsRGVsdGEgPSB7XHJcbiAgICAgIGRlbHRhWDogdG8ueCAtIGZyb20ueCwgLy8gQSBpbiBDQUhcclxuICAgICAgZGVsdGFZOiB0by55IC0gZnJvbS55LCAvLyBPIGluIFNPSFxyXG4gICAgfTtcclxuXHJcbiAgICBjb25zdCByYWRpYW5zID0gTWF0aC5hdGFuMihvcmlnaW5hbERlbHRhLmRlbHRhWSwgb3JpZ2luYWxEZWx0YS5kZWx0YVgpO1xyXG4gICAgdGhpcy5kZWx0YVggPSBNYXRoLmNvcyhyYWRpYW5zKSAqIHNwZWVkOyAvLyBDQUhcclxuICAgIHRoaXMuZGVsdGFZID0gTWF0aC5zaW4ocmFkaWFucykgKiBzcGVlZDsgLy8gU09IXHJcbiAgfVxyXG5cclxuICBkcmF3KGN0eDogQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEKSB7XHJcbiAgICBjdHguZmlsbFN0eWxlID0gXCJnb2xkZW5yb2RcIjtcclxuICAgIGN0eC5maWxsUmVjdCh0aGlzLngsIHRoaXMueSwgNywgNyk7XHJcbiAgfVxyXG59XHJcbiIsImltcG9ydCB7IElQb3NpdGlvbiB9IGZyb20gXCIuLi9pbnRlcmZhY2VzL3Bvc2l0aW9uXCI7XHJcbmltcG9ydCB7IFNob3QgfSBmcm9tIFwiLi9zaG90XCI7XHJcblxyXG50eXBlIGZpbHRlclByZWRpY2F0ZSA9IChzaG90OiBTaG90LCBpbmRleDogbnVtYmVyLCBhcnJheTogU2hvdFtdKSA9PiBib29sZWFuO1xyXG5cclxuZXhwb3J0IGNsYXNzIFNob290ZXIge1xyXG4gIHNob3RzRmlyZWQ6IFNob3RbXTtcclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHRoaXMuc2hvdHNGaXJlZCA9IFtdO1xyXG4gIH1cclxuXHJcbiAgc2hvb3QoZnJvbTogSVBvc2l0aW9uLCBhdDogSVBvc2l0aW9uKSB7XHJcbiAgICBjb25zdCBzaG90ID0gbmV3IFNob3QoZnJvbSwgYXQpO1xyXG4gICAgdGhpcy5zaG90c0ZpcmVkLnB1c2goc2hvdCk7XHJcbiAgfVxyXG5cclxuICByZW1vdmUoc2hvdFRvUmVtb3ZlOiBTaG90KSB7XHJcbiAgICB0aGlzLnNob3RzRmlyZWQgPSB0aGlzLnNob3RzRmlyZWQuZmlsdGVyKChzaG90KSA9PiBzaG90ICE9PSBzaG90VG9SZW1vdmUpO1xyXG4gIH1cclxuXHJcbiAgcmVtb3ZlU2hvdHMoLi4uc2hvdHNUb1JlbW92ZTogU2hvdFtdKSB7XHJcbiAgICB0aGlzLnNob3RzRmlyZWQgPSB0aGlzLnNob3RzRmlyZWQuZmlsdGVyKFxyXG4gICAgICAoc2hvdCkgPT4gIXNob3RzVG9SZW1vdmUuaW5jbHVkZXMoc2hvdClcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBrZWVwU2hvdHNXaGVyZShwcmVkaWNhdGU6IGZpbHRlclByZWRpY2F0ZSkge1xyXG4gICAgdGhpcy5zaG90c0ZpcmVkID0gdGhpcy5zaG90c0ZpcmVkLmZpbHRlcihwcmVkaWNhdGUpO1xyXG4gIH1cclxufVxyXG4iLCJpbXBvcnQgeyBIZWFsdGggfSBmcm9tIFwiLi4vY29tcG9uZW50cy9oZWFsdGhcIjtcclxuaW1wb3J0IHsgUGxheWVyIH0gZnJvbSBcIi4uL2NvbXBvbmVudHMvcGxheWVyXCI7XHJcbmltcG9ydCB7IFNob290ZXIgfSBmcm9tIFwiLi4vY29tcG9uZW50cy9zaG9vdGVyXCI7XHJcbmltcG9ydCB7IElQb3NpdGlvbiB9IGZyb20gXCIuLi9pbnRlcmZhY2VzL3Bvc2l0aW9uXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgQ29tcHV0ZXJQbGF5ZXIgZXh0ZW5kcyBQbGF5ZXIge1xyXG4gICNsYXN0QWN0aW9uczoge1xyXG4gICAgY2hhbmdlZERlbHRhWDogbnVtYmVyO1xyXG4gICAgY2hhbmdlZERlbHRhWTogbnVtYmVyO1xyXG4gICAgc2hvdDogbnVtYmVyO1xyXG4gIH07XHJcblxyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgeDogbnVtYmVyLFxyXG4gICAgeTogbnVtYmVyLFxyXG4gICAgcHVibGljIGhlYWx0aDogSGVhbHRoLFxyXG4gICAgcHVibGljIHNob290ZXI6IFNob290ZXIsXHJcbiAgICB3aWR0aDogbnVtYmVyID0gMTAwLFxyXG4gICAgaGVpZ2h0OiBudW1iZXIgPSAxMDBcclxuICApIHtcclxuICAgIHN1cGVyKHgsIHksIGhlYWx0aCwgc2hvb3Rlciwgd2lkdGgsIGhlaWdodCk7XHJcblxyXG4gICAgY29uc3QgY3VycmVudFRpbWUgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcclxuICAgIHRoaXMuI2xhc3RBY3Rpb25zID0ge1xyXG4gICAgICBjaGFuZ2VkRGVsdGFYOiBjdXJyZW50VGltZSxcclxuICAgICAgY2hhbmdlZERlbHRhWTogY3VycmVudFRpbWUsXHJcbiAgICAgIHNob3Q6IGN1cnJlbnRUaW1lLFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIGdldCBzaG91bGRDaGFuZ2VEaXJlY3Rpb24oKSB7XHJcbiAgICByZXR1cm4gbmV3IERhdGUoKS5nZXRUaW1lKCkgPiB0aGlzLiNsYXN0QWN0aW9ucy5jaGFuZ2VkRGVsdGFYICsgMTAwO1xyXG4gIH1cclxuXHJcbiAgZ2V0IHNob3VsZFNob290KCkge1xyXG4gICAgcmV0dXJuIG5ldyBEYXRlKCkuZ2V0VGltZSgpID4gdGhpcy4jbGFzdEFjdGlvbnMuc2hvdCArIDIwMDA7XHJcbiAgfVxyXG5cclxuICBtYXliZUNoYW5nZURpcmVjdGlvbigpIHtcclxuICAgIGlmICh0aGlzLnNob3VsZENoYW5nZURpcmVjdGlvbikge1xyXG4gICAgICBjb25zdCBsZWZ0T3JSaWdodCA9IE1hdGgucmFuZG9tKCkgPCAwLjUgPyAtMSA6IDE7XHJcbiAgICAgIHRoaXMuZGVsdGFYID0gTWF0aC5yYW5kb20oKSAqIDUgKiBsZWZ0T3JSaWdodDtcclxuXHJcbiAgICAgIGNvbnN0IHVwT3JEb3duID0gTWF0aC5yYW5kb20oKSA8IDAuNSA/IC0xIDogMTtcclxuICAgICAgdGhpcy5kZWx0YVkgPSBNYXRoLnJhbmRvbSgpICogNSAqIHVwT3JEb3duO1xyXG5cclxuICAgICAgY29uc3QgY3VycmVudFRpbWUgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcclxuICAgICAgdGhpcy4jbGFzdEFjdGlvbnMuY2hhbmdlZERlbHRhWCA9IGN1cnJlbnRUaW1lO1xyXG4gICAgICB0aGlzLiNsYXN0QWN0aW9ucy5jaGFuZ2VkRGVsdGFZID0gY3VycmVudFRpbWU7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBtb3ZlKCkge1xyXG4gICAgdGhpcy5tYXliZUNoYW5nZURpcmVjdGlvbigpO1xyXG4gICAgc3VwZXIubW92ZSgpO1xyXG4gIH1cclxuXHJcbiAgc2hvb3QoYXQ6IElQb3NpdGlvbikge1xyXG4gICAgaWYgKHRoaXMuc2hvdWxkU2hvb3QpIHtcclxuICAgICAgc3VwZXIuc2hvb3QoYXQpO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gY3JlYXRlRGVmYXVsdENvbXB1dGVyUGxheWVyKCkge1xyXG4gIGNvbnN0IGhlYWx0aCA9IG5ldyBIZWFsdGgoMTAwKTtcclxuICBjb25zdCBzaG9vdGVyID0gbmV3IFNob290ZXIoKTtcclxuICByZXR1cm4gbmV3IENvbXB1dGVyUGxheWVyKDYwMCwgMjAwLCBoZWFsdGgsIHNob290ZXIpO1xyXG59XHJcblxyXG5leHBvcnQgY29uc3QgZGVmYXVsdENvbXB1dGVyUGxheWVyID0gY3JlYXRlRGVmYXVsdENvbXB1dGVyUGxheWVyKCk7XHJcbiIsImludGVyZmFjZSBDb250cm9sTWFwIHtcclxuICBbY29udHJvbDogc3RyaW5nXTogYm9vbGVhbjtcclxufVxyXG5cclxudHlwZSBpbnB1dEhhbmRsZXIgPSAoXHJcbiAgaW5wdXQ6IHN0cmluZyxcclxuICBuZXdTdGF0ZTogYm9vbGVhbixcclxuICBlOiBNb3VzZUV2ZW50IHwgS2V5Ym9hcmRFdmVudFxyXG4pID0+IHZvaWQ7XHJcblxyXG5leHBvcnQgY2xhc3MgQ29udHJvbHMge1xyXG4gIGlucHV0czogQ29udHJvbE1hcDtcclxuICAjb25JbnB1dDogaW5wdXRIYW5kbGVyO1xyXG5cclxuICBjb25zdHJ1Y3RvcihjYW52YXM6IEhUTUxDYW52YXNFbGVtZW50LCB3aW5kb3c6IFdpbmRvdykge1xyXG4gICAgLy8gTWlnaHQgYmUgd29ydGggc2V0dGluZyB0aGlzIG9iamVjdCB1cCBhcyBhIHByb3h5P1xyXG4gICAgdGhpcy5pbnB1dHMgPSB7XHJcbiAgICAgIEtleVc6IGZhbHNlLFxyXG4gICAgICBLZXlBOiBmYWxzZSxcclxuICAgICAgS2V5UzogZmFsc2UsXHJcbiAgICAgIEtleUQ6IGZhbHNlLFxyXG4gICAgICBMTUI6IGZhbHNlLFxyXG4gICAgfTtcclxuICAgIHRoaXMuI29uSW5wdXQgPSAoaW5wdXQsIG5ld1ZhbHVlKSA9PiBjb25zb2xlLmxvZyh7IGlucHV0LCBuZXdWYWx1ZSB9KTtcclxuXHJcbiAgICBjb25zdCBjbGlja0xpc3RlbmVyID0gKGU6IE1vdXNlRXZlbnQpID0+IHtcclxuICAgICAgaWYgKDAgPT09IGUuYnV0dG9uKSB7XHJcbiAgICAgICAgdGhpcy5pbnB1dHMuTE1CID0gZS50eXBlID09PSBcIm1vdXNlZG93blwiO1xyXG4gICAgICAgIHRoaXMuI29uSW5wdXQoXCJMTUJcIiwgdGhpcy5pbnB1dHMuTE1CLCBlKTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBjb25zdCBrZXlMaXN0ZW5lciA9IChlOiBLZXlib2FyZEV2ZW50KSA9PiB7XHJcbiAgICAgIGNvbnN0IHsgY29kZSB9ID0gZTtcclxuICAgICAgaWYgKHRoaXMuaW5wdXRzLmhhc093blByb3BlcnR5KGNvZGUpKSB7XHJcbiAgICAgICAgdGhpcy5pbnB1dHNbY29kZV0gPSBlLnR5cGUgPT09IFwia2V5ZG93blwiO1xyXG4gICAgICAgIHRoaXMuI29uSW5wdXQoY29kZSwgdGhpcy5pbnB1dHNbY29kZV0sIGUpO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIGNhbnZhcy5hZGRFdmVudExpc3RlbmVyKFwibW91c2V1cFwiLCBjbGlja0xpc3RlbmVyKTtcclxuICAgIGNhbnZhcy5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIGNsaWNrTGlzdGVuZXIpO1xyXG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXl1cFwiLCBrZXlMaXN0ZW5lcik7XHJcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwga2V5TGlzdGVuZXIpO1xyXG4gIH1cclxuXHJcbiAgc2V0IG9uSW5wdXRIYW5kbGVyKG5ld0hhbmRsZXI6IGlucHV0SGFuZGxlcikge1xyXG4gICAgdGhpcy4jb25JbnB1dCA9IG5ld0hhbmRsZXI7XHJcbiAgfVxyXG59XHJcbiIsImltcG9ydCB7IENvbnRyb2xzIH0gZnJvbSBcIi4uL2NvbXBvbmVudHMvY29udHJvbHNcIjtcclxuaW1wb3J0IHsgSGVhbHRoIH0gZnJvbSBcIi4uL2NvbXBvbmVudHMvaGVhbHRoXCI7XHJcbmltcG9ydCB7IFBsYXllciB9IGZyb20gXCIuLi9jb21wb25lbnRzL3BsYXllclwiO1xyXG5pbXBvcnQgeyBTaG9vdGVyIH0gZnJvbSBcIi4uL2NvbXBvbmVudHMvc2hvb3RlclwiO1xyXG5cclxuZXhwb3J0IGNsYXNzIEh1bWFuUGxheWVyIGV4dGVuZHMgUGxheWVyIHtcclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHg6IG51bWJlcixcclxuICAgIHk6IG51bWJlcixcclxuICAgIHB1YmxpYyBoZWFsdGg6IEhlYWx0aCxcclxuICAgIHB1YmxpYyBjb250cm9sczogQ29udHJvbHMsXHJcbiAgICBwdWJsaWMgc2hvb3RlcjogU2hvb3RlcixcclxuICAgIHdpZHRoOiBudW1iZXIgPSAxMDAsXHJcbiAgICBoZWlnaHQ6IG51bWJlciA9IDEwMCxcclxuICAgIGRlbHRhWDogbnVtYmVyID0gMCxcclxuICAgIGRlbHRhWTogbnVtYmVyID0gMFxyXG4gICkge1xyXG4gICAgc3VwZXIoeCwgeSwgaGVhbHRoLCBzaG9vdGVyLCB3aWR0aCwgaGVpZ2h0LCBkZWx0YVgsIGRlbHRhWSk7XHJcbiAgICB0aGlzLmNvbnRyb2xzLm9uSW5wdXRIYW5kbGVyID0gKGlucHV0LCBuZXdTdGF0ZSwgZXZlbnQpID0+IHtcclxuICAgICAgaWYgKFwiTE1CXCIgPT09IGlucHV0ICYmIG5ld1N0YXRlKSB7XHJcbiAgICAgICAgc3VwZXIuc2hvb3Qoe1xyXG4gICAgICAgICAgeDogKGV2ZW50IGFzIE1vdXNlRXZlbnQpLngsXHJcbiAgICAgICAgICB5OiAoZXZlbnQgYXMgTW91c2VFdmVudCkueSxcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuICAgIHRoaXMubW92ZW1lbnRBbW91bnQgPSA1O1xyXG4gIH1cclxuXHJcbiAgbW92ZSgpIHtcclxuICAgIGlmICh0aGlzLmNvbnRyb2xzLmlucHV0cy5LZXlXKSB7XHJcbiAgICAgIHRoaXMuZGVsdGFZID0gLXRoaXMubW92ZW1lbnRBbW91bnQ7XHJcbiAgICB9IGVsc2UgaWYgKHRoaXMuY29udHJvbHMuaW5wdXRzLktleVMpIHtcclxuICAgICAgdGhpcy5kZWx0YVkgPSB0aGlzLm1vdmVtZW50QW1vdW50O1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5kZWx0YVkgPSAwO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICh0aGlzLmNvbnRyb2xzLmlucHV0cy5LZXlBKSB7XHJcbiAgICAgIHRoaXMuZGVsdGFYID0gLXRoaXMubW92ZW1lbnRBbW91bnQ7XHJcbiAgICB9IGVsc2UgaWYgKHRoaXMuY29udHJvbHMuaW5wdXRzLktleUQpIHtcclxuICAgICAgdGhpcy5kZWx0YVggPSB0aGlzLm1vdmVtZW50QW1vdW50O1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5kZWx0YVggPSAwO1xyXG4gICAgfVxyXG4gICAgc3VwZXIubW92ZSgpO1xyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gY3JlYXRlRGVmYXVsdEh1bWFuUGxheWVyKCkge1xyXG4gIGNvbnN0IGhlYWx0aCA9IG5ldyBIZWFsdGgoMTAwKTtcclxuICBjb25zdCBjb250cm9scyA9IG5ldyBDb250cm9scyhkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiY2FudmFzXCIpISwgd2luZG93KTtcclxuICBjb25zdCBzaG9vdGVyID0gbmV3IFNob290ZXIoKTtcclxuICByZXR1cm4gbmV3IEh1bWFuUGxheWVyKDMwMCwgMTAwLCBoZWFsdGgsIGNvbnRyb2xzLCBzaG9vdGVyKTtcclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IGRlZmF1bHRIdW1hblBsYXllciA9IGNyZWF0ZURlZmF1bHRIdW1hblBsYXllcigpO1xyXG4iLCJpbXBvcnQgeyBIZWFsdGggfSBmcm9tIFwiLi4vY29tcG9uZW50cy9oZWFsdGhcIjtcclxuaW1wb3J0IHsgU2hhcGUgfSBmcm9tIFwiLi4vY29tcG9uZW50cy9zaGFwZVwiO1xyXG5cclxuZXhwb3J0IGNsYXNzIE9ic3RhY2xlIGV4dGVuZHMgU2hhcGUge1xyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgeDogbnVtYmVyLFxyXG4gICAgeTogbnVtYmVyLFxyXG4gICAgd2lkdGg6IG51bWJlcixcclxuICAgIGhlaWdodDogbnVtYmVyLFxyXG4gICAgcHVibGljIGhlYWx0aDogSGVhbHRoXHJcbiAgKSB7XHJcbiAgICBzdXBlcih4LCB5LCB3aWR0aCwgaGVpZ2h0KTtcclxuICB9XHJcblxyXG4gIGRyYXcoY3R4OiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQpIHtcclxuICAgIC8vIE9ic3RhY2xlXHJcbiAgICBjdHguZmlsbFN0eWxlID0gXCIjNzA0MzAwXCI7XHJcbiAgICBjdHguZmlsbFJlY3QodGhpcy54LCB0aGlzLnksIHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0KTtcclxuXHJcbiAgICAvLyBPYnN0YWNsZSBIUCBiYXJcclxuICAgIGN0eC5maWxsU3R5bGUgPSB0aGlzLmhlYWx0aC5jdXJyZW50Q29sb3VyO1xyXG4gICAgY3R4LmZpbGxSZWN0KFxyXG4gICAgICB0aGlzLngsXHJcbiAgICAgIHRoaXMueSAtIDQwLFxyXG4gICAgICB0aGlzLmhlYWx0aC5jdXJyZW50UGVyY2VudGFnZSAqIHRoaXMud2lkdGgsXHJcbiAgICAgIDIwXHJcbiAgICApO1xyXG4gICAgY3R4LnN0cm9rZVN0eWxlID0gXCJibGFja1wiO1xyXG4gICAgY3R4LmxpbmVXaWR0aCA9IDI7XHJcbiAgICBjdHguc3Ryb2tlUmVjdCh0aGlzLngsIHRoaXMueSAtIDQwLCB0aGlzLndpZHRoLCAyMCk7XHJcbiAgfVxyXG59XHJcbiIsImltcG9ydCB7IGRlZmF1bHRDb21wdXRlclBsYXllciB9IGZyb20gXCIuL21vZGVsL2NsYXNzZXMvY29tcHV0ZXJQbGF5ZXJcIjtcclxuaW1wb3J0IHsgZGVmYXVsdEh1bWFuUGxheWVyIH0gZnJvbSBcIi4vbW9kZWwvY2xhc3Nlcy9odW1hblBsYXllclwiO1xyXG5pbXBvcnQgeyBPYnN0YWNsZSB9IGZyb20gXCIuL21vZGVsL2NsYXNzZXMvb2JzdGFjbGVcIjtcclxuaW1wb3J0IHsgV29ybGQgfSBmcm9tIFwiLi9tb2RlbC9jbGFzc2VzL3dvcmxkXCI7XHJcbmltcG9ydCB7IEhlYWx0aCB9IGZyb20gXCIuL21vZGVsL2NvbXBvbmVudHMvaGVhbHRoXCI7XHJcbmltcG9ydCB7IFBsYXllciB9IGZyb20gXCIuL21vZGVsL2NvbXBvbmVudHMvcGxheWVyXCI7XHJcblxyXG5jb25zdCBwbGF5ZXJzOiBQbGF5ZXJbXSA9IFtkZWZhdWx0SHVtYW5QbGF5ZXIsIGRlZmF1bHRDb21wdXRlclBsYXllcl07XHJcblxyXG5jb25zdCBvYnN0YWNsZXMgPSBbXHJcbiAgbmV3IE9ic3RhY2xlKDIwMCwgMjAwLCA1MCwgNTAsIG5ldyBIZWFsdGgoMjAwKSksXHJcbiAgbmV3IE9ic3RhY2xlKDMwMCwgMzAwLCAyMCwgMTUwLCBuZXcgSGVhbHRoKDIwMCkpLFxyXG4gIG5ldyBPYnN0YWNsZSg2MDAsIDQwMCwgOTAsIDcwLCBuZXcgSGVhbHRoKDIwMCkpLFxyXG5dO1xyXG5cclxuY29uc3Qgd29ybGQgPSBuZXcgV29ybGQoKTtcclxuXHJcbmV4cG9ydCBjb25zdCBkZWZhdWx0Q29uZmlnID0ge1xyXG4gIHBsYXllcnMsXHJcbiAgb2JzdGFjbGVzLFxyXG4gIHdvcmxkLFxyXG59O1xyXG4iLCJpbXBvcnQgeyBTaGFwZSB9IGZyb20gXCIuLi9jb21wb25lbnRzL3NoYXBlXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgV29ybGQgZXh0ZW5kcyBTaGFwZSB7XHJcbiAgY29uc3RydWN0b3Iod2lkdGg6IG51bWJlciA9IDgwMCwgaGVpZ2h0OiBudW1iZXIgPSA1MDApIHtcclxuICAgIHN1cGVyKDAsIDAsIHdpZHRoLCBoZWlnaHQpO1xyXG4gIH1cclxuXHJcbiAgZHJhdygpIHt9XHJcbn1cclxuIiwiaW1wb3J0IHsgZGVmYXVsdENvbmZpZyB9IGZyb20gXCIuL2RlZmF1bHRHYW1lXCI7XHJcbmltcG9ydCB7IEdhbWUgfSBmcm9tIFwiLi9tb2RlbC9jbGFzc2VzL2dhbWVcIjtcclxuXHJcbmNvbnN0IHsgd29ybGQsIHBsYXllcnMsIG9ic3RhY2xlcyB9ID0gZGVmYXVsdENvbmZpZztcclxuY29uc3QgY2FudmFzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcImNhbnZhc1wiKSE7XHJcblxyXG5jb25zdCBnYW1lID0gbmV3IEdhbWUod29ybGQsIHBsYXllcnMsIG9ic3RhY2xlcywgY2FudmFzKTtcclxuZ2FtZS5wbGF5KCk7XHJcblxyXG4vLyBPYmplY3QuYXNzaWduKHdpbmRvdywgeyBnYW1lIH0pO1xyXG4iLCJpbXBvcnQgeyBQbGF5ZXIgfSBmcm9tIFwiLi4vY29tcG9uZW50cy9wbGF5ZXJcIjtcclxuaW1wb3J0IHsgT2JzdGFjbGUgfSBmcm9tIFwiLi9vYnN0YWNsZVwiO1xyXG5pbXBvcnQgeyBXb3JsZCB9IGZyb20gXCIuL3dvcmxkXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgR2FtZSB7XHJcbiAgI2N0eDogQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEO1xyXG4gICNpc1J1bm5pbmc6IGJvb2xlYW47XHJcblxyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHJpdmF0ZSB3b3JsZDogV29ybGQsXHJcbiAgICBwcml2YXRlIHBsYXllcnM6IFBsYXllcltdLFxyXG4gICAgcHJpdmF0ZSBvYnN0YWNsZXM6IE9ic3RhY2xlW10sXHJcbiAgICBwcml2YXRlIGNhbnZhczogSFRNTENhbnZhc0VsZW1lbnRcclxuICApIHtcclxuICAgIHRoaXMuY2FudmFzLmhlaWdodCA9IHRoaXMud29ybGQuaGVpZ2h0O1xyXG4gICAgdGhpcy5jYW52YXMud2lkdGggPSB0aGlzLndvcmxkLndpZHRoO1xyXG4gICAgdGhpcy4jY3R4ID0gdGhpcy5jYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpITtcclxuICAgIHRoaXMuI2lzUnVubmluZyA9IGZhbHNlO1xyXG4gIH1cclxuXHJcbiAgb3RoZXJQbGF5ZXJzKHBsYXllclRvRXhjbHVkZTogUGxheWVyKSB7XHJcbiAgICByZXR1cm4gdGhpcy5wbGF5ZXJzLmZpbHRlcigocGxheWVyKSA9PiBwbGF5ZXIgIT09IHBsYXllclRvRXhjbHVkZSk7XHJcbiAgfVxyXG5cclxuICB1cGRhdGVQb3NpdGlvbnMoKSB7XHJcbiAgICBmb3IgKGNvbnN0IHBsYXllciBvZiB0aGlzLnBsYXllcnMpIHtcclxuICAgICAgcGxheWVyLm1vdmUoKTtcclxuXHJcbiAgICAgIC8vIFRPRE86IHRoaXMgaXMgcXVhZHJhdGljIGJlaGF2aW91ciAoYW5kIHdpbGwgc2NhbGUgcG9vcmx5KSwgYnV0IG1pZ2h0IG5vdCBoYXZlIGVub3VnaFxyXG4gICAgICAvLyBvYmplY3RzL2NvbXBhcmlzb25zIHRvIHdhcnJhbnQgYSBtb3JlIGVmZmljaWVudCBzdHJ1Y3R1cmVcclxuICAgICAgLy8gZS5nIHF1YWR0cmVlLCBvY3RvdHJlZS5cclxuICAgICAgaWYgKFxyXG4gICAgICAgIHBsYXllci5leHRlbmRzQmV5b25kKHRoaXMud29ybGQpIHx8XHJcbiAgICAgICAgcGxheWVyLmNvbGxpZGVzV2l0aEFueSguLi50aGlzLm90aGVyUGxheWVycyhwbGF5ZXIpKSB8fFxyXG4gICAgICAgIHBsYXllci5jb2xsaWRlc1dpdGhBbnkoLi4udGhpcy5vYnN0YWNsZXMpXHJcbiAgICAgICkge1xyXG4gICAgICAgIHBsYXllci5tb3ZlQmFjaygpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBmb3IgKGNvbnN0IHNob3Qgb2YgcGxheWVyLnNob290ZXIuc2hvdHNGaXJlZCkge1xyXG4gICAgICAgIHNob3QubW92ZSgpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICB0aGlzLnByb2Nlc3NDb2xsaXNpb25zKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcm9jZXNzQ29sbGlzaW9ucygpIHtcclxuICAgIGZvciAoY29uc3QgcGxheWVyIG9mIHRoaXMucGxheWVycykge1xyXG4gICAgICBwbGF5ZXIuc2hvb3Rlci5rZWVwU2hvdHNXaGVyZSgoc2hvdCkgPT4ge1xyXG4gICAgICAgIC8vIERvZXMgc2hvdCBjb2xsaWRlIHdpdGggYW55IG9ic3RhY2xlcz9cclxuICAgICAgICBjb25zdCBvYnN0YWNsZXNTaG90ID0gc2hvdC5nZXRBbGxDb2xsaXNpb25zV2l0aCguLi50aGlzLm9ic3RhY2xlcyk7XHJcbiAgICAgICAgb2JzdGFjbGVzU2hvdC5mb3JFYWNoKChvYnN0YWNsZSkgPT5cclxuICAgICAgICAgIG9ic3RhY2xlLmhlYWx0aC5jaGFuZ2VIZWFsdGhCeSgtc2hvdC5kYW1hZ2UpXHJcbiAgICAgICAgKTtcclxuXHJcbiAgICAgICAgLy8gRG9lcyBzaG90IGNvbGxpZGUgd2l0aCBhbnkgcGxheWVycz9cclxuICAgICAgICBjb25zdCBwbGF5ZXJzU2hvdCA9IHNob3QuZ2V0QWxsQ29sbGlzaW9uc1dpdGgoXHJcbiAgICAgICAgICAuLi50aGlzLm90aGVyUGxheWVycyhwbGF5ZXIpXHJcbiAgICAgICAgKTtcclxuICAgICAgICBwbGF5ZXJzU2hvdC5mb3JFYWNoKChwbGF5ZXIpID0+XHJcbiAgICAgICAgICBwbGF5ZXIuaGVhbHRoLmNoYW5nZUhlYWx0aEJ5KC1zaG90LmRhbWFnZSlcclxuICAgICAgICApO1xyXG5cclxuICAgICAgICByZXR1cm4gKFxyXG4gICAgICAgICAgb2JzdGFjbGVzU2hvdC5sZW5ndGggPT09IDAgJiZcclxuICAgICAgICAgIHBsYXllcnNTaG90Lmxlbmd0aCA9PT0gMCAmJlxyXG4gICAgICAgICAgLy8gSGFzIHNob3QgbGVmdCB0aGUgd29ybGQvdmlldyBzY29wZT9cclxuICAgICAgICAgICFzaG90LmV4dGVuZHNCZXlvbmQodGhpcy53b3JsZClcclxuICAgICAgICApO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGRyYXcoKSB7XHJcbiAgICB0aGlzLiNjdHguY2xlYXJSZWN0KDAsIDAsIHRoaXMuY2FudmFzLndpZHRoLCB0aGlzLmNhbnZhcy5oZWlnaHQpO1xyXG4gICAgZm9yIChjb25zdCBwbGF5ZXIgb2YgdGhpcy5wbGF5ZXJzKSB7XHJcbiAgICAgIHBsYXllci5kcmF3KHRoaXMuI2N0eCk7XHJcblxyXG4gICAgICBmb3IgKGNvbnN0IHNob3Qgb2YgcGxheWVyLnNob290ZXIuc2hvdHNGaXJlZCkge1xyXG4gICAgICAgIHNob3QuZHJhdyh0aGlzLiNjdHgpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBmb3IgKGNvbnN0IG9ic3RhY2xlIG9mIHRoaXMub2JzdGFjbGVzKSB7XHJcbiAgICAgICAgb2JzdGFjbGUuZHJhdyh0aGlzLiNjdHgpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBnZXRXaW5uZXIoKTogUGxheWVyIHwgdW5kZWZpbmVkIHtcclxuICAgIGNvbnN0IHJlbWFpbmluZ1BsYXllcnMgPSB0aGlzLnBsYXllcnMuZmlsdGVyKFxyXG4gICAgICAocGxheWVyKSA9PiAhcGxheWVyLmhlYWx0aC5pc0VtcHR5XHJcbiAgICApO1xyXG4gICAgaWYgKHJlbWFpbmluZ1BsYXllcnMubGVuZ3RoID09PSAxKSB7XHJcbiAgICAgIHJldHVybiByZW1haW5pbmdQbGF5ZXJzWzBdO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVE9ETzogUHV0IFwiZHJhd1wiL1wicmVuZGVyXCIgbWV0aG9kIG9uIFwiU2hhcGVcIiBjbGFzc1xyXG4gICAqIGFuZCBoYXZlIGFsbCBzdWJjbGFzc2VzIChTaG90LCBNb3ZhYmxlU2hhcGUsIEh1bWFuUGxheWVyLFxyXG4gICAqIENvbXB1dGVyUGxheWVyKSBvdmVycmlkZSB3aXRoIHRoZWlyIGltcGxlbWVudGF0aW9uXHJcbiAgICogKGRlcGVuZGluZyBvbiBob3cgdGhleSB3YW50IHRvIGJlIHJlbmRlcmVkIG9uIHRoZSBjYW52YXMpLlxyXG4gICAqIFRoZW4gdGhlIGNhbGxlciBjYW4ganVzdCBjYWxsIFwiZHJhd1wiIG1ldGhvZCBhbmQgdGhlIGNsYXNzZXNcclxuICAgKiB0aGVtc2VsdmVzIGNhbiBiZSByZXNwb25zaWJsZSBmb3IgaG93IHRoZXkncmUgcmVwcmVzZW50ZWQuXHJcbiAgICovXHJcbiAgcGxheSgpIHtcclxuICAgIHRoaXMudXBkYXRlUG9zaXRpb25zKCk7XHJcbiAgICB0aGlzLmRyYXcoKTtcclxuICAgIGNvbnN0IHBvdGVudGlhbFdpbm5lciA9IHRoaXMuZ2V0V2lubmVyKCk7XHJcbiAgICBpZiAocG90ZW50aWFsV2lubmVyKSB7XHJcbiAgICAgIHJldHVybiBzZXRUaW1lb3V0KCgpID0+IGFsZXJ0KHBvdGVudGlhbFdpbm5lciArIFwiIGhhcyB3b24hXCIpLCAxMCk7XHJcbiAgICB9XHJcblxyXG4gICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKHRoaXMucGxheS5iaW5kKHRoaXMpKTtcclxuICB9XHJcbn1cclxuIl0sInNvdXJjZVJvb3QiOiIifQ==