(()=>{"use strict";class t{constructor(t,e=t){this.maxHealth=t,this.currentHealth=e}changeHealthBy(t){this.currentHealth+=t}get isDead(){return 0===this.currentHealth}get currentHealthAsPercentage(){return this.currentHealth/this.maxHealth}}class e{constructor(t,e,s,n){this.x=t,this.y=e,this.width=s,this.height=n}collidesWith(t){return this.topLeft.x<t.bottomRight.x&&this.bottomRight.x>t.topLeft.x&&this.topLeft.y<t.bottomRight.y&&this.bottomRight.y>t.topRight.y}extendsBeyond(t){return this.topLeft.x<t.topLeft.x||this.bottomRight.x>t.bottomRight.x||this.topLeft.y<t.topLeft.y||this.bottomRight.y>t.bottomRight.y}get topLeft(){return{x:this.x,y:this.y}}get topRight(){return{x:this.x+this.width,y:this.y}}get bottomLeft(){return{x:this.x,y:this.y+this.height}}get bottomRight(){return{x:this.x+this.width,y:this.y+this.height}}get center(){return{x:this.x+this.width/2,y:this.y+this.height/2}}}class s extends e{constructor(t,e,s,n,i=0,o=0,h=5){super(t,e,s,n),this.deltaX=i,this.deltaY=o,this.movementAmount=h}moveBy(t,e){this.x+=t,this.y+=e}move(){this.x+=this.deltaX,this.y+=this.deltaY}moveBack(){this.moveBy(-this.deltaX,-this.deltaY)}}class n extends s{constructor(t,e,s=5,n=5,i=15,o=10){super(t.x,t.y,s,n,0,0),this.speed=i,this.damage=o;const h={deltaX:e.x-t.x,deltaY:e.y-t.y},r=Math.atan2(h.deltaY,h.deltaX);this.deltaX=Math.cos(r)*i,this.deltaY=Math.sin(r)*i}}class i{constructor(){this.shotsFired=[]}shoot(t,e){const s=new n(t,e);this.shotsFired.push(s)}remove(t){this.shotsFired=this.shotsFired.filter((e=>t!==e))}}var o,h=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};class r extends s{constructor(t,e,s,n,i=100,h=100){super(t,e,i,h),this.health=s,this.shooter=n,o.set(this,void 0);const r=(new Date).getTime();!function(t,e,s){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");e.set(t,s)}(this,o,{changedDeltaX:r,changedDeltaY:r,shot:r})}get shouldChangeDirection(){return(new Date).getTime()>h(this,o).changedDeltaX+100}maybeChangeDirection(){if(this.shouldChangeDirection){const t=Math.random()<.5?-1:1;this.deltaX=5*Math.random()*t;const e=Math.random()<.5?-1:1;this.deltaY=5*Math.random()*e;const s=(new Date).getTime();h(this,o).changedDeltaX=s,h(this,o).changedDeltaY=s}}move(){this.maybeChangeDirection(),super.move()}}o=new WeakMap;const a=function(){const e=new t(100),s=new i;return new r(600,200,e,s)}();var c,l=function(t,e,s){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,s),s},d=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};class u{constructor(t,e){c.set(this,void 0),this.inputs={KeyW:!1,KeyA:!1,KeyS:!1,KeyD:!1,LMB:!1},l(this,c,((t,e)=>console.log({input:t,newValue:e})));const s=t=>{this.inputs.LMB="mousedown"===t.type,d(this,c).call(this,"LMB",this.inputs.LMB,t)},n=t=>{const{code:e}=t;this.inputs.hasOwnProperty(e)&&(this.inputs[e]="keydown"===t.type,d(this,c).call(this,e,this.inputs[e],t))};t.addEventListener("mouseup",s),t.addEventListener("mousedown",s),e.addEventListener("keyup",n),e.addEventListener("keydown",n)}set onInputHandler(t){l(this,c,t)}}c=new WeakMap;class y extends s{constructor(t,e,s,n,i,o=100,h=100,r=0,a=0){super(t,e,o,h,r,a),this.health=s,this.controls=n,this.shooter=i,this.controls.onInputHandler=(t,e,s)=>{"LMB"===t&&e&&this.shooter.shoot({x:this.center.x,y:this.center.y},{x:s.x,y:s.y})},this.movementAmount=5}move(){this.controls.inputs.KeyW?this.deltaY=-this.movementAmount:this.controls.inputs.KeyS?this.deltaY=this.movementAmount:this.deltaY=0,this.controls.inputs.KeyA?this.deltaX=-this.movementAmount:this.controls.inputs.KeyD?this.deltaX=this.movementAmount:this.deltaX=0,super.move()}}const m=function(){const e=new t(100),s=new u(document.querySelector("canvas"),window),n=new i;return new y(300,100,e,s,n)}();class p extends e{constructor(t,e,s,n,i){super(t,e,s,n),this.health=i}}const w={players:[m,a],obstacles:[new p(200,200,50,50,new t(200)),new p(300,300,20,150,new t(200)),new p(600,400,90,70,new t(200))],world:new class extends e{constructor(t=800,e=500){super(0,0,t,e)}}};Object.assign({},w);const{world:g,players:f,obstacles:x}=w,v=document.querySelector("canvas"),b=v.getContext("2d");v.height=g.height,v.width=g.width;const R=()=>{return t=void 0,e=void 0,n=function*(){b.clearRect(0,0,v.width,v.height);for(const t of x){b.fillStyle="#704300",b.fillRect(t.x,t.y,t.width,t.height);const{currentHealth:e}=t.health;b.fillStyle=e>60?"green":e>40?"yellow":"red",b.fillRect(t.x,t.y-40,t.health.currentHealthAsPercentage*t.width,20),b.strokeStyle="black",b.lineWidth=2,b.strokeRect(t.x,t.y-40,t.width,20)}for(const t of f){t.move(),x.some((e=>{if(e.collidesWith(t))return console.log("Collision between player and obstacle."),!0}))&&t.moveBack();const{currentHealth:e}=t.health;b.fillStyle="red",b.fillRect(t.x,t.y,t.width,t.height),b.fillStyle=e>60?"green":e>40?"yellow":"red",b.fillRect(t.x,t.y-40,t.health.currentHealthAsPercentage*t.width,20),b.strokeStyle="black",b.lineWidth=2,b.strokeRect(t.x,t.y-40,t.width,20);for(const e of t.shooter.shotsFired)e.move(),b.fillStyle="goldenrod",b.fillRect(e.x,e.y,7,7)}requestAnimationFrame(R)},new((s=void 0)||(s=Promise))((function(i,o){function h(t){try{a(n.next(t))}catch(t){o(t)}}function r(t){try{a(n.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?i(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(h,r)}a((n=n.apply(t,e||[])).next())}));var t,e,s,n};R()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zbWFsbC1nYW1lLy4vc3JjL21vZGVsL2NvbXBvbmVudHMvaGVhbHRoLnRzIiwid2VicGFjazovL3NtYWxsLWdhbWUvLi9zcmMvbW9kZWwvY29tcG9uZW50cy9zaGFwZS50cyIsIndlYnBhY2s6Ly9zbWFsbC1nYW1lLy4vc3JjL21vZGVsL2NvbXBvbmVudHMvbW92YWJsZVNoYXBlLnRzIiwid2VicGFjazovL3NtYWxsLWdhbWUvLi9zcmMvbW9kZWwvY29tcG9uZW50cy9zaG90LnRzIiwid2VicGFjazovL3NtYWxsLWdhbWUvLi9zcmMvbW9kZWwvY29tcG9uZW50cy9zaG9vdGVyLnRzIiwid2VicGFjazovL3NtYWxsLWdhbWUvLi9zcmMvbW9kZWwvY2xhc3Nlcy9jb21wdXRlclBsYXllci50cyIsIndlYnBhY2s6Ly9zbWFsbC1nYW1lLy4vc3JjL21vZGVsL2NvbXBvbmVudHMvY29udHJvbHMudHMiLCJ3ZWJwYWNrOi8vc21hbGwtZ2FtZS8uL3NyYy9tb2RlbC9jbGFzc2VzL2h1bWFuUGxheWVyLnRzIiwid2VicGFjazovL3NtYWxsLWdhbWUvLi9zcmMvbW9kZWwvY2xhc3Nlcy9vYnN0YWNsZS50cyIsIndlYnBhY2s6Ly9zbWFsbC1nYW1lLy4vc3JjL2RlZmF1bHRHYW1lU2V0dXAudHMiLCJ3ZWJwYWNrOi8vc21hbGwtZ2FtZS8uL3NyYy9tb2RlbC9jbGFzc2VzL3dvcmxkLnRzIiwid2VicGFjazovL3NtYWxsLWdhbWUvLi9zcmMvaW5kZXgudHMiXSwibmFtZXMiOlsiSGVhbHRoIiwibWF4SGVhbHRoIiwiY3VycmVudEhlYWx0aCIsImNoYW5nZSIsInRoaXMiLCJTaGFwZSIsIngiLCJ5Iiwid2lkdGgiLCJoZWlnaHQiLCJvdGhlclNoYXBlIiwidG9wTGVmdCIsImJvdHRvbVJpZ2h0IiwidG9wUmlnaHQiLCJNb3ZhYmxlU2hhcGUiLCJkZWx0YVgiLCJkZWx0YVkiLCJtb3ZlbWVudEFtb3VudCIsInN1cGVyIiwibW92ZUJ5IiwiU2hvdCIsImZyb20iLCJ0byIsInNwZWVkIiwiZGFtYWdlIiwib3JpZ2luYWxEZWx0YSIsInJhZGlhbnMiLCJNYXRoIiwiYXRhbjIiLCJjb3MiLCJzaW4iLCJTaG9vdGVyIiwic2hvdHNGaXJlZCIsImF0Iiwic2hvdCIsInB1c2giLCJzaG90VG9SZW1vdmUiLCJmaWx0ZXIiLCJDb21wdXRlclBsYXllciIsImhlYWx0aCIsInNob290ZXIiLCJjdXJyZW50VGltZSIsIkRhdGUiLCJnZXRUaW1lIiwiY2hhbmdlZERlbHRhWCIsImNoYW5nZWREZWx0YVkiLCJzaG91bGRDaGFuZ2VEaXJlY3Rpb24iLCJsZWZ0T3JSaWdodCIsInJhbmRvbSIsInVwT3JEb3duIiwibWF5YmVDaGFuZ2VEaXJlY3Rpb24iLCJtb3ZlIiwiZGVmYXVsdENvbXB1dGVyUGxheWVyIiwiY3JlYXRlRGVmYXVsdENvbXB1dGVyUGxheWVyIiwiQ29udHJvbHMiLCJjYW52YXMiLCJ3aW5kb3ciLCJpbnB1dHMiLCJLZXlXIiwiS2V5QSIsIktleVMiLCJLZXlEIiwiTE1CIiwiaW5wdXQiLCJuZXdWYWx1ZSIsImNvbnNvbGUiLCJsb2ciLCJjbGlja0xpc3RlbmVyIiwiZSIsInR5cGUiLCJrZXlMaXN0ZW5lciIsImNvZGUiLCJoYXNPd25Qcm9wZXJ0eSIsImFkZEV2ZW50TGlzdGVuZXIiLCJuZXdIYW5kbGVyIiwiSHVtYW5QbGF5ZXIiLCJjb250cm9scyIsIm9uSW5wdXRIYW5kbGVyIiwibmV3U3RhdGUiLCJldmVudCIsInNob290IiwiY2VudGVyIiwiZGVmYXVsdEh1bWFuUGxheWVyIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiY3JlYXRlRGVmYXVsdEh1bWFuUGxheWVyIiwiT2JzdGFjbGUiLCJkZWZhdWx0Q29uZmlnIiwicGxheWVycyIsIm9ic3RhY2xlcyIsIndvcmxkIiwiY3R4IiwiZ2V0Q29udGV4dCIsInVwZGF0ZSIsImNsZWFyUmVjdCIsIm9ic3RhY2xlIiwiZmlsbFN0eWxlIiwiZmlsbFJlY3QiLCJjdXJyZW50SGVhbHRoQXNQZXJjZW50YWdlIiwic3Ryb2tlU3R5bGUiLCJsaW5lV2lkdGgiLCJzdHJva2VSZWN0IiwicGxheWVyIiwic29tZSIsImNvbGxpZGVzV2l0aCIsIm1vdmVCYWNrIiwicmVxdWVzdEFuaW1hdGlvbkZyYW1lIl0sIm1hcHBpbmdzIjoibUJBQU8sTUFBTUEsRUFDWCxZQUNTQyxFQUNBQyxFQUF3QkQsR0FEeEIsS0FBQUEsWUFDQSxLQUFBQyxnQkFHVCxlQUFlQyxHQUNiQyxLQUFLRixlQUFpQkMsRUFHeEIsYUFDRSxPQUE4QixJQUF2QkMsS0FBS0YsY0FHZCxnQ0FDRSxPQUFPRSxLQUFLRixjQUFnQkUsS0FBS0gsV0NOOUIsTUFBTUksRUFDWCxZQUNTQyxFQUNBQyxFQUNBQyxFQUNBQyxHQUhBLEtBQUFILElBQ0EsS0FBQUMsSUFDQSxLQUFBQyxRQUNBLEtBQUFDLFNBR1QsYUFBYUMsR0FDWCxPQUNFTixLQUFLTyxRQUFRTCxFQUFJSSxFQUFXRSxZQUFZTixHQUN4Q0YsS0FBS1EsWUFBWU4sRUFBSUksRUFBV0MsUUFBUUwsR0FDeENGLEtBQUtPLFFBQVFKLEVBQUlHLEVBQVdFLFlBQVlMLEdBQ3hDSCxLQUFLUSxZQUFZTCxFQUFJRyxFQUFXRyxTQUFTTixFQUk3QyxjQUFjRyxHQUNaLE9BQ0VOLEtBQUtPLFFBQVFMLEVBQUlJLEVBQVdDLFFBQVFMLEdBQ3BDRixLQUFLUSxZQUFZTixFQUFJSSxFQUFXRSxZQUFZTixHQUM1Q0YsS0FBS08sUUFBUUosRUFBSUcsRUFBV0MsUUFBUUosR0FDcENILEtBQUtRLFlBQVlMLEVBQUlHLEVBQVdFLFlBQVlMLEVBSWhELGNBQ0UsTUFBTyxDQUNMRCxFQUFHRixLQUFLRSxFQUNSQyxFQUFHSCxLQUFLRyxHQUlaLGVBQ0UsTUFBTyxDQUNMRCxFQUFHRixLQUFLRSxFQUFJRixLQUFLSSxNQUNqQkQsRUFBR0gsS0FBS0csR0FJWixpQkFDRSxNQUFPLENBQ0xELEVBQUdGLEtBQUtFLEVBQ1JDLEVBQUdILEtBQUtHLEVBQUlILEtBQUtLLFFBSXJCLGtCQUNFLE1BQU8sQ0FDTEgsRUFBR0YsS0FB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QUFPaEcsRUFDUGdHLEVBQU8vRixFQUFJLEdBQ1grRixFQUFPL0QsT0FBTzJELDBCQUE0QkksRUFBTzlGLE1BQ2pELElBRUZtRixFQUFJUSxZQUFjLFFBQ2xCUixFQUFJUyxVQUFZLEVBQ2hCVCxFQUFJVSxXQUFXQyxFQUFPaEcsRUFBR2dHLEVBQU8vRixFQUFJLEdBQUkrRixFQUFPOUYsTUFBTyxJQUV0RCxJQUFLLE1BQU0wQixLQUFRb0UsRUFBTzlELFFBQVFSLFdBQ2hDRSxFQUFLaUIsT0FDTHdDLEVBQUlLLFVBQVksWUFDaEJMLEVBQUlNLFNBQVMvRCxFQUFLNUIsRUFBRzRCLEVBQUszQixFQUFHLEVBQUcsR0FLcENtRyxzQkFBc0JiLEksWUFoRUUsSywrUUFtRTFCQSxLIiwiZmlsZSI6ImJ1bmRsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBjbGFzcyBIZWFsdGgge1xyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHVibGljIG1heEhlYWx0aDogbnVtYmVyLFxyXG4gICAgcHVibGljIGN1cnJlbnRIZWFsdGg6IG51bWJlciA9IG1heEhlYWx0aFxyXG4gICkge31cclxuXHJcbiAgY2hhbmdlSGVhbHRoQnkoY2hhbmdlOiBudW1iZXIpIHtcclxuICAgIHRoaXMuY3VycmVudEhlYWx0aCArPSBjaGFuZ2U7XHJcbiAgfVxyXG5cclxuICBnZXQgaXNEZWFkKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuY3VycmVudEhlYWx0aCA9PT0gMDtcclxuICB9XHJcblxyXG4gIGdldCBjdXJyZW50SGVhbHRoQXNQZXJjZW50YWdlKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuY3VycmVudEhlYWx0aCAvIHRoaXMubWF4SGVhbHRoO1xyXG4gIH1cclxufVxyXG4iLCJpbXBvcnQgeyBJUG9zaXRpb24gfSBmcm9tIFwiLi4vaW50ZXJmYWNlcy9wb3NpdGlvblwiO1xyXG5cclxuZXhwb3J0IGludGVyZmFjZSBTaGFwZU9wdGlvbnMge1xyXG4gIHg6IG51bWJlcjtcclxuICB5OiBudW1iZXI7XHJcbiAgaGVpZ2h0OiBudW1iZXI7XHJcbiAgd2lkdGg6IG51bWJlcjtcclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIFNoYXBlIHtcclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHB1YmxpYyB4OiBudW1iZXIsXHJcbiAgICBwdWJsaWMgeTogbnVtYmVyLFxyXG4gICAgcHVibGljIHdpZHRoOiBudW1iZXIsXHJcbiAgICBwdWJsaWMgaGVpZ2h0OiBudW1iZXJcclxuICApIHt9XHJcblxyXG4gIGNvbGxpZGVzV2l0aChvdGhlclNoYXBlOiBTaGFwZSk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIChcclxuICAgICAgdGhpcy50b3BMZWZ0LnggPCBvdGhlclNoYXBlLmJvdHRvbVJpZ2h0LnggJiZcclxuICAgICAgdGhpcy5ib3R0b21SaWdodC54ID4gb3RoZXJTaGFwZS50b3BMZWZ0LnggJiZcclxuICAgICAgdGhpcy50b3BMZWZ0LnkgPCBvdGhlclNoYXBlLmJvdHRvbVJpZ2h0LnkgJiZcclxuICAgICAgdGhpcy5ib3R0b21SaWdodC55ID4gb3RoZXJTaGFwZS50b3BSaWdodC55XHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgZXh0ZW5kc0JleW9uZChvdGhlclNoYXBlOiBTaGFwZSk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIChcclxuICAgICAgdGhpcy50b3BMZWZ0LnggPCBvdGhlclNoYXBlLnRvcExlZnQueCB8fFxyXG4gICAgICB0aGlzLmJvdHRvbVJpZ2h0LnggPiBvdGhlclNoYXBlLmJvdHRvbVJpZ2h0LnggfHxcclxuICAgICAgdGhpcy50b3BMZWZ0LnkgPCBvdGhlclNoYXBlLnRvcExlZnQueSB8fFxyXG4gICAgICB0aGlzLmJvdHRvbVJpZ2h0LnkgPiBvdGhlclNoYXBlLmJvdHRvbVJpZ2h0LnlcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBnZXQgdG9wTGVmdCgpOiBJUG9zaXRpb24ge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgeDogdGhpcy54LFxyXG4gICAgICB5OiB0aGlzLnksXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgZ2V0IHRvcFJpZ2h0KCk6IElQb3NpdGlvbiB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICB4OiB0aGlzLnggKyB0aGlzLndpZHRoLFxyXG4gICAgICB5OiB0aGlzLnksXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgZ2V0IGJvdHRvbUxlZnQoKTogSVBvc2l0aW9uIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHg6IHRoaXMueCxcclxuICAgICAgeTogdGhpcy55ICsgdGhpcy5oZWlnaHQsXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgZ2V0IGJvdHRvbVJpZ2h0KCk6IElQb3NpdGlvbiB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICB4OiB0aGlzLnggKyB0aGlzLndpZHRoLFxyXG4gICAgICB5OiB0aGlzLnkgKyB0aGlzLmhlaWdodCxcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBnZXQgY2VudGVyKCk6IElQb3NpdGlvbiB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICB4OiB0aGlzLnggKyB0aGlzLndpZHRoIC8gMixcclxuICAgICAgeTogdGhpcy55ICsgdGhpcy5oZWlnaHQgLyAyLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuIiwiaW1wb3J0IHsgU2hhcGUgfSBmcm9tIFwiLi9zaGFwZVwiO1xyXG5cclxuZXhwb3J0IGNsYXNzIE1vdmFibGVTaGFwZSBleHRlbmRzIFNoYXBlIHtcclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHg6IG51bWJlcixcclxuICAgIHk6IG51bWJlcixcclxuICAgIHdpZHRoOiBudW1iZXIsXHJcbiAgICBoZWlnaHQ6IG51bWJlcixcclxuICAgIHB1YmxpYyBkZWx0YVg6IG51bWJlciA9IDAsXHJcbiAgICBwdWJsaWMgZGVsdGFZOiBudW1iZXIgPSAwLFxyXG4gICAgcHVibGljIG1vdmVtZW50QW1vdW50OiBudW1iZXIgPSA1XHJcbiAgKSB7XHJcbiAgICBzdXBlcih4LCB5LCB3aWR0aCwgaGVpZ2h0KTtcclxuICB9XHJcblxyXG4gIG1vdmVCeShkZWx0YVg6IG51bWJlciwgZGVsdGFZOiBudW1iZXIpIHtcclxuICAgIHRoaXMueCArPSBkZWx0YVg7XHJcbiAgICB0aGlzLnkgKz0gZGVsdGFZO1xyXG4gIH1cclxuXHJcbiAgbW92ZSgpIHtcclxuICAgIHRoaXMueCArPSB0aGlzLmRlbHRhWDtcclxuICAgIHRoaXMueSArPSB0aGlzLmRlbHRhWTtcclxuICB9XHJcblxyXG4gIG1vdmVCYWNrKCkge1xyXG4gICAgdGhpcy5tb3ZlQnkoLXRoaXMuZGVsdGFYLCAtdGhpcy5kZWx0YVkpO1xyXG4gIH1cclxufVxyXG4iLCJpbXBvcnQgeyBNb3ZhYmxlU2hhcGUgfSBmcm9tIFwiLi9tb3ZhYmxlU2hhcGVcIjtcclxuaW1wb3J0IHsgSVBvc2l0aW9uIH0gZnJvbSBcIi4uL2ludGVyZmFjZXMvcG9zaXRpb25cIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBTaG90IGV4dGVuZHMgTW92YWJsZVNoYXBlIHtcclxuICBjb25zdHJ1Y3RvcihcclxuICAgIGZyb206IElQb3NpdGlvbixcclxuICAgIHRvOiBJUG9zaXRpb24sXHJcbiAgICB3aWR0aDogbnVtYmVyID0gNSxcclxuICAgIGhlaWdodDogbnVtYmVyID0gNSxcclxuICAgIHB1YmxpYyBzcGVlZDogbnVtYmVyID0gMTUsXHJcbiAgICBwdWJsaWMgZGFtYWdlOiBudW1iZXIgPSAxMFxyXG4gICkge1xyXG4gICAgc3VwZXIoZnJvbS54LCBmcm9tLnksIHdpZHRoLCBoZWlnaHQsIDAsIDApO1xyXG5cclxuICAgIGNvbnN0IG9yaWdpbmFsRGVsdGEgPSB7XHJcbiAgICAgIGRlbHRhWDogdG8ueCAtIGZyb20ueCwgLy8gQSBpbiBDQUhcclxuICAgICAgZGVsdGFZOiB0by55IC0gZnJvbS55LCAvLyBPIGluIFNPSFxyXG4gICAgfTtcclxuXHJcbiAgICBjb25zdCByYWRpYW5zID0gTWF0aC5hdGFuMihvcmlnaW5hbERlbHRhLmRlbHRhWSwgb3JpZ2luYWxEZWx0YS5kZWx0YVgpO1xyXG4gICAgdGhpcy5kZWx0YVggPSBNYXRoLmNvcyhyYWRpYW5zKSAqIHNwZWVkOyAvLyBDQUhcclxuICAgIHRoaXMuZGVsdGFZID0gTWF0aC5zaW4ocmFkaWFucykgKiBzcGVlZDsgLy8gU09IXHJcbiAgfVxyXG59XHJcbiIsImltcG9ydCB7IElQb3NpdGlvbiB9IGZyb20gXCIuLi9pbnRlcmZhY2VzL3Bvc2l0aW9uXCI7XHJcbmltcG9ydCB7IFNob3QgfSBmcm9tIFwiLi9zaG90XCI7XHJcblxyXG5leHBvcnQgY2xhc3MgU2hvb3RlciB7XHJcbiAgc2hvdHNGaXJlZDogU2hvdFtdO1xyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgdGhpcy5zaG90c0ZpcmVkID0gW107XHJcbiAgfVxyXG5cclxuICBzaG9vdChmcm9tOiBJUG9zaXRpb24sIGF0OiBJUG9zaXRpb24pIHtcclxuICAgIGNvbnN0IHNob3QgPSBuZXcgU2hvdChmcm9tLCBhdCk7XHJcbiAgICB0aGlzLnNob3RzRmlyZWQucHVzaChzaG90KTtcclxuICB9XHJcblxyXG4gIHJlbW92ZShzaG90VG9SZW1vdmU6IFNob3QpIHtcclxuICAgIHRoaXMuc2hvdHNGaXJlZCA9IHRoaXMuc2hvdHNGaXJlZC5maWx0ZXIoKHNob3QpID0+IHNob3RUb1JlbW92ZSAhPT0gc2hvdCk7XHJcbiAgfVxyXG59XHJcbiIsImltcG9ydCB7IEhlYWx0aCB9IGZyb20gXCIuLi9jb21wb25lbnRzL2hlYWx0aFwiO1xyXG5pbXBvcnQgeyBNb3ZhYmxlU2hhcGUgfSBmcm9tIFwiLi4vY29tcG9uZW50cy9tb3ZhYmxlU2hhcGVcIjtcclxuaW1wb3J0IHsgU2hvb3RlciB9IGZyb20gXCIuLi9jb21wb25lbnRzL3Nob290ZXJcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBDb21wdXRlclBsYXllciBleHRlbmRzIE1vdmFibGVTaGFwZSB7XHJcbiAgI2xhc3RBY3Rpb25zOiB7XHJcbiAgICBjaGFuZ2VkRGVsdGFYOiBudW1iZXI7XHJcbiAgICBjaGFuZ2VkRGVsdGFZOiBudW1iZXI7XHJcbiAgICBzaG90OiBudW1iZXI7XHJcbiAgfTtcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICB4OiBudW1iZXIsXHJcbiAgICB5OiBudW1iZXIsXHJcbiAgICBwdWJsaWMgaGVhbHRoOiBIZWFsdGgsXHJcbiAgICBwdWJsaWMgc2hvb3RlcjogU2hvb3RlcixcclxuICAgIHdpZHRoOiBudW1iZXIgPSAxMDAsXHJcbiAgICBoZWlnaHQ6IG51bWJlciA9IDEwMFxyXG4gICkge1xyXG4gICAgc3VwZXIoeCwgeSwgd2lkdGgsIGhlaWdodCk7XHJcblxyXG4gICAgY29uc3QgY3VycmVudFRpbWUgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcclxuICAgIHRoaXMuI2xhc3RBY3Rpb25zID0ge1xyXG4gICAgICBjaGFuZ2VkRGVsdGFYOiBjdXJyZW50VGltZSxcclxuICAgICAgY2hhbmdlZERlbHRhWTogY3VycmVudFRpbWUsXHJcbiAgICAgIHNob3Q6IGN1cnJlbnRUaW1lLFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIGdldCBzaG91bGRDaGFuZ2VEaXJlY3Rpb24oKSB7XHJcbiAgICByZXR1cm4gbmV3IERhdGUoKS5nZXRUaW1lKCkgPiB0aGlzLiNsYXN0QWN0aW9ucy5jaGFuZ2VkRGVsdGFYICsgMTAwO1xyXG4gIH1cclxuXHJcbiAgbWF5YmVDaGFuZ2VEaXJlY3Rpb24oKSB7XHJcbiAgICBpZiAodGhpcy5zaG91bGRDaGFuZ2VEaXJlY3Rpb24pIHtcclxuICAgICAgY29uc3QgbGVmdE9yUmlnaHQgPSBNYXRoLnJhbmRvbSgpIDwgMC41ID8gLTEgOiAxO1xyXG4gICAgICB0aGlzLmRlbHRhWCA9IE1hdGgucmFuZG9tKCkgKiA1ICogbGVmdE9yUmlnaHQ7XHJcblxyXG4gICAgICBjb25zdCB1cE9yRG93biA9IE1hdGgucmFuZG9tKCkgPCAwLjUgPyAtMSA6IDE7XHJcbiAgICAgIHRoaXMuZGVsdGFZID0gTWF0aC5yYW5kb20oKSAqIDUgKiB1cE9yRG93bjtcclxuXHJcbiAgICAgIGNvbnN0IGN1cnJlbnRUaW1lID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XHJcbiAgICAgIHRoaXMuI2xhc3RBY3Rpb25zLmNoYW5nZWREZWx0YVggPSBjdXJyZW50VGltZTtcclxuICAgICAgdGhpcy4jbGFzdEFjdGlvbnMuY2hhbmdlZERlbHRhWSA9IGN1cnJlbnRUaW1lO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgbW92ZSgpIHtcclxuICAgIHRoaXMubWF5YmVDaGFuZ2VEaXJlY3Rpb24oKTtcclxuICAgIHN1cGVyLm1vdmUoKTtcclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNyZWF0ZURlZmF1bHRDb21wdXRlclBsYXllcigpIHtcclxuICBjb25zdCBoZWFsdGggPSBuZXcgSGVhbHRoKDEwMCk7XHJcbiAgY29uc3Qgc2hvb3RlciA9IG5ldyBTaG9vdGVyKCk7XHJcbiAgcmV0dXJuIG5ldyBDb21wdXRlclBsYXllcig2MDAsIDIwMCwgaGVhbHRoLCBzaG9vdGVyKTtcclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IGRlZmF1bHRDb21wdXRlclBsYXllciA9IGNyZWF0ZURlZmF1bHRDb21wdXRlclBsYXllcigpO1xyXG4iLCJpbnRlcmZhY2UgQ29udHJvbE1hcCB7XHJcbiAgW2NvbnRyb2w6IHN0cmluZ106IGJvb2xlYW47XHJcbn1cclxuXHJcbnR5cGUgaW5wdXRIYW5kbGVyID0gKFxyXG4gIGlucHV0OiBzdHJpbmcsXHJcbiAgbmV3U3RhdGU6IGJvb2xlYW4sXHJcbiAgZTogTW91c2VFdmVudCB8IEtleWJvYXJkRXZlbnRcclxuKSA9PiB2b2lkO1xyXG5cclxuZXhwb3J0IGNsYXNzIENvbnRyb2xzIHtcclxuICBpbnB1dHM6IENvbnRyb2xNYXA7XHJcbiAgI29uSW5wdXQ6IGlucHV0SGFuZGxlcjtcclxuXHJcbiAgY29uc3RydWN0b3IoY2FudmFzOiBIVE1MQ2FudmFzRWxlbWVudCwgd2luZG93OiBXaW5kb3cpIHtcclxuICAgIC8vIE1pZ2h0IGJlIHdvcnRoIHNldHRpbmcgdGhpcyBvYmplY3QgdXAgYXMgYSBwcm94eT9cclxuICAgIHRoaXMuaW5wdXRzID0ge1xyXG4gICAgICBLZXlXOiBmYWxzZSxcclxuICAgICAgS2V5QTogZmFsc2UsXHJcbiAgICAgIEtleVM6IGZhbHNlLFxyXG4gICAgICBLZXlEOiBmYWxzZSxcclxuICAgICAgTE1COiBmYWxzZSxcclxuICAgIH07XHJcbiAgICB0aGlzLiNvbklucHV0ID0gKGlucHV0LCBuZXdWYWx1ZSkgPT4gY29uc29sZS5sb2coeyBpbnB1dCwgbmV3VmFsdWUgfSk7XHJcblxyXG4gICAgY29uc3QgY2xpY2tMaXN0ZW5lciA9IChlOiBNb3VzZUV2ZW50KSA9PiB7XHJcbiAgICAgIHRoaXMuaW5wdXRzLkxNQiA9IGUudHlwZSA9PT0gXCJtb3VzZWRvd25cIjtcclxuICAgICAgdGhpcy4jb25JbnB1dChcIkxNQlwiLCB0aGlzLmlucHV0cy5MTUIsIGUpO1xyXG4gICAgfTtcclxuXHJcbiAgICBjb25zdCBrZXlMaXN0ZW5lciA9IChlOiBLZXlib2FyZEV2ZW50KSA9PiB7XHJcbiAgICAgIGNvbnN0IHsgY29kZSB9ID0gZTtcclxuICAgICAgaWYgKHRoaXMuaW5wdXRzLmhhc093blByb3BlcnR5KGNvZGUpKSB7XHJcbiAgICAgICAgdGhpcy5pbnB1dHNbY29kZV0gPSBlLnR5cGUgPT09IFwia2V5ZG93blwiO1xyXG4gICAgICAgIHRoaXMuI29uSW5wdXQoY29kZSwgdGhpcy5pbnB1dHNbY29kZV0sIGUpO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIGNhbnZhcy5hZGRFdmVudExpc3RlbmVyKFwibW91c2V1cFwiLCBjbGlja0xpc3RlbmVyKTtcclxuICAgIGNhbnZhcy5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIGNsaWNrTGlzdGVuZXIpO1xyXG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXl1cFwiLCBrZXlMaXN0ZW5lcik7XHJcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwga2V5TGlzdGVuZXIpO1xyXG4gIH1cclxuXHJcbiAgc2V0IG9uSW5wdXRIYW5kbGVyKG5ld0hhbmRsZXI6IGlucHV0SGFuZGxlcikge1xyXG4gICAgdGhpcy4jb25JbnB1dCA9IG5ld0hhbmRsZXI7XHJcbiAgfVxyXG59XHJcbiIsImltcG9ydCB7IENvbnRyb2xzIH0gZnJvbSBcIi4uL2NvbXBvbmVudHMvY29udHJvbHNcIjtcclxuaW1wb3J0IHsgSGVhbHRoIH0gZnJvbSBcIi4uL2NvbXBvbmVudHMvaGVhbHRoXCI7XHJcbmltcG9ydCB7IE1vdmFibGVTaGFwZSB9IGZyb20gXCIuLi9jb21wb25lbnRzL21vdmFibGVTaGFwZVwiO1xyXG5pbXBvcnQgeyBTaG9vdGVyIH0gZnJvbSBcIi4uL2NvbXBvbmVudHMvc2hvb3RlclwiO1xyXG5cclxuZXhwb3J0IGNsYXNzIEh1bWFuUGxheWVyIGV4dGVuZHMgTW92YWJsZVNoYXBlIHtcclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHg6IG51bWJlcixcclxuICAgIHk6IG51bWJlcixcclxuICAgIHB1YmxpYyBoZWFsdGg6IEhlYWx0aCxcclxuICAgIHB1YmxpYyBjb250cm9sczogQ29udHJvbHMsXHJcbiAgICBwdWJsaWMgc2hvb3RlcjogU2hvb3RlcixcclxuICAgIHdpZHRoOiBudW1iZXIgPSAxMDAsXHJcbiAgICBoZWlnaHQ6IG51bWJlciA9IDEwMCxcclxuICAgIGRlbHRhWDogbnVtYmVyID0gMCxcclxuICAgIGRlbHRhWTogbnVtYmVyID0gMFxyXG4gICkge1xyXG4gICAgc3VwZXIoeCwgeSwgd2lkdGgsIGhlaWdodCwgZGVsdGFYLCBkZWx0YVkpO1xyXG4gICAgdGhpcy5jb250cm9scy5vbklucHV0SGFuZGxlciA9IChpbnB1dCwgbmV3U3RhdGUsIGV2ZW50KSA9PiB7XHJcbiAgICAgIGlmIChcIkxNQlwiID09PSBpbnB1dCAmJiBuZXdTdGF0ZSkge1xyXG4gICAgICAgIHRoaXMuc2hvb3Rlci5zaG9vdChcclxuICAgICAgICAgIHsgeDogdGhpcy5jZW50ZXIueCwgeTogdGhpcy5jZW50ZXIueSB9LFxyXG4gICAgICAgICAgeyB4OiAoZXZlbnQgYXMgTW91c2VFdmVudCkueCwgeTogKGV2ZW50IGFzIE1vdXNlRXZlbnQpLnkgfVxyXG4gICAgICAgICk7XHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgICB0aGlzLm1vdmVtZW50QW1vdW50ID0gNTtcclxuICB9XHJcblxyXG4gIG1vdmUoKSB7XHJcbiAgICBpZiAodGhpcy5jb250cm9scy5pbnB1dHMuS2V5Vykge1xyXG4gICAgICB0aGlzLmRlbHRhWSA9IC10aGlzLm1vdmVtZW50QW1vdW50O1xyXG4gICAgfSBlbHNlIGlmICh0aGlzLmNvbnRyb2xzLmlucHV0cy5LZXlTKSB7XHJcbiAgICAgIHRoaXMuZGVsdGFZID0gdGhpcy5tb3ZlbWVudEFtb3VudDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuZGVsdGFZID0gMDtcclxuICAgIH1cclxuXHJcbiAgICBpZiAodGhpcy5jb250cm9scy5pbnB1dHMuS2V5QSkge1xyXG4gICAgICB0aGlzLmRlbHRhWCA9IC10aGlzLm1vdmVtZW50QW1vdW50O1xyXG4gICAgfSBlbHNlIGlmICh0aGlzLmNvbnRyb2xzLmlucHV0cy5LZXlEKSB7XHJcbiAgICAgIHRoaXMuZGVsdGFYID0gdGhpcy5tb3ZlbWVudEFtb3VudDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuZGVsdGFYID0gMDtcclxuICAgIH1cclxuICAgIHN1cGVyLm1vdmUoKTtcclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNyZWF0ZURlZmF1bHRIdW1hblBsYXllcigpIHtcclxuICBjb25zdCBoZWFsdGggPSBuZXcgSGVhbHRoKDEwMCk7XHJcbiAgY29uc3QgY29udHJvbHMgPSBuZXcgQ29udHJvbHMoZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcImNhbnZhc1wiKSEsIHdpbmRvdyk7XHJcbiAgY29uc3Qgc2hvb3RlciA9IG5ldyBTaG9vdGVyKCk7XHJcbiAgcmV0dXJuIG5ldyBIdW1hblBsYXllcigzMDAsIDEwMCwgaGVhbHRoLCBjb250cm9scywgc2hvb3Rlcik7XHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBkZWZhdWx0SHVtYW5QbGF5ZXIgPSBjcmVhdGVEZWZhdWx0SHVtYW5QbGF5ZXIoKTtcclxuIiwiaW1wb3J0IHsgSGVhbHRoIH0gZnJvbSBcIi4uL2NvbXBvbmVudHMvaGVhbHRoXCI7XHJcbmltcG9ydCB7IFNoYXBlIH0gZnJvbSBcIi4uL2NvbXBvbmVudHMvc2hhcGVcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBPYnN0YWNsZSBleHRlbmRzIFNoYXBlIHtcclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHg6IG51bWJlcixcclxuICAgIHk6IG51bWJlcixcclxuICAgIHdpZHRoOiBudW1iZXIsXHJcbiAgICBoZWlnaHQ6IG51bWJlcixcclxuICAgIHB1YmxpYyBoZWFsdGg6IEhlYWx0aFxyXG4gICkge1xyXG4gICAgc3VwZXIoeCwgeSwgd2lkdGgsIGhlaWdodCk7XHJcbiAgfVxyXG59XHJcbiIsImltcG9ydCB7IGRlZmF1bHRDb21wdXRlclBsYXllciB9IGZyb20gXCIuL21vZGVsL2NsYXNzZXMvY29tcHV0ZXJQbGF5ZXJcIjtcclxuaW1wb3J0IHsgZGVmYXVsdEh1bWFuUGxheWVyIH0gZnJvbSBcIi4vbW9kZWwvY2xhc3Nlcy9odW1hblBsYXllclwiO1xyXG5pbXBvcnQgeyBPYnN0YWNsZSB9IGZyb20gXCIuL21vZGVsL2NsYXNzZXMvb2JzdGFjbGVcIjtcclxuaW1wb3J0IHsgV29ybGQgfSBmcm9tIFwiLi9tb2RlbC9jbGFzc2VzL3dvcmxkXCI7XHJcbmltcG9ydCB7IEhlYWx0aCB9IGZyb20gXCIuL21vZGVsL2NvbXBvbmVudHMvaGVhbHRoXCI7XHJcblxyXG5jb25zdCBwbGF5ZXJzID0gW2RlZmF1bHRIdW1hblBsYXllciwgZGVmYXVsdENvbXB1dGVyUGxheWVyXTtcclxuXHJcbmNvbnN0IG9ic3RhY2xlcyA9IFtcclxuICBuZXcgT2JzdGFjbGUoMjAwLCAyMDAsIDUwLCA1MCwgbmV3IEhlYWx0aCgyMDApKSxcclxuICBuZXcgT2JzdGFjbGUoMzAwLCAzMDAsIDIwLCAxNTAsIG5ldyBIZWFsdGgoMjAwKSksXHJcbiAgbmV3IE9ic3RhY2xlKDYwMCwgNDAwLCA5MCwgNzAsIG5ldyBIZWFsdGgoMjAwKSksXHJcbl07XHJcblxyXG5jb25zdCB3b3JsZCA9IG5ldyBXb3JsZCgpO1xyXG5cclxuZXhwb3J0IGNvbnN0IGRlZmF1bHRDb25maWcgPSB7XHJcbiAgcGxheWVycyxcclxuICBvYnN0YWNsZXMsXHJcbiAgd29ybGQsXHJcbn07XHJcbiIsImltcG9ydCB7IFNoYXBlIH0gZnJvbSBcIi4uL2NvbXBvbmVudHMvc2hhcGVcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBXb3JsZCBleHRlbmRzIFNoYXBlIHtcclxuICBjb25zdHJ1Y3Rvcih3aWR0aDogbnVtYmVyID0gODAwLCBoZWlnaHQ6IG51bWJlciA9IDUwMCkge1xyXG4gICAgc3VwZXIoMCwgMCwgd2lkdGgsIGhlaWdodCk7XHJcbiAgfVxyXG59XHJcbiIsImltcG9ydCB7IGRlZmF1bHRDb25maWcgfSBmcm9tIFwiLi9kZWZhdWx0R2FtZVNldHVwXCI7XHJcblxyXG5jb25zdCBnYW1lID0ge1xyXG4gIC4uLmRlZmF1bHRDb25maWcsXHJcbn07XHJcblxyXG5jb25zdCB7IHdvcmxkLCBwbGF5ZXJzLCBvYnN0YWNsZXMgfSA9IGRlZmF1bHRDb25maWc7XHJcbmNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJjYW52YXNcIikhO1xyXG5jb25zdCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpITtcclxuY2FudmFzLmhlaWdodCA9IHdvcmxkLmhlaWdodDtcclxuY2FudmFzLndpZHRoID0gd29ybGQud2lkdGg7XHJcblxyXG5jb25zdCB1cGRhdGUgPSBhc3luYyAoKSA9PiB7XHJcbiAgY3R4LmNsZWFyUmVjdCgwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpO1xyXG5cclxuICBmb3IgKGNvbnN0IG9ic3RhY2xlIG9mIG9ic3RhY2xlcykge1xyXG4gICAgLy8gT2JzdGFjbGVcclxuICAgIGN0eC5maWxsU3R5bGUgPSBcIiM3MDQzMDBcIjtcclxuICAgIGN0eC5maWxsUmVjdChvYnN0YWNsZS54LCBvYnN0YWNsZS55LCBvYnN0YWNsZS53aWR0aCwgb2JzdGFjbGUuaGVpZ2h0KTtcclxuXHJcbiAgICBjb25zdCB7IGN1cnJlbnRIZWFsdGggfSA9IG9ic3RhY2xlLmhlYWx0aDtcclxuXHJcbiAgICAvLyBPYnN0YWNsZSBIUCBiYXJcclxuICAgIGN0eC5maWxsU3R5bGUgPVxyXG4gICAgICBjdXJyZW50SGVhbHRoID4gNjAgPyBcImdyZWVuXCIgOiBjdXJyZW50SGVhbHRoID4gNDAgPyBcInllbGxvd1wiIDogXCJyZWRcIjtcclxuICAgIGN0eC5maWxsUmVjdChcclxuICAgICAgb2JzdGFjbGUueCxcclxuICAgICAgb2JzdGFjbGUueSAtIDQwLFxyXG4gICAgICBvYnN0YWNsZS5oZWFsdGguY3VycmVudEhlYWx0aEFzUGVyY2VudGFnZSAqIG9ic3RhY2xlLndpZHRoLFxyXG4gICAgICAyMFxyXG4gICAgKTtcclxuICAgIGN0eC5zdHJva2VTdHlsZSA9IFwiYmxhY2tcIjtcclxuICAgIGN0eC5saW5lV2lkdGggPSAyO1xyXG4gICAgY3R4LnN0cm9rZVJlY3Qob2JzdGFjbGUueCwgb2JzdGFjbGUueSAtIDQwLCBvYnN0YWNsZS53aWR0aCwgMjApO1xyXG4gIH1cclxuXHJcbiAgZm9yIChjb25zdCBwbGF5ZXIgb2YgcGxheWVycykge1xyXG4gICAgcGxheWVyLm1vdmUoKTtcclxuICAgIGlmIChcclxuICAgICAgb2JzdGFjbGVzLnNvbWUoKG9ic3RhY2xlKSA9PiB7XHJcbiAgICAgICAgaWYgKG9ic3RhY2xlLmNvbGxpZGVzV2l0aChwbGF5ZXIpKSB7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIkNvbGxpc2lvbiBiZXR3ZWVuIHBsYXllciBhbmQgb2JzdGFjbGUuXCIpO1xyXG4gICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KVxyXG4gICAgKSB7XHJcbiAgICAgIHBsYXllci5tb3ZlQmFjaygpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHsgY3VycmVudEhlYWx0aCB9ID0gcGxheWVyLmhlYWx0aDtcclxuXHJcbiAgICAvLyBQbGF5ZXIgc3ByaXRlXHJcbiAgICBjdHguZmlsbFN0eWxlID0gXCJyZWRcIjtcclxuICAgIGN0eC5maWxsUmVjdChwbGF5ZXIueCwgcGxheWVyLnksIHBsYXllci53aWR0aCwgcGxheWVyLmhlaWdodCk7XHJcblxyXG4gICAgLy8gUGxheWVyIEhQIGJhclxyXG4gICAgY3R4LmZpbGxTdHlsZSA9XHJcbiAgICAgIGN1cnJlbnRIZWFsdGggPiA2MCA/IFwiZ3JlZW5cIiA6IGN1cnJlbnRIZWFsdGggPiA0MCA/IFwieWVsbG93XCIgOiBcInJlZFwiO1xyXG4gICAgY3R4LmZpbGxSZWN0KFxyXG4gICAgICBwbGF5ZXIueCxcclxuICAgICAgcGxheWVyLnkgLSA0MCxcclxuICAgICAgcGxheWVyLmhlYWx0aC5jdXJyZW50SGVhbHRoQXNQZXJjZW50YWdlICogcGxheWVyLndpZHRoLFxyXG4gICAgICAyMFxyXG4gICAgKTtcclxuICAgIGN0eC5zdHJva2VTdHlsZSA9IFwiYmxhY2tcIjtcclxuICAgIGN0eC5saW5lV2lkdGggPSAyO1xyXG4gICAgY3R4LnN0cm9rZVJlY3QocGxheWVyLngsIHBsYXllci55IC0gNDAsIHBsYXllci53aWR0aCwgMjApO1xyXG5cclxuICAgIGZvciAoY29uc3Qgc2hvdCBvZiBwbGF5ZXIuc2hvb3Rlci5zaG90c0ZpcmVkKSB7XHJcbiAgICAgIHNob3QubW92ZSgpO1xyXG4gICAgICBjdHguZmlsbFN0eWxlID0gXCJnb2xkZW5yb2RcIjtcclxuICAgICAgY3R4LmZpbGxSZWN0KHNob3QueCwgc2hvdC55LCA3LCA3KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIGF3YWl0IG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDFlMykpO1xyXG4gIHJlcXVlc3RBbmltYXRpb25GcmFtZSh1cGRhdGUpO1xyXG59O1xyXG5cclxudXBkYXRlKCk7XHJcbiJdLCJzb3VyY2VSb290IjoiIn0=