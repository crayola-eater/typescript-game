(()=>{"use strict";class t{constructor(t,e=t){this.maxHealth=t,this.currentHealth=e}changeHealthBy(t){this.currentHealth+=t}get isDead(){return 0===this.currentHealth}get currentHealthAsPercentage(){return this.currentHealth/this.maxHealth}}class e{constructor(t,e,s,i){this.x=t,this.y=e,this.width=s,this.height=i}collidesWith(t){return this.topLeft.x<t.bottomRight.x&&this.bottomRight.x>t.topLeft.x&&this.topLeft.y<t.bottomRight.y&&this.bottomRight.y>t.topRight.y}collidesWithAny(...t){return t.some((t=>this.collidesWith(t)))}extendsBeyond(t){return this.topLeft.x<t.topLeft.x||this.bottomRight.x>t.bottomRight.x||this.topLeft.y<t.topLeft.y||this.bottomRight.y>t.bottomRight.y}get topLeft(){return{x:this.x,y:this.y}}get topRight(){return{x:this.x+this.width,y:this.y}}get bottomLeft(){return{x:this.x,y:this.y+this.height}}get bottomRight(){return{x:this.x+this.width,y:this.y+this.height}}get center(){return{x:this.x+this.width/2,y:this.y+this.height/2}}}class s extends e{constructor(t,e,s,i,n=0,o=0,h=5){super(t,e,s,i),this.deltaX=n,this.deltaY=o,this.movementAmount=h}moveBy(t,e){this.x+=t,this.y+=e}move(){this.x+=this.deltaX,this.y+=this.deltaY}moveBack(){this.moveBy(-this.deltaX,-this.deltaY)}}class i extends s{constructor(t,e,s=5,i=5,n=15,o=10){super(t.x,t.y,s,i,0,0),this.speed=n,this.damage=o;const h={deltaX:e.x-t.x,deltaY:e.y-t.y},r=Math.atan2(h.deltaY,h.deltaX);this.deltaX=Math.cos(r)*n,this.deltaY=Math.sin(r)*n}}class n{constructor(){this.shotsFired=[]}shoot(t,e){const s=new i(t,e);this.shotsFired.push(s)}remove(t){this.shotsFired=this.shotsFired.filter((e=>t!==e))}}var o,h=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};class r extends s{constructor(t,e,s,i,n=100,h=100){super(t,e,n,h),this.health=s,this.shooter=i,o.set(this,void 0);const r=(new Date).getTime();!function(t,e,s){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");e.set(t,s)}(this,o,{changedDeltaX:r,changedDeltaY:r,shot:r})}get shouldChangeDirection(){return(new Date).getTime()>h(this,o).changedDeltaX+100}maybeChangeDirection(){if(this.shouldChangeDirection){const t=Math.random()<.5?-1:1;this.deltaX=5*Math.random()*t;const e=Math.random()<.5?-1:1;this.deltaY=5*Math.random()*e;const s=(new Date).getTime();h(this,o).changedDeltaX=s,h(this,o).changedDeltaY=s}}move(){this.maybeChangeDirection(),super.move()}}o=new WeakMap;const a=function(){const e=new t(100),s=new n;return new r(600,200,e,s)}();var c,l=function(t,e,s){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,s),s},d=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};class u{constructor(t,e){c.set(this,void 0),this.inputs={KeyW:!1,KeyA:!1,KeyS:!1,KeyD:!1,LMB:!1},l(this,c,((t,e)=>console.log({input:t,newValue:e})));const s=t=>{0===t.button&&(this.inputs.LMB="mousedown"===t.type,d(this,c).call(this,"LMB",this.inputs.LMB,t))},i=t=>{const{code:e}=t;this.inputs.hasOwnProperty(e)&&(this.inputs[e]="keydown"===t.type,d(this,c).call(this,e,this.inputs[e],t))};t.addEventListener("mouseup",s),t.addEventListener("mousedown",s),e.addEventListener("keyup",i),e.addEventListener("keydown",i)}set onInputHandler(t){l(this,c,t)}}c=new WeakMap;class y extends s{constructor(t,e,s,i,n,o=100,h=100,r=0,a=0){super(t,e,o,h,r,a),this.health=s,this.controls=i,this.shooter=n,this.controls.onInputHandler=(t,e,s)=>{"LMB"===t&&e&&this.shooter.shoot({x:this.center.x,y:this.center.y},{x:s.x,y:s.y})},this.movementAmount=5}move(){this.controls.inputs.KeyW?this.deltaY=-this.movementAmount:this.controls.inputs.KeyS?this.deltaY=this.movementAmount:this.deltaY=0,this.controls.inputs.KeyA?this.deltaX=-this.movementAmount:this.controls.inputs.KeyD?this.deltaX=this.movementAmount:this.deltaX=0,super.move()}}const m=function(){const e=new t(100),s=new u(document.querySelector("canvas"),window),i=new n;return new y(300,100,e,s,i)}();class p extends e{constructor(t,e,s,i,n){super(t,e,s,i),this.health=n}}const w={players:[m,a],obstacles:[new p(200,200,50,50,new t(200)),new p(300,300,20,150,new t(200)),new p(600,400,90,70,new t(200))],world:new class extends e{constructor(t=800,e=500){super(0,0,t,e)}}};Object.assign({},w);const{world:g,players:f,obstacles:x}=w,v=document.querySelector("canvas"),R=v.getContext("2d");v.height=g.height,v.width=g.width;const b=()=>{return t=void 0,e=void 0,i=function*(){R.clearRect(0,0,v.width,v.height);for(const t of x){R.fillStyle="#704300",R.fillRect(t.x,t.y,t.width,t.height);const{currentHealth:e}=t.health;R.fillStyle=e>60?"green":e>40?"yellow":"red",R.fillRect(t.x,t.y-40,t.health.currentHealthAsPercentage*t.width,20),R.strokeStyle="black",R.lineWidth=2,R.strokeRect(t.x,t.y-40,t.width,20)}for(const t of f){t.move(),t.collidesWithAny(...x)&&t.moveBack();const{currentHealth:e}=t.health;R.fillStyle="red",R.fillRect(t.x,t.y,t.width,t.height),R.fillStyle=e>60?"green":e>40?"yellow":"red",R.fillRect(t.x,t.y-40,t.health.currentHealthAsPercentage*t.width,20),R.strokeStyle="black",R.lineWidth=2,R.strokeRect(t.x,t.y-40,t.width,20);for(const e of t.shooter.shotsFired)e.move(),x.some((t=>e.collidesWith(t)))&&(R.fillStyle="goldenrod"),R.fillRect(e.x,e.y,7,7)}requestAnimationFrame(b)},new((s=void 0)||(s=Promise))((function(n,o){function h(t){try{a(i.next(t))}catch(t){o(t)}}function r(t){try{a(i.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?n(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(h,r)}a((i=i.apply(t,e||[])).next())}));var t,e,s,i};b()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zbWFsbC1nYW1lLy4vc3JjL21vZGVsL2NvbXBvbmVudHMvaGVhbHRoLnRzIiwid2VicGFjazovL3NtYWxsLWdhbWUvLi9zcmMvbW9kZWwvY29tcG9uZW50cy9zaGFwZS50cyIsIndlYnBhY2s6Ly9zbWFsbC1nYW1lLy4vc3JjL21vZGVsL2NvbXBvbmVudHMvbW92YWJsZVNoYXBlLnRzIiwid2VicGFjazovL3NtYWxsLWdhbWUvLi9zcmMvbW9kZWwvY29tcG9uZW50cy9zaG90LnRzIiwid2VicGFjazovL3NtYWxsLWdhbWUvLi9zcmMvbW9kZWwvY29tcG9uZW50cy9zaG9vdGVyLnRzIiwid2VicGFjazovL3NtYWxsLWdhbWUvLi9zcmMvbW9kZWwvY2xhc3Nlcy9jb21wdXRlclBsYXllci50cyIsIndlYnBhY2s6Ly9zbWFsbC1nYW1lLy4vc3JjL21vZGVsL2NvbXBvbmVudHMvY29udHJvbHMudHMiLCJ3ZWJwYWNrOi8vc21hbGwtZ2FtZS8uL3NyYy9tb2RlbC9jbGFzc2VzL2h1bWFuUGxheWVyLnRzIiwid2VicGFjazovL3NtYWxsLWdhbWUvLi9zcmMvbW9kZWwvY2xhc3Nlcy9vYnN0YWNsZS50cyIsIndlYnBhY2s6Ly9zbWFsbC1nYW1lLy4vc3JjL2RlZmF1bHRHYW1lU2V0dXAudHMiLCJ3ZWJwYWNrOi8vc21hbGwtZ2FtZS8uL3NyYy9tb2RlbC9jbGFzc2VzL3dvcmxkLnRzIiwid2VicGFjazovL3NtYWxsLWdhbWUvLi9zcmMvaW5kZXgudHMiXSwibmFtZXMiOlsiSGVhbHRoIiwibWF4SGVhbHRoIiwiY3VycmVudEhlYWx0aCIsImNoYW5nZSIsInRoaXMiLCJTaGFwZSIsIngiLCJ5Iiwid2lkdGgiLCJoZWlnaHQiLCJvdGhlclNoYXBlIiwidG9wTGVmdCIsImJvdHRvbVJpZ2h0IiwidG9wUmlnaHQiLCJvdGhlclNoYXBlcyIsInNvbWUiLCJjb2xsaWRlc1dpdGgiLCJNb3ZhYmxlU2hhcGUiLCJkZWx0YVgiLCJkZWx0YVkiLCJtb3ZlbWVudEFtb3VudCIsInN1cGVyIiwibW92ZUJ5IiwiU2hvdCIsImZyb20iLCJ0byIsInNwZWVkIiwiZGFtYWdlIiwib3JpZ2luYWxEZWx0YSIsInJhZGlhbnMiLCJNYXRoIiwiYXRhbjIiLCJjb3MiLCJzaW4iLCJTaG9vdGVyIiwic2hvdHNGaXJlZCIsImF0Iiwic2hvdCIsInB1c2giLCJzaG90VG9SZW1vdmUiLCJmaWx0ZXIiLCJDb21wdXRlclBsYXllciIsImhlYWx0aCIsInNob290ZXIiLCJjdXJyZW50VGltZSIsIkRhdGUiLCJnZXRUaW1lIiwiY2hhbmdlZERlbHRhWCIsImNoYW5nZWREZWx0YVkiLCJzaG91bGRDaGFuZ2VEaXJlY3Rpb24iLCJsZWZ0T3JSaWdodCIsInJhbmRvbSIsInVwT3JEb3duIiwibWF5YmVDaGFuZ2VEaXJlY3Rpb24iLCJtb3ZlIiwiZGVmYXVsdENvbXB1dGVyUGxheWVyIiwiY3JlYXRlRGVmYXVsdENvbXB1dGVyUGxheWVyIiwiQ29udHJvbHMiLCJjYW52YXMiLCJ3aW5kb3ciLCJpbnB1dHMiLCJLZXlXIiwiS2V5QSIsIktleVMiLCJLZXlEIiwiTE1CIiwiaW5wdXQiLCJuZXdWYWx1ZSIsImNvbnNvbGUiLCJsb2ciLCJjbGlja0xpc3RlbmVyIiwiZSIsImJ1dHRvbiIsInR5cGUiLCJrZXlMaXN0ZW5lciIsImNvZGUiLCJoYXNPd25Qcm9wZXJ0eSIsImFkZEV2ZW50TGlzdGVuZXIiLCJuZXdIYW5kbGVyIiwiSHVtYW5QbGF5ZXIiLCJjb250cm9scyIsIm9uSW5wdXRIYW5kbGVyIiwibmV3U3RhdGUiLCJldmVudCIsInNob290IiwiY2VudGVyIiwiZGVmYXVsdEh1bWFuUGxheWVyIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiY3JlYXRlRGVmYXVsdEh1bWFuUGxheWVyIiwiT2JzdGFjbGUiLCJkZWZhdWx0Q29uZmlnIiwicGxheWVycyIsIm9ic3RhY2xlcyIsIndvcmxkIiwiY3R4IiwiZ2V0Q29udGV4dCIsInVwZGF0ZSIsImNsZWFyUmVjdCIsIm9ic3RhY2xlIiwiZmlsbFN0eWxlIiwiZmlsbFJlY3QiLCJjdXJyZW50SGVhbHRoQXNQZXJjZW50YWdlIiwic3Ryb2tlU3R5bGUiLCJsaW5lV2lkdGgiLCJzdHJva2VSZWN0IiwicGxheWVyIiwiY29sbGlkZXNXaXRoQW55IiwibW92ZUJhY2siLCJyZXF1ZXN0QW5pbWF0aW9uRnJhbWUiXSwibWFwcGluZ3MiOiJtQkFBTyxNQUFNQSxFQUNYLFlBQ1NDLEVBQ0FDLEVBQXdCRCxHQUR4QixLQUFBQSxZQUNBLEtBQUFDLGdCQUdULGVBQWVDLEdBQ2JDLEtBQUtGLGVBQWlCQyxFQUd4QixhQUNFLE9BQThCLElBQXZCQyxLQUFLRixjQUdkLGdDQUNFLE9BQU9FLEtBQUtGLGNBQWdCRSxLQUFLSCxXQ045QixNQUFNSSxFQUNYLFlBQ1NDLEVBQ0FDLEVBQ0FDLEVBQ0FDLEdBSEEsS0FBQUgsSUFDQSxLQUFBQyxJQUNBLEtBQUFDLFFBQ0EsS0FBQUMsU0FHVCxhQUFhQyxHQUNYLE9BQ0VOLEtBQUtPLFFBQVFMLEVBQUlJLEVBQVdFLFlBQVlOLEdBQ3hDRixLQUFLUSxZQUFZTixFQUFJSSxFQUFXQyxRQUFRTCxHQUN4Q0YsS0FBS08sUUFBUUosRUFBSUcsRUFBV0UsWUFBWUwsR0FDeENILEtBQUtRLFlBQVlMLEVBQUlHLEVBQVdHLFNBQVNOLEVBSTdDLG1CQUFtQk8sR0FDakIsT0FBT0EsRUFBWUMsTUFBTUwsR0FBZU4sS0FBS1ksYUFBYU4sS0FHNUQsY0FBY0EsR0FDWixPQUNFTixLQUFLTyxRQUFRTCxFQUFJSSxFQUFXQyxRQUFRTCxHQUNwQ0YsS0FBS1EsWUFBWU4sRUFBSUksRUFBV0UsWUFBWU4sR0FDNUNGLEtBQUtPLFFBQVFKLEVBQUlHLEVBQVdDLFFBQVFKLEdBQ3BDSCxLQUFLUSxZQUFZTCxFQUFJRyxFQUFXRSxZQUFZTCxFQUloRCxjQUNFLE1BQU8sQ0FDTEQsRUFBR0YsS0FBS0UsRUFDUkMsRUFBR0gsS0FBS0csR0FJWixlQUNFLE1BQU8sQ0FDTEQsRUFBR0YsS0FBS0UsRUFBSUYsS0FBS0ksTUFDakJELEVBQUdILEtBQUtH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TUFBT2tHLEVBQU9qRyxRQUd0RHNGLEVBQUlLLFVBQ0ZsRyxFQUFnQixHQUFLLFFBQVVBLEVBQWdCLEdBQUssU0FBVyxNQUNqRTZGLEVBQUlNLFNBQ0ZLLEVBQU9wRyxFQUNQb0csRUFBT25HLEVBQUksR0FDWG1HLEVBQU9oRSxPQUFPNEQsMEJBQTRCSSxFQUFPbEcsTUFDakQsSUFFRnVGLEVBQUlRLFlBQWMsUUFDbEJSLEVBQUlTLFVBQVksRUFDaEJULEVBQUlVLFdBQVdDLEVBQU9wRyxFQUFHb0csRUFBT25HLEVBQUksR0FBSW1HLEVBQU9sRyxNQUFPLElBR3RELElBQUssTUFBTTZCLEtBQVFxRSxFQUFPL0QsUUFBUVIsV0FDaENFLEVBQUtpQixPQUVELEVBQVV2QyxNQUFNb0YsR0FBYTlELEVBQUtyQixhQUFhbUYsT0FDakRKLEVBQUlLLFVBQVksYUFDbEJMLEVBQUlNLFNBQVNoRSxFQUFLL0IsRUFBRytCLEVBQUs5QixFQUFHLEVBQUcsR0FLcENzRyxzQkFBc0JaLEksWUFoRUUsSywrUUFtRTFCQSxLIiwiZmlsZSI6ImJ1bmRsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBjbGFzcyBIZWFsdGgge1xyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHVibGljIG1heEhlYWx0aDogbnVtYmVyLFxyXG4gICAgcHVibGljIGN1cnJlbnRIZWFsdGg6IG51bWJlciA9IG1heEhlYWx0aFxyXG4gICkge31cclxuXHJcbiAgY2hhbmdlSGVhbHRoQnkoY2hhbmdlOiBudW1iZXIpIHtcclxuICAgIHRoaXMuY3VycmVudEhlYWx0aCArPSBjaGFuZ2U7XHJcbiAgfVxyXG5cclxuICBnZXQgaXNEZWFkKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuY3VycmVudEhlYWx0aCA9PT0gMDtcclxuICB9XHJcblxyXG4gIGdldCBjdXJyZW50SGVhbHRoQXNQZXJjZW50YWdlKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuY3VycmVudEhlYWx0aCAvIHRoaXMubWF4SGVhbHRoO1xyXG4gIH1cclxufVxyXG4iLCJpbXBvcnQgeyBJUG9zaXRpb24gfSBmcm9tIFwiLi4vaW50ZXJmYWNlcy9wb3NpdGlvblwiO1xyXG5cclxuZXhwb3J0IGludGVyZmFjZSBTaGFwZU9wdGlvbnMge1xyXG4gIHg6IG51bWJlcjtcclxuICB5OiBudW1iZXI7XHJcbiAgaGVpZ2h0OiBudW1iZXI7XHJcbiAgd2lkdGg6IG51bWJlcjtcclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIFNoYXBlIHtcclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHB1YmxpYyB4OiBudW1iZXIsXHJcbiAgICBwdWJsaWMgeTogbnVtYmVyLFxyXG4gICAgcHVibGljIHdpZHRoOiBudW1iZXIsXHJcbiAgICBwdWJsaWMgaGVpZ2h0OiBudW1iZXJcclxuICApIHt9XHJcblxyXG4gIGNvbGxpZGVzV2l0aChvdGhlclNoYXBlOiBTaGFwZSk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIChcclxuICAgICAgdGhpcy50b3BMZWZ0LnggPCBvdGhlclNoYXBlLmJvdHRvbVJpZ2h0LnggJiZcclxuICAgICAgdGhpcy5ib3R0b21SaWdodC54ID4gb3RoZXJTaGFwZS50b3BMZWZ0LnggJiZcclxuICAgICAgdGhpcy50b3BMZWZ0LnkgPCBvdGhlclNoYXBlLmJvdHRvbVJpZ2h0LnkgJiZcclxuICAgICAgdGhpcy5ib3R0b21SaWdodC55ID4gb3RoZXJTaGFwZS50b3BSaWdodC55XHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgY29sbGlkZXNXaXRoQW55KC4uLm90aGVyU2hhcGVzOiBTaGFwZVtdKSB7XHJcbiAgICByZXR1cm4gb3RoZXJTaGFwZXMuc29tZSgob3RoZXJTaGFwZSkgPT4gdGhpcy5jb2xsaWRlc1dpdGgob3RoZXJTaGFwZSkpO1xyXG4gIH1cclxuXHJcbiAgZXh0ZW5kc0JleW9uZChvdGhlclNoYXBlOiBTaGFwZSk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIChcclxuICAgICAgdGhpcy50b3BMZWZ0LnggPCBvdGhlclNoYXBlLnRvcExlZnQueCB8fFxyXG4gICAgICB0aGlzLmJvdHRvbVJpZ2h0LnggPiBvdGhlclNoYXBlLmJvdHRvbVJpZ2h0LnggfHxcclxuICAgICAgdGhpcy50b3BMZWZ0LnkgPCBvdGhlclNoYXBlLnRvcExlZnQueSB8fFxyXG4gICAgICB0aGlzLmJvdHRvbVJpZ2h0LnkgPiBvdGhlclNoYXBlLmJvdHRvbVJpZ2h0LnlcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBnZXQgdG9wTGVmdCgpOiBJUG9zaXRpb24ge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgeDogdGhpcy54LFxyXG4gICAgICB5OiB0aGlzLnksXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgZ2V0IHRvcFJpZ2h0KCk6IElQb3NpdGlvbiB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICB4OiB0aGlzLnggKyB0aGlzLndpZHRoLFxyXG4gICAgICB5OiB0aGlzLnksXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgZ2V0IGJvdHRvbUxlZnQoKTogSVBvc2l0aW9uIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHg6IHRoaXMueCxcclxuICAgICAgeTogdGhpcy55ICsgdGhpcy5oZWlnaHQsXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgZ2V0IGJvdHRvbVJpZ2h0KCk6IElQb3NpdGlvbiB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICB4OiB0aGlzLnggKyB0aGlzLndpZHRoLFxyXG4gICAgICB5OiB0aGlzLnkgKyB0aGlzLmhlaWdodCxcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBnZXQgY2VudGVyKCk6IElQb3NpdGlvbiB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICB4OiB0aGlzLnggKyB0aGlzLndpZHRoIC8gMixcclxuICAgICAgeTogdGhpcy55ICsgdGhpcy5oZWlnaHQgLyAyLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuIiwiaW1wb3J0IHsgU2hhcGUgfSBmcm9tIFwiLi9zaGFwZVwiO1xyXG5cclxuZXhwb3J0IGNsYXNzIE1vdmFibGVTaGFwZSBleHRlbmRzIFNoYXBlIHtcclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHg6IG51bWJlcixcclxuICAgIHk6IG51bWJlcixcclxuICAgIHdpZHRoOiBudW1iZXIsXHJcbiAgICBoZWlnaHQ6IG51bWJlcixcclxuICAgIHB1YmxpYyBkZWx0YVg6IG51bWJlciA9IDAsXHJcbiAgICBwdWJsaWMgZGVsdGFZOiBudW1iZXIgPSAwLFxyXG4gICAgcHVibGljIG1vdmVtZW50QW1vdW50OiBudW1iZXIgPSA1XHJcbiAgKSB7XHJcbiAgICBzdXBlcih4LCB5LCB3aWR0aCwgaGVpZ2h0KTtcclxuICB9XHJcblxyXG4gIG1vdmVCeShkZWx0YVg6IG51bWJlciwgZGVsdGFZOiBudW1iZXIpIHtcclxuICAgIHRoaXMueCArPSBkZWx0YVg7XHJcbiAgICB0aGlzLnkgKz0gZGVsdGFZO1xyXG4gIH1cclxuXHJcbiAgbW92ZSgpIHtcclxuICAgIHRoaXMueCArPSB0aGlzLmRlbHRhWDtcclxuICAgIHRoaXMueSArPSB0aGlzLmRlbHRhWTtcclxuICB9XHJcblxyXG4gIG1vdmVCYWNrKCkge1xyXG4gICAgdGhpcy5tb3ZlQnkoLXRoaXMuZGVsdGFYLCAtdGhpcy5kZWx0YVkpO1xyXG4gIH1cclxufVxyXG4iLCJpbXBvcnQgeyBNb3ZhYmxlU2hhcGUgfSBmcm9tIFwiLi9tb3ZhYmxlU2hhcGVcIjtcclxuaW1wb3J0IHsgSVBvc2l0aW9uIH0gZnJvbSBcIi4uL2ludGVyZmFjZXMvcG9zaXRpb25cIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBTaG90IGV4dGVuZHMgTW92YWJsZVNoYXBlIHtcclxuICBjb25zdHJ1Y3RvcihcclxuICAgIGZyb206IElQb3NpdGlvbixcclxuICAgIHRvOiBJUG9zaXRpb24sXHJcbiAgICB3aWR0aDogbnVtYmVyID0gNSxcclxuICAgIGhlaWdodDogbnVtYmVyID0gNSxcclxuICAgIHB1YmxpYyBzcGVlZDogbnVtYmVyID0gMTUsXHJcbiAgICBwdWJsaWMgZGFtYWdlOiBudW1iZXIgPSAxMFxyXG4gICkge1xyXG4gICAgc3VwZXIoZnJvbS54LCBmcm9tLnksIHdpZHRoLCBoZWlnaHQsIDAsIDApO1xyXG5cclxuICAgIGNvbnN0IG9yaWdpbmFsRGVsdGEgPSB7XHJcbiAgICAgIGRlbHRhWDogdG8ueCAtIGZyb20ueCwgLy8gQSBpbiBDQUhcclxuICAgICAgZGVsdGFZOiB0by55IC0gZnJvbS55LCAvLyBPIGluIFNPSFxyXG4gICAgfTtcclxuXHJcbiAgICBjb25zdCByYWRpYW5zID0gTWF0aC5hdGFuMihvcmlnaW5hbERlbHRhLmRlbHRhWSwgb3JpZ2luYWxEZWx0YS5kZWx0YVgpO1xyXG4gICAgdGhpcy5kZWx0YVggPSBNYXRoLmNvcyhyYWRpYW5zKSAqIHNwZWVkOyAvLyBDQUhcclxuICAgIHRoaXMuZGVsdGFZID0gTWF0aC5zaW4ocmFkaWFucykgKiBzcGVlZDsgLy8gU09IXHJcbiAgfVxyXG59XHJcbiIsImltcG9ydCB7IElQb3NpdGlvbiB9IGZyb20gXCIuLi9pbnRlcmZhY2VzL3Bvc2l0aW9uXCI7XHJcbmltcG9ydCB7IFNob3QgfSBmcm9tIFwiLi9zaG90XCI7XHJcblxyXG5leHBvcnQgY2xhc3MgU2hvb3RlciB7XHJcbiAgc2hvdHNGaXJlZDogU2hvdFtdO1xyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgdGhpcy5zaG90c0ZpcmVkID0gW107XHJcbiAgfVxyXG5cclxuICBzaG9vdChmcm9tOiBJUG9zaXRpb24sIGF0OiBJUG9zaXRpb24pIHtcclxuICAgIGNvbnN0IHNob3QgPSBuZXcgU2hvdChmcm9tLCBhdCk7XHJcbiAgICB0aGlzLnNob3RzRmlyZWQucHVzaChzaG90KTtcclxuICB9XHJcblxyXG4gIHJlbW92ZShzaG90VG9SZW1vdmU6IFNob3QpIHtcclxuICAgIHRoaXMuc2hvdHNGaXJlZCA9IHRoaXMuc2hvdHNGaXJlZC5maWx0ZXIoKHNob3QpID0+IHNob3RUb1JlbW92ZSAhPT0gc2hvdCk7XHJcbiAgfVxyXG59XHJcbiIsImltcG9ydCB7IEhlYWx0aCB9IGZyb20gXCIuLi9jb21wb25lbnRzL2hlYWx0aFwiO1xyXG5pbXBvcnQgeyBNb3ZhYmxlU2hhcGUgfSBmcm9tIFwiLi4vY29tcG9uZW50cy9tb3ZhYmxlU2hhcGVcIjtcclxuaW1wb3J0IHsgU2hvb3RlciB9IGZyb20gXCIuLi9jb21wb25lbnRzL3Nob290ZXJcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBDb21wdXRlclBsYXllciBleHRlbmRzIE1vdmFibGVTaGFwZSB7XHJcbiAgI2xhc3RBY3Rpb25zOiB7XHJcbiAgICBjaGFuZ2VkRGVsdGFYOiBudW1iZXI7XHJcbiAgICBjaGFuZ2VkRGVsdGFZOiBudW1iZXI7XHJcbiAgICBzaG90OiBudW1iZXI7XHJcbiAgfTtcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICB4OiBudW1iZXIsXHJcbiAgICB5OiBudW1iZXIsXHJcbiAgICBwdWJsaWMgaGVhbHRoOiBIZWFsdGgsXHJcbiAgICBwdWJsaWMgc2hvb3RlcjogU2hvb3RlcixcclxuICAgIHdpZHRoOiBudW1iZXIgPSAxMDAsXHJcbiAgICBoZWlnaHQ6IG51bWJlciA9IDEwMFxyXG4gICkge1xyXG4gICAgc3VwZXIoeCwgeSwgd2lkdGgsIGhlaWdodCk7XHJcblxyXG4gICAgY29uc3QgY3VycmVudFRpbWUgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcclxuICAgIHRoaXMuI2xhc3RBY3Rpb25zID0ge1xyXG4gICAgICBjaGFuZ2VkRGVsdGFYOiBjdXJyZW50VGltZSxcclxuICAgICAgY2hhbmdlZERlbHRhWTogY3VycmVudFRpbWUsXHJcbiAgICAgIHNob3Q6IGN1cnJlbnRUaW1lLFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIGdldCBzaG91bGRDaGFuZ2VEaXJlY3Rpb24oKSB7XHJcbiAgICByZXR1cm4gbmV3IERhdGUoKS5nZXRUaW1lKCkgPiB0aGlzLiNsYXN0QWN0aW9ucy5jaGFuZ2VkRGVsdGFYICsgMTAwO1xyXG4gIH1cclxuXHJcbiAgbWF5YmVDaGFuZ2VEaXJlY3Rpb24oKSB7XHJcbiAgICBpZiAodGhpcy5zaG91bGRDaGFuZ2VEaXJlY3Rpb24pIHtcclxuICAgICAgY29uc3QgbGVmdE9yUmlnaHQgPSBNYXRoLnJhbmRvbSgpIDwgMC41ID8gLTEgOiAxO1xyXG4gICAgICB0aGlzLmRlbHRhWCA9IE1hdGgucmFuZG9tKCkgKiA1ICogbGVmdE9yUmlnaHQ7XHJcblxyXG4gICAgICBjb25zdCB1cE9yRG93biA9IE1hdGgucmFuZG9tKCkgPCAwLjUgPyAtMSA6IDE7XHJcbiAgICAgIHRoaXMuZGVsdGFZID0gTWF0aC5yYW5kb20oKSAqIDUgKiB1cE9yRG93bjtcclxuXHJcbiAgICAgIGNvbnN0IGN1cnJlbnRUaW1lID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XHJcbiAgICAgIHRoaXMuI2xhc3RBY3Rpb25zLmNoYW5nZWREZWx0YVggPSBjdXJyZW50VGltZTtcclxuICAgICAgdGhpcy4jbGFzdEFjdGlvbnMuY2hhbmdlZERlbHRhWSA9IGN1cnJlbnRUaW1lO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgbW92ZSgpIHtcclxuICAgIHRoaXMubWF5YmVDaGFuZ2VEaXJlY3Rpb24oKTtcclxuICAgIHN1cGVyLm1vdmUoKTtcclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNyZWF0ZURlZmF1bHRDb21wdXRlclBsYXllcigpIHtcclxuICBjb25zdCBoZWFsdGggPSBuZXcgSGVhbHRoKDEwMCk7XHJcbiAgY29uc3Qgc2hvb3RlciA9IG5ldyBTaG9vdGVyKCk7XHJcbiAgcmV0dXJuIG5ldyBDb21wdXRlclBsYXllcig2MDAsIDIwMCwgaGVhbHRoLCBzaG9vdGVyKTtcclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IGRlZmF1bHRDb21wdXRlclBsYXllciA9IGNyZWF0ZURlZmF1bHRDb21wdXRlclBsYXllcigpO1xyXG4iLCJpbnRlcmZhY2UgQ29udHJvbE1hcCB7XHJcbiAgW2NvbnRyb2w6IHN0cmluZ106IGJvb2xlYW47XHJcbn1cclxuXHJcbnR5cGUgaW5wdXRIYW5kbGVyID0gKFxyXG4gIGlucHV0OiBzdHJpbmcsXHJcbiAgbmV3U3RhdGU6IGJvb2xlYW4sXHJcbiAgZTogTW91c2VFdmVudCB8IEtleWJvYXJkRXZlbnRcclxuKSA9PiB2b2lkO1xyXG5cclxuZXhwb3J0IGNsYXNzIENvbnRyb2xzIHtcclxuICBpbnB1dHM6IENvbnRyb2xNYXA7XHJcbiAgI29uSW5wdXQ6IGlucHV0SGFuZGxlcjtcclxuXHJcbiAgY29uc3RydWN0b3IoY2FudmFzOiBIVE1MQ2FudmFzRWxlbWVudCwgd2luZG93OiBXaW5kb3cpIHtcclxuICAgIC8vIE1pZ2h0IGJlIHdvcnRoIHNldHRpbmcgdGhpcyBvYmplY3QgdXAgYXMgYSBwcm94eT9cclxuICAgIHRoaXMuaW5wdXRzID0ge1xyXG4gICAgICBLZXlXOiBmYWxzZSxcclxuICAgICAgS2V5QTogZmFsc2UsXHJcbiAgICAgIEtleVM6IGZhbHNlLFxyXG4gICAgICBLZXlEOiBmYWxzZSxcclxuICAgICAgTE1COiBmYWxzZSxcclxuICAgIH07XHJcbiAgICB0aGlzLiNvbklucHV0ID0gKGlucHV0LCBuZXdWYWx1ZSkgPT4gY29uc29sZS5sb2coeyBpbnB1dCwgbmV3VmFsdWUgfSk7XHJcblxyXG4gICAgY29uc3QgY2xpY2tMaXN0ZW5lciA9IChlOiBNb3VzZUV2ZW50KSA9PiB7XHJcbiAgICAgIGlmICgwID09PSBlLmJ1dHRvbikge1xyXG4gICAgICAgIHRoaXMuaW5wdXRzLkxNQiA9IGUudHlwZSA9PT0gXCJtb3VzZWRvd25cIjtcclxuICAgICAgICB0aGlzLiNvbklucHV0KFwiTE1CXCIsIHRoaXMuaW5wdXRzLkxNQiwgZSk7XHJcbiAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgY29uc3Qga2V5TGlzdGVuZXIgPSAoZTogS2V5Ym9hcmRFdmVudCkgPT4ge1xyXG4gICAgICBjb25zdCB7IGNvZGUgfSA9IGU7XHJcbiAgICAgIGlmICh0aGlzLmlucHV0cy5oYXNPd25Qcm9wZXJ0eShjb2RlKSkge1xyXG4gICAgICAgIHRoaXMuaW5wdXRzW2NvZGVdID0gZS50eXBlID09PSBcImtleWRvd25cIjtcclxuICAgICAgICB0aGlzLiNvbklucHV0KGNvZGUsIHRoaXMuaW5wdXRzW2NvZGVdLCBlKTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBjYW52YXMuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNldXBcIiwgY2xpY2tMaXN0ZW5lcik7XHJcbiAgICBjYW52YXMuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCBjbGlja0xpc3RlbmVyKTtcclxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwia2V5dXBcIiwga2V5TGlzdGVuZXIpO1xyXG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGtleUxpc3RlbmVyKTtcclxuICB9XHJcblxyXG4gIHNldCBvbklucHV0SGFuZGxlcihuZXdIYW5kbGVyOiBpbnB1dEhhbmRsZXIpIHtcclxuICAgIHRoaXMuI29uSW5wdXQgPSBuZXdIYW5kbGVyO1xyXG4gIH1cclxufVxyXG4iLCJpbXBvcnQgeyBDb250cm9scyB9IGZyb20gXCIuLi9jb21wb25lbnRzL2NvbnRyb2xzXCI7XHJcbmltcG9ydCB7IEhlYWx0aCB9IGZyb20gXCIuLi9jb21wb25lbnRzL2hlYWx0aFwiO1xyXG5pbXBvcnQgeyBNb3ZhYmxlU2hhcGUgfSBmcm9tIFwiLi4vY29tcG9uZW50cy9tb3ZhYmxlU2hhcGVcIjtcclxuaW1wb3J0IHsgU2hvb3RlciB9IGZyb20gXCIuLi9jb21wb25lbnRzL3Nob290ZXJcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBIdW1hblBsYXllciBleHRlbmRzIE1vdmFibGVTaGFwZSB7XHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICB4OiBudW1iZXIsXHJcbiAgICB5OiBudW1iZXIsXHJcbiAgICBwdWJsaWMgaGVhbHRoOiBIZWFsdGgsXHJcbiAgICBwdWJsaWMgY29udHJvbHM6IENvbnRyb2xzLFxyXG4gICAgcHVibGljIHNob290ZXI6IFNob290ZXIsXHJcbiAgICB3aWR0aDogbnVtYmVyID0gMTAwLFxyXG4gICAgaGVpZ2h0OiBudW1iZXIgPSAxMDAsXHJcbiAgICBkZWx0YVg6IG51bWJlciA9IDAsXHJcbiAgICBkZWx0YVk6IG51bWJlciA9IDBcclxuICApIHtcclxuICAgIHN1cGVyKHgsIHksIHdpZHRoLCBoZWlnaHQsIGRlbHRhWCwgZGVsdGFZKTtcclxuICAgIHRoaXMuY29udHJvbHMub25JbnB1dEhhbmRsZXIgPSAoaW5wdXQsIG5ld1N0YXRlLCBldmVudCkgPT4ge1xyXG4gICAgICBpZiAoXCJMTUJcIiA9PT0gaW5wdXQgJiYgbmV3U3RhdGUpIHtcclxuICAgICAgICB0aGlzLnNob290ZXIuc2hvb3QoXHJcbiAgICAgICAgICB7IHg6IHRoaXMuY2VudGVyLngsIHk6IHRoaXMuY2VudGVyLnkgfSxcclxuICAgICAgICAgIHsgeDogKGV2ZW50IGFzIE1vdXNlRXZlbnQpLngsIHk6IChldmVudCBhcyBNb3VzZUV2ZW50KS55IH1cclxuICAgICAgICApO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gICAgdGhpcy5tb3ZlbWVudEFtb3VudCA9IDU7XHJcbiAgfVxyXG5cclxuICBtb3ZlKCkge1xyXG4gICAgaWYgKHRoaXMuY29udHJvbHMuaW5wdXRzLktleVcpIHtcclxuICAgICAgdGhpcy5kZWx0YVkgPSAtdGhpcy5tb3ZlbWVudEFtb3VudDtcclxuICAgIH0gZWxzZSBpZiAodGhpcy5jb250cm9scy5pbnB1dHMuS2V5Uykge1xyXG4gICAgICB0aGlzLmRlbHRhWSA9IHRoaXMubW92ZW1lbnRBbW91bnQ7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLmRlbHRhWSA9IDA7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRoaXMuY29udHJvbHMuaW5wdXRzLktleUEpIHtcclxuICAgICAgdGhpcy5kZWx0YVggPSAtdGhpcy5tb3ZlbWVudEFtb3VudDtcclxuICAgIH0gZWxzZSBpZiAodGhpcy5jb250cm9scy5pbnB1dHMuS2V5RCkge1xyXG4gICAgICB0aGlzLmRlbHRhWCA9IHRoaXMubW92ZW1lbnRBbW91bnQ7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLmRlbHRhWCA9IDA7XHJcbiAgICB9XHJcbiAgICBzdXBlci5tb3ZlKCk7XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBjcmVhdGVEZWZhdWx0SHVtYW5QbGF5ZXIoKSB7XHJcbiAgY29uc3QgaGVhbHRoID0gbmV3IEhlYWx0aCgxMDApO1xyXG4gIGNvbnN0IGNvbnRyb2xzID0gbmV3IENvbnRyb2xzKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJjYW52YXNcIikhLCB3aW5kb3cpO1xyXG4gIGNvbnN0IHNob290ZXIgPSBuZXcgU2hvb3RlcigpO1xyXG4gIHJldHVybiBuZXcgSHVtYW5QbGF5ZXIoMzAwLCAxMDAsIGhlYWx0aCwgY29udHJvbHMsIHNob290ZXIpO1xyXG59XHJcblxyXG5leHBvcnQgY29uc3QgZGVmYXVsdEh1bWFuUGxheWVyID0gY3JlYXRlRGVmYXVsdEh1bWFuUGxheWVyKCk7XHJcbiIsImltcG9ydCB7IEhlYWx0aCB9IGZyb20gXCIuLi9jb21wb25lbnRzL2hlYWx0aFwiO1xyXG5pbXBvcnQgeyBTaGFwZSB9IGZyb20gXCIuLi9jb21wb25lbnRzL3NoYXBlXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgT2JzdGFjbGUgZXh0ZW5kcyBTaGFwZSB7XHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICB4OiBudW1iZXIsXHJcbiAgICB5OiBudW1iZXIsXHJcbiAgICB3aWR0aDogbnVtYmVyLFxyXG4gICAgaGVpZ2h0OiBudW1iZXIsXHJcbiAgICBwdWJsaWMgaGVhbHRoOiBIZWFsdGhcclxuICApIHtcclxuICAgIHN1cGVyKHgsIHksIHdpZHRoLCBoZWlnaHQpO1xyXG4gIH1cclxufVxyXG4iLCJpbXBvcnQgeyBkZWZhdWx0Q29tcHV0ZXJQbGF5ZXIgfSBmcm9tIFwiLi9tb2RlbC9jbGFzc2VzL2NvbXB1dGVyUGxheWVyXCI7XHJcbmltcG9ydCB7IGRlZmF1bHRIdW1hblBsYXllciB9IGZyb20gXCIuL21vZGVsL2NsYXNzZXMvaHVtYW5QbGF5ZXJcIjtcclxuaW1wb3J0IHsgT2JzdGFjbGUgfSBmcm9tIFwiLi9tb2RlbC9jbGFzc2VzL29ic3RhY2xlXCI7XHJcbmltcG9ydCB7IFdvcmxkIH0gZnJvbSBcIi4vbW9kZWwvY2xhc3Nlcy93b3JsZFwiO1xyXG5pbXBvcnQgeyBIZWFsdGggfSBmcm9tIFwiLi9tb2RlbC9jb21wb25lbnRzL2hlYWx0aFwiO1xyXG5cclxuY29uc3QgcGxheWVycyA9IFtkZWZhdWx0SHVtYW5QbGF5ZXIsIGRlZmF1bHRDb21wdXRlclBsYXllcl07XHJcblxyXG5jb25zdCBvYnN0YWNsZXMgPSBbXHJcbiAgbmV3IE9ic3RhY2xlKDIwMCwgMjAwLCA1MCwgNTAsIG5ldyBIZWFsdGgoMjAwKSksXHJcbiAgbmV3IE9ic3RhY2xlKDMwMCwgMzAwLCAyMCwgMTUwLCBuZXcgSGVhbHRoKDIwMCkpLFxyXG4gIG5ldyBPYnN0YWNsZSg2MDAsIDQwMCwgOTAsIDcwLCBuZXcgSGVhbHRoKDIwMCkpLFxyXG5dO1xyXG5cclxuY29uc3Qgd29ybGQgPSBuZXcgV29ybGQoKTtcclxuXHJcbmV4cG9ydCBjb25zdCBkZWZhdWx0Q29uZmlnID0ge1xyXG4gIHBsYXllcnMsXHJcbiAgb2JzdGFjbGVzLFxyXG4gIHdvcmxkLFxyXG59O1xyXG4iLCJpbXBvcnQgeyBTaGFwZSB9IGZyb20gXCIuLi9jb21wb25lbnRzL3NoYXBlXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgV29ybGQgZXh0ZW5kcyBTaGFwZSB7XHJcbiAgY29uc3RydWN0b3Iod2lkdGg6IG51bWJlciA9IDgwMCwgaGVpZ2h0OiBudW1iZXIgPSA1MDApIHtcclxuICAgIHN1cGVyKDAsIDAsIHdpZHRoLCBoZWlnaHQpO1xyXG4gIH1cclxufVxyXG4iLCJpbXBvcnQgeyBkZWZhdWx0Q29uZmlnIH0gZnJvbSBcIi4vZGVmYXVsdEdhbWVTZXR1cFwiO1xyXG5cclxuY29uc3QgZ2FtZSA9IHtcclxuICAuLi5kZWZhdWx0Q29uZmlnLFxyXG59O1xyXG5cclxuY29uc3QgeyB3b3JsZCwgcGxheWVycywgb2JzdGFjbGVzIH0gPSBkZWZhdWx0Q29uZmlnO1xyXG5jb25zdCBjYW52YXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiY2FudmFzXCIpITtcclxuY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoXCIyZFwiKSE7XHJcbmNhbnZhcy5oZWlnaHQgPSB3b3JsZC5oZWlnaHQ7XHJcbmNhbnZhcy53aWR0aCA9IHdvcmxkLndpZHRoO1xyXG5cclxuLyoqXHJcbiAqIFRPRE86IFB1dCBcImRyYXdcIi9cInJlbmRlclwiIG1ldGhvZCBvbiBcIlNoYXBlXCIgY2xhc3NcclxuICogYW5kIGhhdmUgYWxsIHN1YmNsYXNzZXMgKFNob3QsIE1vdmFibGVTaGFwZSwgSHVtYW5QbGF5ZXIsXHJcbiAqIENvbXB1dGVyUGxheWVyKSBvdmVycmlkZSB3aXRoIHRoZWlyIGltcGxlbWVudGF0aW9uXHJcbiAqIChkZXBlbmRpbmcgb24gaG93IHRoZXkgd2FudCB0byBiZSByZW5kZXJlZCBvbiB0aGUgY2FudmFzKS5cclxuICogVGhlbiB0aGUgY2FsbGVyIGNhbiBqdXN0IGNhbGwgXCJkcmF3XCIgbWV0aG9kIGFuZCB0aGUgY2xhc3Nlc1xyXG4gKiB0aGVtc2VsdmVzIGNhbiBiZSByZXNwb25zaWJsZSBmb3IgaG93IHRoZXkncmUgcmVwcmVzZW50ZWQuXHJcbiAqL1xyXG5jb25zdCB1cGRhdGUgPSBhc3luYyAoKSA9PiB7XHJcbiAgY3R4LmNsZWFyUmVjdCgwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpO1xyXG5cclxuICBmb3IgKGNvbnN0IG9ic3RhY2xlIG9mIG9ic3RhY2xlcykge1xyXG4gICAgLy8gT2JzdGFjbGVcclxuICAgIGN0eC5maWxsU3R5bGUgPSBcIiM3MDQzMDBcIjtcclxuICAgIGN0eC5maWxsUmVjdChvYnN0YWNsZS54LCBvYnN0YWNsZS55LCBvYnN0YWNsZS53aWR0aCwgb2JzdGFjbGUuaGVpZ2h0KTtcclxuXHJcbiAgICBjb25zdCB7IGN1cnJlbnRIZWFsdGggfSA9IG9ic3RhY2xlLmhlYWx0aDtcclxuXHJcbiAgICAvLyBPYnN0YWNsZSBIUCBiYXJcclxuICAgIGN0eC5maWxsU3R5bGUgPVxyXG4gICAgICBjdXJyZW50SGVhbHRoID4gNjAgPyBcImdyZWVuXCIgOiBjdXJyZW50SGVhbHRoID4gNDAgPyBcInllbGxvd1wiIDogXCJyZWRcIjtcclxuICAgIGN0eC5maWxsUmVjdChcclxuICAgICAgb2JzdGFjbGUueCxcclxuICAgICAgb2JzdGFjbGUueSAtIDQwLFxyXG4gICAgICBvYnN0YWNsZS5oZWFsdGguY3VycmVudEhlYWx0aEFzUGVyY2VudGFnZSAqIG9ic3RhY2xlLndpZHRoLFxyXG4gICAgICAyMFxyXG4gICAgKTtcclxuICAgIGN0eC5zdHJva2VTdHlsZSA9IFwiYmxhY2tcIjtcclxuICAgIGN0eC5saW5lV2lkdGggPSAyO1xyXG4gICAgY3R4LnN0cm9rZVJlY3Qob2JzdGFjbGUueCwgb2JzdGFjbGUueSAtIDQwLCBvYnN0YWNsZS53aWR0aCwgMjApO1xyXG4gIH1cclxuXHJcbiAgZm9yIChjb25zdCBwbGF5ZXIgb2YgcGxheWVycykge1xyXG4gICAgcGxheWVyLm1vdmUoKTtcclxuXHJcbiAgICAvLyBUT0RPOiB0aGlzIGlzIHF1YWRyYXRpYyBiZWhhdmlvdXIgKGFuZCB3aWxsIHNjYWxlIHBvb3JseSksIGJ1dCBtaWdodCBub3QgaGF2ZSBlbm91Z2hcclxuICAgIC8vIG9iamVjdHMvY29tcGFyaXNvbnMgdG8gd2FycmFudCBhIG1vcmUgZWZmaWNpZW50IHN0cnVjdHVyZVxyXG4gICAgLy8gZS5nIHF1YWR0cmVlLCBvY3RvdHJlZS5cclxuICAgIGlmIChwbGF5ZXIuY29sbGlkZXNXaXRoQW55KC4uLm9ic3RhY2xlcykpIHtcclxuICAgICAgcGxheWVyLm1vdmVCYWNrKCk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgeyBjdXJyZW50SGVhbHRoIH0gPSBwbGF5ZXIuaGVhbHRoO1xyXG5cclxuICAgIC8vIFBsYXllciBzcHJpdGVcclxuICAgIGN0eC5maWxsU3R5bGUgPSBcInJlZFwiO1xyXG4gICAgY3R4LmZpbGxSZWN0KHBsYXllci54LCBwbGF5ZXIueSwgcGxheWVyLndpZHRoLCBwbGF5ZXIuaGVpZ2h0KTtcclxuXHJcbiAgICAvLyBQbGF5ZXIgSFAgYmFyXHJcbiAgICBjdHguZmlsbFN0eWxlID1cclxuICAgICAgY3VycmVudEhlYWx0aCA+IDYwID8gXCJncmVlblwiIDogY3VycmVudEhlYWx0aCA+IDQwID8gXCJ5ZWxsb3dcIiA6IFwicmVkXCI7XHJcbiAgICBjdHguZmlsbFJlY3QoXHJcbiAgICAgIHBsYXllci54LFxyXG4gICAgICBwbGF5ZXIueSAtIDQwLFxyXG4gICAgICBwbGF5ZXIuaGVhbHRoLmN1cnJlbnRIZWFsdGhBc1BlcmNlbnRhZ2UgKiBwbGF5ZXIud2lkdGgsXHJcbiAgICAgIDIwXHJcbiAgICApO1xyXG4gICAgY3R4LnN0cm9rZVN0eWxlID0gXCJibGFja1wiO1xyXG4gICAgY3R4LmxpbmVXaWR0aCA9IDI7XHJcbiAgICBjdHguc3Ryb2tlUmVjdChwbGF5ZXIueCwgcGxheWVyLnkgLSA0MCwgcGxheWVyLndpZHRoLCAyMCk7XHJcblxyXG4gICAgLy8gVXBkYXRlXHJcbiAgICBmb3IgKGNvbnN0IHNob3Qgb2YgcGxheWVyLnNob290ZXIuc2hvdHNGaXJlZCkge1xyXG4gICAgICBzaG90Lm1vdmUoKTtcclxuICAgICAgLy8gQ2hlY2sgaWYgY29sbGlkZXMgd2l0aCBvYnN0YWNsZXM/XHJcbiAgICAgIGlmIChvYnN0YWNsZXMuc29tZSgob2JzdGFjbGUpID0+IHNob3QuY29sbGlkZXNXaXRoKG9ic3RhY2xlKSkpXHJcbiAgICAgICAgY3R4LmZpbGxTdHlsZSA9IFwiZ29sZGVucm9kXCI7XHJcbiAgICAgIGN0eC5maWxsUmVjdChzaG90LngsIHNob3QueSwgNywgNyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyBhd2FpdCBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gc2V0VGltZW91dChyZXNvbHZlLCAxZTMpKTtcclxuICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUodXBkYXRlKTtcclxufTtcclxuXHJcbnVwZGF0ZSgpO1xyXG4iXSwic291cmNlUm9vdCI6IiJ9